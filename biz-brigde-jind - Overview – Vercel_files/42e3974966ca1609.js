;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="9304f90a-d1e6-7f8e-b694-9e046becd5b3")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,156530,e=>{"use strict";var t=e.i(5169864);function n(e){let[n,i]=(0,t.useState)(!1),r=(0,t.useCallback)(()=>{i(!1)},[]),s=(0,t.useCallback)(()=>{i(!0)},[]),[l,o]=(0,t.useState)(0),a=(0,t.useCallback)(()=>{o(e=>e+1)},[o]);return[s,{active:n,onClickOutside:r,key:`${e}${String(l)}`,onAnimationDone:a}]}e.s(["useModalState",()=>n])},5744676,e=>{"use strict";var t,n=((t={}).JSON="json",t.NDJSON="ndjson",t);e.s(["DeliveryFormats",()=>n,"LogSourcesWithDescription",0,[{label:"Static",value:"static",description:"Requests to static assets like HTML and CSS files"},{label:"External",value:"external",description:"External rewrites to a different domain"},{label:"Edge",value:"edge",description:"Output from Edge Functions like Middleware"},{label:"Build",value:"build",description:"Output from the Build Step"},{label:"Function",value:"lambda",description:"Output from Vercel Functions like API Routes"},{label:"Firewall",value:"firewall",description:"Requests rejected by the Vercel Firewall"}]])},8020240,e=>{"use strict";var t=e.i(1146226),n=e.i(6607601),i=e.i(5744676),r=e.i(1919132);function s(e){let{connection:i,inlineCode:s,wrap:o}=e,a=(0,r.getLogDrainProtocolSettings)(i);if(!a)return null;let c=`Sampling ${100*a.samplingRate}%`,d=`${a.sources.map(l).join(", ")}, ${c}`;return s||o?(0,t.jsx)("div",{className:"flex flex-row items-stretch justify-end gap-1 flex-initial w-full flex-wrap",children:s?(0,t.jsxs)(t.Fragment,{children:[a.sources.map(e=>(0,t.jsx)("div",{children:(0,t.jsx)(n.InlineCode,{children:l(e)})},e)),(0,t.jsx)("div",{children:(0,t.jsx)(n.InlineCode,{children:c})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900 text-end",children:a.sources.map(l).join(", ")}),",",(0,t.jsx)("p",{className:"text-copy-14 text-gray-900 text-end",children:c})]})}):(0,t.jsx)("p",{className:"text-copy-13-mono text-gray-900 truncate whitespace-nowrap rounded-[var(--geist-radius)] bg-[var(--accents-2)] px-[4px]",title:d,children:d})}function l(e){return i.LogSourcesWithDescription.find(t=>t.value===e)?.label??e}e.s(["LogDrainConnection",()=>s])},5098510,7195573,e=>{"use strict";var t=e.i(1146226),n=e.i(5169864),i=e.i(2560270),r=e.i(7399351),s=e.i(6048771),l=e.i(1919132),o=e.i(5927860);function a(e){return e===o.EnvTarget.Production?"Production":e===o.EnvTarget.Preview?"Preview":"Development"}e.s(["stringifyTarget",()=>a],7195573);var c=e.i(8020240),d=e.i(9722978);function u(e){let{connections:s,className:l}=e,[o,a]=(0,n.useState)(!1);if(1===s.length)return(0,t.jsx)(x,{connection:s[0],index:0});let c=o?s:s.slice(0,2);return(0,t.jsxs)("div",{className:(0,d.clsx)("flex flex-col items-stretch justify-start flex-initial p-2 'border-1 relative rounded-md border-gray-alpha-400 bg-[var(--geist-background)] shadow-border",l),children:[s.length>2?(0,t.jsx)("div",{onClick:()=>a(!o),className:"flex flex-col items-center justify-center flex-initial absolute -bottom-3 right-[calc(50%-12px)] size-6 rounded-full border border-solid border-gray-400 bg-background-100",children:o?(0,t.jsx)(r.ChevronUp,{}):(0,t.jsx)(i.ChevronDown,{})}):null,c.map((e,n)=>(0,t.jsx)(x,{connection:e,index:n},e.id))]})}function x(e){let{connection:n,index:i}=e,r=3===n.environments.length?"All Environments":n.environments.map(a).join(", ");return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,d.clsx)("flex flex-row items-center justify-between gap-2 flex-initial rounded-md p-2",i%2==1&&"bg-[var(--accents-1)]"),children:[(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)(s.ProjectLogo,{deploymentId:n.latestDeployment,framework:n.framework,project:n,size:20}),(0,t.jsx)("p",{className:"text-copy-14",children:n.name})]}),(0,t.jsx)("div",{color:"gray-900",className:"flex flex-row items-stretch justify-start gap-2 flex-initial",children:(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:r})})]},n.id),(0,l.isLogDrainInConnection)(n)?(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium shrink-0",children:"Log Drain"}),(0,t.jsx)(c.LogDrainConnection,{connection:n,wrap:!0})]},n.id):null]})}e.s(["ProjectConnectionsListInModal",()=>u],5098510)},1288475,e=>{"use strict";let t=(0,e.i(9334638).withNewIcon)('<path d="M13 8C13 10.7614 10.7614 13 8 13C5.23858 13 3 10.7614 3 8C3 5.23858 5.23858 3 8 3C10.7614 3 13 5.23858 13 8Z" fill="currentColor"/>');e.s(["Status",0,t])},1627296,e=>{"use strict";var t=e.i(1146226),n=e.i(5169864),i=e.i(8735244);function r(e){let{swr:r}=e,s=(0,n.useRef)(null),[l,o]=(0,n.useState)(!1),{loadMore:a,isReachingEnd:c,isLoadingMore:d,initialDataLoaded:u}=r;return((0,n.useEffect)(()=>{u&&!c&&!d&&l&&a()},[u,l,d,c,a]),(0,n.useEffect)(()=>{let e=s.current;if(!e)return;let t=new IntersectionObserver(e=>{o(e[0].isIntersecting)});return t.observe(e),()=>{t.disconnect()}},[o]),!u||c)?null:(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-center flex-initial py-2",style:{position:"relative"},children:[(0,t.jsx)("div",{ref:s,style:{position:"absolute",top:"-150px"}}),d?(0,t.jsx)(i.Spinner,{}):null]})}e.s(["LoadMore",()=>r])},9366770,4404233,e=>{"use strict";var t=e.i(2490412);let n=(0,t.createServerReference)("40a496a47a755c78f405c768fc9d63a017450892a7",t.callServer,void 0,t.findSourceMapURL,"blockConnectionUntilResourceIsAvailable");function i(e){if(!e)return!1;if("protocols"in e)return e.protocols.storage?.status==="enabled";if("product"in e){let t=e.product;if("supportedProtocols"in t)return t.supportedProtocols.includes("storage")}return!1}e.s(["blockConnectionUntilResourceIsAvailable",()=>n],9366770),e.s(["areResourceDeploymentsEnabled",()=>i],4404233)},5393630,e=>{"use strict";var t=e.i(1146226),n=e.i(1288475),i=e.i(5255926),r=e.i(3306538),s=e.i(5468328);function l(e){let{label:i,type:r}=e,s="teal-600";return"error"===r?s="red-700":"init"===r?s="gray-500":"warning"===r&&(s="amber-600"),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:[(0,t.jsx)(n.Status,{color:s}),(0,t.jsx)("p",{className:"text-copy-14",children:i})]})}function o(e){let{label:n}=e;return(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:(0,t.jsx)(r.Badge,{variant:"red",children:n})})}function a(e){let{resource:n}=e;switch(n?.status){case"suspended":return(0,t.jsx)(o,{label:"Suspended"});case"limits-exceeded-suspended":return(0,t.jsx)(o,{label:"Limits Exceeded"});case"limits-exceeded-suspended-store-count":return(0,t.jsx)(o,{label:"Store Count Limit Reached"});case"available":return(0,t.jsx)(l,{label:"Available",type:"ok"});case"error":return(0,t.jsx)(l,{label:"Error",type:"error"});case"initializing":return(0,t.jsx)(l,{label:"Initializing",type:"init"});case"onboarding":return(0,t.jsx)(s.Tooltip,{text:"Additional onboarding is required to enable all features. Please complete the setup in the partner dashboard.",children:(0,t.jsx)(l,{label:"Onboarding",type:"warning"})});case"uninstalled":return(0,t.jsx)(l,{label:"Uninstalled",type:"error"});default:return(0,t.jsx)(i.Skeleton,{boxHeight:20,height:16,vcenter:!0,width:114})}}e.s(["ResourceStatus",()=>a])},8824424,e=>{"use strict";var t=e.i(1146226),n=e.i(5169864),i=e.i(1360174),r=e.i(3306538),s=e.i(6881349),l=e.i(8522580),o=e.i(5169576),a=e.i(2107254),c=e.i(4004502),d=e.i(6048771),u=e.i(1627296);function x(e){let{allowSelectConnectedProjects:x,selectedProject:p,account:m,onProjectSelected:f,resource:g,resourceTitle:j,...h}=e,[v,y]=(0,n.useState)(""),b=(0,n.useMemo)(()=>(0,i.default)(y,500),[]),[,C]=(0,a.useProjectListInfinite)({limit:20,search:v,latestDeployments:0,slug:m},{},!1,!0),N=C.initialDataLoaded,w=e=>!!e&&("connectedProjectIds"in h?h.connectedProjectIds.includes(e.id):h.includedInConnectedProjects(e)),P=w(p),S=(0,n.useCallback)(e=>{let t=g?.projectFilter;if(!t||0===Object.keys(t).length)return!1;if(t.git){let{git:n}=t,i=function(e){if(!e)return null;switch(e.type){case"github":return{provider:"github",id:e.repoOwnerId?String(e.repoOwnerId):e.org,slug:e.org};case"gitlab":return{provider:"gitlab",id:e.projectNamespace,slug:e.projectNamespace};case"bitbucket":return{provider:"bitbucket",id:e.workspaceUuid,slug:e.owner};default:return null}}(e.link);if(!i)return"No Git";if("*"!==n.providers&&!n.providers.includes(i.provider)||n.owners&&!n.owners.includes(i.id)&&!n.owners.includes(i.slug))return"Git Mismatch"}return!1},[g]);return(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsxs)(s.Combobox,{"data-testid":(0,c.tid)("connect-project","select-project-combobox"),filter:e=>e,onChange:e=>{let t=C.projects.find(t=>t.id===e)??null;(!w(t)||x)&&f(t)},onClear:()=>y(""),placeholder:"Search Projects…",prefixIcon:p?.latestDeployments&&p.latestDeployments.length>0?(0,t.jsx)(d.ProjectLogo,{deploymentId:p.latestDeployments[0]?.id??"",framework:p.framework,project:p,size:20}):null,value:p?.name??null,children:[(0,t.jsx)(s.Combobox.Input,{onChange:e=>b(e.target.value)}),(0,t.jsx)(s.Combobox.List,{emptyMessage:N?v?`No project found with the name "${v}".`:"No project under this account.":"Loading…",ListFooterComponent:(0,t.jsx)(u.LoadMore,{swr:C}),children:C.projects.map(e=>{let n=w(e),i=S(e);return(0,t.jsxs)(s.Combobox.Option,{className:"w-full flex-row items-center justify-between gap-2","data-testid":(0,c.tid)("connect-project","select-project",e.id),disabled:n&&!x||!1!==i,value:e.id,children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:[(0,t.jsx)(d.ProjectLogo,{deploymentId:e.latestDeployments?.[e.latestDeployments.length-1]?.id,framework:e.framework,project:e,size:20}),(0,t.jsx)("p",{className:"text-copy-14",children:e.name})]}),n?(0,t.jsx)(r.Badge,{variant:"gray",children:"connected"}):null,i?(0,t.jsx)(r.Badge,{variant:"gray",children:i}):null]},e.id)})})]}),P&&x?(0,t.jsx)(l.Note,{fill:!0,label:!1,type:"secondary",variant:"contrast",children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)(o.Information,{className:"stroke-gray-900",size:20}),(0,t.jsxs)("p",{className:"text-[14px] font-medium leading-[24px] text-gray-1000",children:["This project has already been connected to this ",j]})]}),(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"To connect it again, use a different Environment Variable Name."})]})}):null]})}e.s(["ResourceProjectSelector",()=>x])},2014455,e=>{"use strict";var t=e.i(1146226),n=e.i(3869281),i=e.i(4030453),r=e.i(5927860);function s(e){let{environments:s,error:l,onChange:o,resourceTitle:a}=e,c={[r.EnvTarget.Development]:"Development",[r.EnvTarget.Preview]:"Preview",[r.EnvTarget.Production]:"Production"},[d,u]=Object.entries(s).reduce((e,t)=>(e[t[0]in c?0:1].push(t),e),[[],[]]);return(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:"Environments"}),(0,t.jsxs)("div",{className:"text-gray-900 text-[13px] leading-4",children:["Choose which environments of the project to make this"," ",a.toLowerCase()," available to."]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("div",{className:"flex flex-row gap-2",children:d.map(e=>{let[i,r]=e;return(0,t.jsx)(n.Checkbox,{checked:r,onChange:()=>{o({...s,[i]:!r})},children:(0,t.jsx)("span",{className:`font-medium ${!r?"text-gray-900":""}`,children:c[i]})},`environment-${i}`)})}),u.length>0&&(0,t.jsx)("div",{className:"flex flex-row gap-4",children:u.map(e=>{let[i,r]=e;return(0,t.jsx)(n.Checkbox,{checked:r,onChange:()=>{o({...s,[i]:!r})},children:i},`environment-${i}`)})})]}),l?(0,t.jsx)(i.Error,{children:l}):null]})}e.s(["ResourceEnvironmentSelector",()=>s])},7137779,2483721,e=>{"use strict";var t=e.i(1146226),n=e.i(5169864),i=e.i(6891161),r=e.i(455575),s=e.i(4030453),l=e.i(4004502),o=e.i(57106),a=e.i(5927860),c=e.i(7917902),d=e.i(4422059),u=e.i(134877),x=e.i(2405338),p=e.i(9366770),m=e.i(6060673),f=e.i(8794163),g=e.i(5074599),j=e.i(9584471),h=e.i(3758860),v=e.i(1887803),y=e.i(3183079),b=e.i(648779),C=e.i(39509);e.i(3182268);var N=e.i(7849855),w=e.i(1919132),P=e.i(4404233),S=e.i(5779481),k=e.i(5393630),I=e.i(397510),R=e.i(8824424),E=e.i(3869281),T=e.i(3500331),D=e.i(1906681),O=e.i(9186321),L=e.i(588428),M=e.i(9722978),A=e.i(7743427),B=e.i(2014455);function q(e){let{isLoading:n,store:i,advancedOptions:r,onChangeAdvancedOptions:s,prefixPlaceholder:l,sampleEnvVarName:o,connection:a}=e,c=(0,g.getResourceTitleByResource)(i),d=i?.type==="integration"&&"convex"===i.product.slug;return(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,t.jsx)(B.ResourceEnvironmentSelector,{environments:r.environments,error:r.error?.environments,onChange:e=>s({...r,environments:e,error:{...r.error,environments:void 0}}),resourceTitle:c}),i?.type==="integration"&&(0,P.areResourceDeploymentsEnabled)(i)?(0,t.jsx)($,{advancedOptions:r,onChangeAdvancedOptions:s,store:i,title:c,connection:a}):null,!d&&(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:"Custom Prefix"}),(0,t.jsxs)("div",{className:"text-gray-900 text-[13px] leading-4",children:["This prefix will be applied to the environment variables that are automatically created for the ",c,"."]})]}),(0,t.jsx)("div",{className:"flex flex-col gap-4",children:(0,t.jsx)("div",{className:"flex flex-col gap-3",children:(0,t.jsx)(T.Input,{"aria-label":"Environment Variables Prefix",disabled:n,error:r.error?.envPrefix,onChange:e=>s({...r,envPrefix:e.currentTarget.value,error:{...r.error,envPrefix:void 0}}),placeholder:l,suffix:o,value:r.envPrefix,width:"100%"})})})]})]})}function $(e){let{store:i,advancedOptions:r,onChangeAdvancedOptions:s,connection:l}=e,{data:c}=(0,A.useIntegration)(i.product.integration.id),d=c?.flags?.includes(O.LaunchDarklyIntegrationFlags.MarketplaceDeploymentActions),{value:u}=(0,L.useLaunchDarklyTeamFeatureFlag)("deployment-integrations"),{product:x}=(0,A.useIntegrationAndProduct)({integrationIdOrSlug:i.product.integration.id,productIdOrSlug:i.product.id,teamIdOrSlug:i.ownerId}),p=x?.actions??[],m=(0,n.useMemo)(()=>[{target:a.EnvTarget.Preview,name:"Preview"},{target:a.EnvTarget.Production,name:"Production"}],[]);if(!d||!u)return null;let f=r.deployments,g=!!l,j=p.length>0&&(l||f?.required);return g||j?(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[g?(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("div",{className:"flex flex-col gap-1",children:(0,t.jsx)("div",{className:"text-sm font-semibold",children:"Resource is Required To Be In An Active State Before Deployment"})}),(0,t.jsx)(D.Toggle,{className:"w-fit",checked:f?.required??!1,direction:"switch-first",onChange:e=>{s({...r,deployments:{...f,required:e,actions:e?f?.actions:{}}})},size:"large",children:(0,t.jsx)("div",{className:"text-[13px] whitespace-normal",children:f?.required?"Required":"Not Required"})})]}):null,j?(0,t.jsx)("div",{className:(0,M.clsx)("flex flex-col gap-6",{"opacity-50":!f?.required}),children:p.map(e=>(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"text-sm font-semibold capitalize",children:e.name}),e.description?(0,t.jsxs)("div",{className:"text-gray-900 text-[13px]",children:[e.description,e.link?(0,t.jsx)(o.Link,{external:!0,href:e.link}):null]}):null]}),(0,t.jsx)("div",{className:"flex flex-row gap-4",children:m.map(n=>(0,t.jsx)(E.Checkbox,{checked:f?.actions?.[e.slug]?.[n.target]??!1,disabled:!f?.required||!r.environments[n.target],onChange:t=>{s({...r,deployments:{...f,actions:{...f?.actions,[e.slug]:{...f?.actions?.[e.slug],[n.target]:t.target.checked}}}})},children:(0,t.jsxs)("span",{className:`font-medium ${!f?.actions?.[e.slug]?.[n.target]?"text-gray-900":""}`,children:[" ",n.name," "]})},n.target))})]},e.slug))}):null]}):null}var F=e.i(808558),z=e.i(5530726);function U(e){let{resource:n}=e;if(!n||"integration"!==n.type)return null;let i=n.product.projectConnectionScopes;if(!i||0===i.length)return null;let r=i.map(e=>(0,z.scopeFormatter)(e)??null).filter(V).reduce((e,t)=>{let{permission:n}=t;return e[n].push(t),e},{Read:[],"Read and Write":[]});return(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14",children:"This integration requires the following permissions"}),(0,t.jsx)("ul",{"data-testid":(0,l.tid)("connect-project","scopes"),className:"flex flex-col items-stretch justify-start gap-4 flex-initial m-0 list-none p-0",children:Object.entries(r).map(e=>{let[n,i]=e;return 0===i.length?null:(0,t.jsxs)("li",{className:"flex flex-row items-center justify-start gap-3 flex-initial",children:[(0,t.jsx)("div",{className:"flex-basis",children:(0,t.jsx)(F.IconDefault,{size:24})}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-1 flex-initial",children:[(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:(0,t.jsx)("p",{className:"text-heading-14 whitespace-nowrap",children:n})}),(0,t.jsx)("ul",{className:"m-0 list-none p-0",children:i.map((e,n)=>{let{resource:r}=e;return(0,t.jsx)("li",{style:{display:"inline"},children:(0,t.jsxs)("span",{className:"text-copy-14 tailwind-preflight",children:[r,n===i.length-1?null:", "]})},r)})})]})]},n)})})]})}function V(e){return null!=e}function W(e){let{resource:t,blockData:n}=e,i=t?.status;return n&&!n.blockConnection||t&&"integration"!==t.type||"available"===i}function G(e){let{backOrCancelLabel:c,project:m,store:y,connection:b,title:C,subtitle:N,onBack:R,onClickOutside:E,onConnectionCreated:T,ProjectSelector:D,initialEnvPrefix:O,resourceId:L}=e,{mutateResourceListAndProject:A}=(0,j.useMutateResourceCache)(),{mutate:B}=(0,S.useResourceItem)({resourceId:L,includeGuides:!0}),{createConnection:$,updateConnection:F}=(0,v.useResourceConnection)(),{token:z}=(0,f.useV0Marketplace)()||{},[V,G]=(0,n.useState)(!1),[Z,_]=(0,n.useState)({envPrefix:O??b?.envVarPrefix??void 0,environments:{[a.EnvTarget.Development]:b?.environments.includes(a.EnvTarget.Development)??!0,[a.EnvTarget.Preview]:b?.environments.includes(a.EnvTarget.Preview)??!0,[a.EnvTarget.Production]:b?.environments.includes(a.EnvTarget.Production)??!0},deployments:b?.deployments?{required:b.deployments.required,actions:b.deployments.actions.reduce((e,t)=>{let{slug:n,environments:i}=t;return e[n]=i.reduce((e,t)=>(e[t]=!0,e),{}),e},{})}:!b&&(0,P.areResourceDeploymentsEnabled)(y)?{required:!0,actions:{}}:void 0,protocolSettings:b?.protocolSettings??void 0,error:null}),[H,K]=(0,n.useState)(!1),[Q,X]=(0,n.useState)(null),Y=(0,d.usePrevious)(m),ee=(0,n.useRef)(!1);(0,n.useEffect)(()=>{ee.current||m&&(!Y||m.id===Y.id)||(ee.current=!0,_(e=>({...e,error:null,environments:{[a.EnvTarget.Development]:!0,[a.EnvTarget.Preview]:!0,[a.EnvTarget.Production]:!0}})))},[Y,m]);let et=(0,n.useCallback)(async()=>{if(m)try{var e,t;let n,i=[a.EnvTarget.Production,a.EnvTarget.Preview,a.EnvTarget.Development].filter(e=>Z.environments[e]),s=Z.deployments?{required:Z.deployments.required??!1,actions:Z.deployments.required?Object.entries(Z.deployments.actions??{}).map(e=>{let[t,n]=e;return{slug:t,environments:Object.entries(n).reduce((e,t)=>{let[n,r]=t;return r&&i.includes(n)&&e.push(n),e},[])}}).filter(e=>{let{environments:t}=e;return t.length>0}):[]}:void 0;if(K(!0),X(null),_({...Z,error:null}),0===i.length){_({...Z,error:{environments:"Select at least one Environment for your Environment Variable"}}),K(!1);return}if(Z.envPrefix&&!/^[a-zA-Z][a-zA-Z0-9_]*$/.test(Z.envPrefix)){_({...Z,error:{envPrefix:"The prefix contains invalid characters. It must start with a letter and be made of letters, digits, and underscores only."}}),K(!1);return}let l=(e=y,t=Z.protocolSettings,n=(0,w.getLogDrainProtocolSettings)({protocolSettings:t}),e?.type==="integration"&&(0,h.isProtocolSupported)(e.product,"logDrain")&&n&&!n.sources.length?"Select at least one source to enable log draining":null);if(l){_({...Z,error:{protocolSettings:l}}),K(!1);return}b?await F({resourceId:L,connectionId:b.id,envVarPrefix:Z.envPrefix,envVarEnvironments:i,deployments:s,protocolSettings:Z.protocolSettings}):await $({projectId:m.id,envVarPrefix:Z.envPrefix,envVarEnvironments:i,deployments:s,resourceId:L,protocolSettings:Z.protocolSettings,v0token:z}),r.toasts.success({text:`Connected Project ${m.name} to ${(0,g.getResourceTitleByResource)(y)}`,key:m.id}),await A(m.name,y?.type==="integration"?y.product.supportedProtocols[0]:"storage"),await B(),y?.type==="integration"&&y.product.showSSOLinkOnProjectConnection?G(!0):(T&&await T(),E())}catch(e){if((0,u.isAPIError)(e))e.code===v.ResourceConnectionsErrorCodes.ProjectEnvVarNotUnique?_({...Z,error:{envPrefix:e.message}}):X(e.message);else throw e}finally{K(!1)}},[m,Z,y,b,A,B,F,L,$,z,T,E]),{isWaitingForAvailableResource:en,onSubmit:ei,resourceStatus:er,isSubmitDisabled:es}=function(e){let{initialResource:t,resourceId:i,handleSubmit:r}=e,{data:s}=(0,S.useResourceItem)({resourceId:i,revalidateStatus:!0}),[l,o]=(0,n.useState)(!1),a=s?.store.status,c=(0,n.useRef)(!1),d=s?.store??t,u=d?.type==="integration"?d.product.slug:null,{data:m}=(0,x.default)(u?"marketplace-product-block-connection-until-available":null,()=>(0,p.blockConnectionUntilResourceIsAvailable)(u));return(0,n.useEffect)(()=>{!c.current&&l&&W({blockData:m,resource:d})&&(c.current=!0,r())},[r,m,l,d]),{isWaitingForAvailableResource:!!(l&&"available"!==a&&m?.blockConnection),onSubmit:()=>{W({blockData:m,resource:d})?r():o(!0)},resourceStatus:a,isSubmitDisabled:!d||!!("integration"===d.type&&!m)}}({resourceId:L,handleSubmit:et});return(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),ei()},children:[(0,t.jsx)(i.Modal.Body,{children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-6 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)(i.Modal.Title,{center:!0,children:C}),N?(0,t.jsx)(i.Modal.Subtitle,{children:N}):null]}),(0,t.jsx)(i.Modal.Inset,{last:!0,children:J(y)&&V?(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsxs)("p",{className:"text-copy-14",children:["Project ",m?.name," successfully connected to"," ",(0,g.getResourceTitleByResource)(y)]}),(0,t.jsxs)("p",{className:"text-copy-14",children:["Complete the project configuration in the"," ",y.product.integration.name," Dashboard"]})]}):(0,t.jsxs)("div",{className:(0,M.default)("flex flex-col items-stretch justify-start gap-6 flex-initial",en?"geist-disabled pointer-events-none":void 0),children:[(0,t.jsx)(o.Link,{href:"#",style:{position:"absolute"},children:""}),D,(0,t.jsx)(U,{resource:y}),(0,t.jsx)(q,{advancedOptions:Z,isLoading:H,onChangeAdvancedOptions:_,prefixPlaceholder:(0,h.getEnvPrefixByResource)(y),sampleEnvVarName:(0,h.getSampleEnvVarNameByResource)(y),store:y,connection:b}),Q?(0,t.jsx)(s.Error,{children:Q}):null]})})]})}),(0,t.jsxs)(i.Modal.Actions,{children:[(0,t.jsx)(i.Modal.Action,{onClick:V?()=>{T&&T(),E()}:R,type:"secondary",children:V?"Later":c}),J(y)&&V?(0,t.jsx)(I.OpenInPartnerDashboardButton,{buttonVariant:"default",componentType:"button",integrationConfigurationId:y.product.integrationConfigurationId,label:`Open in ${y.product.integration.name}`,onClick:()=>{T&&T(),E()},productId:y.product.id,externalResourceId:y.externalResourceId,teamIdOrSlug:y.ownerId,projectId:m?.id,path:"onboarding"}):(0,t.jsx)(i.Modal.Action,{buttonType:"submit","data-testid":(0,l.tid)("connect-project","store-modal-connect-project"),disabled:!m||es,loading:H||en,type:en?"secondary":"default",children:en?(0,t.jsx)(k.ResourceStatus,{resource:er?{status:er}:null}):b?"Update":"Connect"})]})]})}function J(e){return!!(e?.type==="integration"&&e.product.showSSOLinkOnProjectConnection)}function Z(e){let{active:r,store:s,onClickOutside:l,onAnimationDone:o,onConnectionCreated:a,resourceId:d,initialProjectSlug:u}=e,{data:x}=(0,m.useProject)(u),[p,f]=(0,n.useState)(null),{team:j,user:v}=(0,c.useAccount)();(0,n.useEffect)(()=>{x&&f(e=>e??x)},[x]);let y=j?j.slug:v?.username;return(0,t.jsx)(i.Modal.Modal,{active:r,allowOverflow:!0,onAnimationDone:o,onClickOutside:l,width:540,children:(0,t.jsx)(G,{ProjectSelector:(0,t.jsx)(R.ResourceProjectSelector,{account:y,allowSelectConnectedProjects:s?.type==="integration"&&(0,h.isProtocolSupported)(s.product,"logDrain"),connectedProjectIds:s?.projectsMetadata.map(e=>e.projectId)??[],onProjectSelected:e=>{f(e)},resource:s??void 0,resourceTitle:(0,g.getResourceTitleByResource)(s),selectedProject:p}),backOrCancelLabel:"Cancel",onBack:l,onClickOutside:l,onConnectionCreated:a,project:p,resourceId:d,store:s,title:w.CONNECT_PROJECT_LABEL})})}function _(e){let{resource:i}=e,{onClose:r,onBack:s,state:l,onResourceUpdated:o}=(0,y.useResourceModalsContext)(),{type:a}=i,{projectSlug:c}=(0,N.useProjectSlug)(),d=(0,m.useProject)(c),u=(0,n.useCallback)(()=>{o({resource:i,isConnected:!0})},[o,i]);return l.type!==C.ResourceModalsActionTypes.CreateEnvs||"integration"!==a?null:(0,t.jsx)(G,{backOrCancelLabel:l.backOrCancelLabel,onBack:s,onClickOutside:r,onConnectionCreated:u,project:d.data,resourceId:i.id,store:i,subtitle:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-center gap-1.5 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"Connect to"}),(0,t.jsx)(b.ProductIcon,{icon:i.product.iconUrl,size:"small"}),(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-gray-1000",children:i.name})]}),title:`Configure ${d.data?.name??""}`})}function H(e){let{active:n,store:r,connection:s,resourceId:l,onClickOutside:o,onAnimationDone:a,onConnectionCreated:c}=e,d=(0,m.useProject)(s.projectId);return"integration"!==r.type?null:(0,t.jsx)(i.Modal.Modal,{active:n,allowOverflow:!0,onAnimationDone:a,onClickOutside:o,width:540,children:(0,t.jsx)(G,{backOrCancelLabel:"Cancel",connection:s,onBack:o,onClickOutside:o,onConnectionCreated:c,project:d.data,resourceId:l,store:r,subtitle:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-center gap-1.5 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"Connect to"}),(0,t.jsx)(b.ProductIcon,{icon:r.product.iconUrl,size:"small"}),(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-gray-1000",children:r.name})]}),title:`Configure ${d.data?.name??""}`})})}e.s(["ConnectResourceForCurrentProjectStep",()=>_,"CreateResourceConnectionModal",()=>Z,"CreateResourceConnectionModalStep",()=>G,"UpdateResourceConnectionModal",()=>H],7137779);var K=e.i(7722264),Q=e.i(3703009),X=e.i(5098510);function Y(e){let{active:l,onClickOutside:o,connections:a,onAnimationDone:c,resourceId:d,resource:u}=e,{removeConnections:x}=(0,v.useResourceConnection)(),[p,m]=(0,n.useState)(!1),[f,g]=(0,n.useState)(null),j=(0,r.useToasts)(),h=(0,n.useCallback)(async e=>{e.preventDefault(),g(null),m(!0);try{await x({connectionIds:a.map(e=>e.id),resourceId:d}),m(!1),o()}catch(e){m(!1),(0,K.isError)(e)?g(e):j.error(`Unexpected error while removing the ${u?.name||"resource"} connection`)}},[x,a,d,o,j,u]),y=a.some(e=>(0,w.isLogDrainInConnection)(e));return(0,t.jsx)(i.Modal.Modal,{active:l,onAnimationDone:c,onClickOutside:o,children:(0,t.jsxs)("form",{onSubmit:e=>void h(e),children:[(0,t.jsx)(i.Modal.Body,{children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-6 flex-initial",children:[(0,t.jsxs)(i.Modal.Title,{center:!1,children:["Remove"," ",y?"Project Connection & Log Drain":"Project Connection"]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-6 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14",children:"Are you sure you want to remove this project connection?"}),(0,t.jsxs)("p",{className:"text-copy-14",children:["Removing the connection will delete the associated environment variables from the project and future deployments will not be able to access"," ",u?.name?(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"inline-block align-bottom",children:(0,t.jsx)(Q.StoreIconOrAvatar,{icon:"integration"===u.type?u.product.integration.icon:void 0,size:"small",type:u.type})})," ",(0,t.jsx)("span",{className:"align-bottom font-semibold",children:u.name})]}):"this resource","."]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-3 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"Projects"}),(0,t.jsx)(X.ProjectConnectionsListInModal,{connections:a})]}),f?(0,t.jsx)(s.Error,{children:f.message}):null]})]})}),(0,t.jsxs)(i.Modal.Actions,{children:[(0,t.jsx)(i.Modal.Action,{disabled:p,onClick:o,type:"secondary",children:"Cancel"}),(0,t.jsx)(i.Modal.Action,{buttonType:"submit",disabled:p,loading:p,children:1===a.length?"Remove Connection":`Remove ${a.length} Connections`})]})]})})}e.s(["DeleteStoreConnectionModal",()=>Y],2483721)}]);

//# debugId=9304f90a-d1e6-7f8e-b694-9e046becd5b3
//# sourceMappingURL=21b9bf869b96484a.js.map