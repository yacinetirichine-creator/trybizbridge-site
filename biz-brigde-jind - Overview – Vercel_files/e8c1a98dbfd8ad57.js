;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="892364c7-3c16-5a7c-46b4-1a62645673d0")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,7849701,e=>{"use strict";var t=e.i(1146226),a=e.i(5169864),l=e.i(5610834),s=e.i(4141852),i=e.i(1829577),n=e.i(6990755),r=e.i(3169345),o=e.i(5255926),c=e.i(3306538),d=e.i(8835183),m=e.i(6850581),u=e.i(7087273),x=e.i(6143247),h=e.i(161312),p=e.i(7797615),f=e.i(1460262);function g(){let{startTime:e,endTime:g,disableRowClick:j=!1,hosts:y}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[b,v]=(0,a.useState)(""),w=(0,l.useRouter)(),N=(0,l.useParams)(),T=N?.teamSlug,S=N?.project,A=e=>{let t=new URL(window.location.href);t.searchParams.set("eventIp",e.clientIp),t.searchParams.set("eventHost",e.hostname),e.wafAction&&t.searchParams.set("eventAction",e.wafAction),e.actionType&&t.searchParams.set("eventActionType",e.actionType),t.searchParams.set("eventStart",e.startTime),t.searchParams.set("eventEnd",e.endTime),w.push(`/${T}/${S}/firewall?${t.searchParams.toString()}`)},C=(0,a.useMemo)(()=>e?e.getTime():void 0,[e]),k=(0,a.useMemo)(()=>g?g.getTime():void 0,[g]),{data:_,isLoading:R,error:I}=(0,f.useFirewallEvents)({teamId:T,projectId:S,startTime:C,endTime:k,hosts:y}),D=(0,a.useMemo)(()=>_?.actions?_.actions.map(e=>({startTime:e.startTime,endTime:e.endTime,clientIp:e.public_ip,hostname:e.host,actionType:"system-action"===e.action_type?"System Rule":"Customer Rule",wafAction:e.action,count:e.count,isRedacted:"***"===e.public_ip||"***"===e.host||"***"===e.action})):[],[_]),L=(0,a.useMemo)(()=>b?D.filter(e=>e.clientIp.toLowerCase().includes(b.toLowerCase())):D,[D,b]),P=(0,a.useMemo)(()=>D.slice(0,6),[D]),B=e=>"deny"===e?"red-subtle":"amber-subtle",M=e=>"deny"===e?(0,t.jsx)(s.FirewallFlame,{}):(0,t.jsx)(i.FirewallCheck,{});return(0,t.jsxs)(h.ExpandablePanel,{children:[(0,t.jsx)(u.Scroller,{overflow:"x",children:(0,t.jsxs)("div",{className:"min-w-[800px]",children:[(0,t.jsx)("div",{className:"px-4 py-3 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex font-medium text-label-14",children:[(0,t.jsx)("div",{className:"w-[16.66%]",children:"Events"}),(0,t.jsx)("div",{className:"w-[16.66%] pl-2",children:"Action"}),(0,t.jsx)("div",{className:"w-[20%] pl-1",children:"Hostname"}),(0,t.jsx)("div",{className:"w-[20%] pl-2",children:"IP Address"}),(0,t.jsx)("div",{className:"w-[24.34%] pl-2",children:"Start"}),(0,t.jsx)("div",{className:"w-[12.32%] text-right",children:"Requests"})]})}),!R&&_&&P.length>0&&(0,t.jsx)("div",{className:"p-2",children:(0,t.jsxs)(r.Table,{className:"table-fixed w-full",children:[(0,t.jsxs)("colgroup",{children:[(0,t.jsx)("col",{className:"w-[16.66%]"}),(0,t.jsx)("col",{className:"w-[16.66%]"}),(0,t.jsx)("col",{className:"w-[20%]"}),(0,t.jsx)("col",{className:"w-[20%]"}),(0,t.jsx)("col",{className:"w-[24.34%]"}),(0,t.jsx)("col",{className:"w-[12.32%]"})]}),(0,t.jsx)(r.Table.Body,{striped:!0,children:P.map((e,a)=>(0,t.jsxs)(r.Table.Row,{onClick:j||e.isRedacted?void 0:()=>A(e),className:(0,x.cn)(!j&&!e.isRedacted&&"cursor-pointer hover:!bg-gray-100",e.isRedacted&&"blur-sm pointer-events-none select-none"),children:[(0,t.jsx)(r.Table.Cell,{className:"p-2",children:(0,t.jsx)("p",{className:"text-label-14",children:e.actionType})}),(0,t.jsx)(r.Table.Cell,{className:"p-2",children:e.wafAction&&(0,t.jsx)(c.Badge,{size:"md",icon:M(e.wafAction),variant:B(e.wafAction),children:e.wafAction})}),(0,t.jsx)(r.Table.Cell,{className:"p-2 truncate",children:(0,t.jsx)("p",{className:"text-label-14 truncate",children:e.hostname})}),(0,t.jsx)(r.Table.Cell,{className:"p-2",children:(0,t.jsx)("p",{className:"text-label-14",children:e.clientIp})}),(0,t.jsx)(r.Table.Cell,{className:"p-2",children:(0,t.jsx)(m.RelativeTimeCard,{date:new Date(`${e.startTime}Z`).getTime(),side:"bottom",children:(0,t.jsx)("p",{className:"text-label-14",children:new Date(`${e.startTime}Z`).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})})})}),(0,t.jsx)(r.Table.Cell,{className:"p-2",children:(0,t.jsx)("p",{className:"text-label-14",children:(0,p.formatNumberCompact)(e.count)})})]},`${e.clientIp}-${e.wafAction}-${e.hostname}-${a}`))})]})})]})}),!_&&R?(0,t.jsx)("div",{className:"p-2 h-[248px]",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.Skeleton,{height:32,width:"100%"}),(0,t.jsx)(o.Skeleton,{height:32,width:"100%"}),(0,t.jsx)(o.Skeleton,{height:32,width:"100%"}),(0,t.jsx)(o.Skeleton,{height:32,width:"100%"}),(0,t.jsx)(o.Skeleton,{height:32,width:"100%"}),(0,t.jsx)(o.Skeleton,{height:32,width:"100%"})]})}):I?(0,t.jsx)("div",{className:"h-[248px] flex items-center justify-center",children:(0,t.jsx)("p",{className:"text-label-14 text-red-600",children:"Failed to load firewall events"})}):0===D.length?(0,t.jsx)("div",{className:"flex flex-row items-center justify-center h-[248px] w-full",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"rounded-md border border-gray-200 p-2",children:(0,t.jsx)(s.FirewallFlame,{color:"gray-800"})}),(0,t.jsx)("p",{className:"text-label-14 text-gray-700",children:"There are no active firewall events"})]})}):null,!R&&D.length>6&&(0,t.jsx)(h.ExpandablePanel.Footer,{children:(0,t.jsx)(h.ExpandablePanel.Expand,{icon:(0,t.jsx)(n.ArrowUpDiagonalScale,{})})}),(0,t.jsx)(h.ExpandablePanel.Expanded,{disableFocusTrap:!0,children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(d.SearchInput,{placeholder:"Search by IP address",value:b,onChange:e=>v(e.target.value),className:"max-w-sm"})}),(0,t.jsx)(u.Scroller,{overflow:"x",children:(0,t.jsxs)(r.Table,{className:"min-w-[800px] table-fixed w-full",children:[(0,t.jsxs)("colgroup",{children:[(0,t.jsx)("col",{className:"w-[16.66%]"}),(0,t.jsx)("col",{className:"w-[16.66%]"}),(0,t.jsx)("col",{className:"w-[20%]"}),(0,t.jsx)("col",{className:"w-[20%]"}),(0,t.jsx)("col",{className:"w-[24.34%]"}),(0,t.jsx)("col",{className:"w-[12.32%]"})]}),(0,t.jsx)(r.Table.Header,{children:(0,t.jsxs)(r.Table.Row,{children:[(0,t.jsx)(r.Table.Cell,{children:"Events"}),(0,t.jsx)(r.Table.Cell,{children:"Action"}),(0,t.jsx)(r.Table.Cell,{children:"Hostname"}),(0,t.jsx)(r.Table.Cell,{children:"IP Address"}),(0,t.jsx)(r.Table.Cell,{children:"Start"}),(0,t.jsx)(r.Table.Cell,{children:"Requests"})]})}),(0,t.jsx)(r.Table.Body,{striped:!0,children:L.map((e,a)=>(0,t.jsxs)(r.Table.Row,{onClick:j||e.isRedacted?void 0:()=>A(e),className:(0,x.cn)(!j&&!e.isRedacted&&"cursor-pointer hover:!bg-gray-100",e.isRedacted&&"blur-sm pointer-events-none select-none"),children:[(0,t.jsx)(r.Table.Cell,{className:"p-2",children:(0,t.jsx)("p",{className:"text-label-14",children:e.actionType})}),(0,t.jsx)(r.Table.Cell,{className:"p-2",children:e.wafAction&&(0,t.jsx)(c.Badge,{icon:M(e.wafAction),variant:B(e.wafAction),children:e.wafAction})}),(0,t.jsx)(r.Table.Cell,{className:"p-2 truncate",children:(0,t.jsx)("p",{className:"text-label-14 truncate",children:e.hostname})}),(0,t.jsx)(r.Table.Cell,{className:"p-2",children:(0,t.jsx)("p",{className:"text-label-14",children:e.clientIp})}),(0,t.jsx)(r.Table.Cell,{className:"p-2",children:(0,t.jsx)(m.RelativeTimeCard,{date:new Date(`${e.startTime}Z`).getTime(),side:"bottom",children:(0,t.jsx)("p",{className:"text-label-14",children:new Date(`${e.startTime}Z`).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})})})}),(0,t.jsx)(r.Table.Cell,{className:"p-2",children:(0,t.jsx)("p",{className:"text-label-14",children:(0,p.formatNumberCompact)(e.count)})})]},`${e.clientIp}-${e.wafAction}-${e.hostname}-${a}`))})]})})]})})]})}e.s(["FirewallEventsTable",()=>g])},5597167,e=>{"use strict";var t=e.i(1146226),a=e.i(4597921),l=e.i(5338940),s=e.i(4004502),i=e.i(3748432),n=e.i(5610834),r=e.i(5169864),o=e.i(7950227),c=e.i(7527548),d=e.i(6990755),m=e.i(5797774),u=e.i(192211),x=e.i(9961052),h=e.i(8618366);function p(e){let{teamIdOrSlug:a,projectIdOrName:l,useBotIdData:s=!1}=e;return(0,t.jsx)(h.GroupedSparklinePanel,{teamIdOrSlug:a,projectIdOrName:l,config:s?{event:"botIdCheck",filter:"",groupBy:["clientIp","clientIpCountry","asnName","asnId"],reason:"firewall_tab",collapsedRows:6,header:"Top Client IPs",emptyStateMessage:"There are no client IPs",emptyStateIcon:(0,t.jsx)(c.NetworkDevice,{}),expandIcon:(0,t.jsx)(d.ArrowUpDiagonalScale,{}),renderRowLabel:e=>{let a=e.clientIpCountry?.toUpperCase(),l=a?x.countriesByAlpha2[a]:void 0,s=Array.isArray(l)?l[0]:l||a,i=a?x.flagsByAlpha2[a]:void 0,n=(0,t.jsxs)("div",{className:"flex w-[250px] flex-col",children:[(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("p",{className:"text-heading-14 font-medium mb-3",children:["Details for ",e.clientIp]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-baseline justify-between gap-6",children:[(0,t.jsx)("p",{className:"text-label-13 shrink-0",children:"AS Name"}),(0,t.jsx)("p",{className:"text-label-13 text-gray-800 text-right",children:e.asnName||"N/A"})]}),(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-baseline justify-between gap-6",children:[(0,t.jsx)("p",{className:"text-label-13",children:"AS Number"}),(0,t.jsx)("p",{className:"text-label-13 text-gray-800",children:e.asnId||"N/A"})]})]})]}),s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Divider,{}),(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)("p",{className:"text-label-13",children:[i,s].filter(Boolean).join(" ")})})]}):null]});return(0,t.jsx)(m.ContextCard.Trigger,{content:n,noPadding:!0,children:(0,t.jsxs)("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.clientIpCountry&&(0,t.jsx)(o.Flag,{countryCode:e.clientIpCountry}),(0,t.jsx)("span",{className:"truncate",title:e.clientIp,children:e.clientIp})]})})},getRowKey:e=>e.clientIp,getCopyValue:e=>e.clientIp,enrichRow:(e,t)=>{let{teamIdOrSlug:a,projectIdOrName:l,startTime:s,endTime:i}=t;return{queryLink:(0,h.computeQueryLink)({event:"botIdCheck",filter:`clientIp eq '${e.clientIp}'`,groupBy:["clientIp"],teamIdOrSlug:a,projectIdOrName:l,startTime:s,endTime:i})}},menuActions:[]}:{event:"blockedConnection",filter:"wafAction eq 'deny' and wafRuleId eq 'sys_dos_mitigation'",groupBy:["clientIp","clientIpCountry","asnName","asnId"],reason:"firewall_tab",collapsedRows:6,header:"Denied IPs",emptyStateMessage:"There are no denied IP addresses",emptyStateIcon:(0,t.jsx)(c.NetworkDevice,{}),expandIcon:(0,t.jsx)(d.ArrowUpDiagonalScale,{}),renderRowLabel:e=>{let a=e.clientIpCountry?.toUpperCase(),l=a?x.countriesByAlpha2[a]:void 0,s=Array.isArray(l)?l[0]:l||a,i=a?x.flagsByAlpha2[a]:void 0,n=(0,t.jsxs)("div",{className:"flex w-[250px] flex-col",children:[(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("p",{className:"text-heading-14 font-medium mb-3",children:["Details for ",e.clientIp]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-baseline justify-between gap-6",children:[(0,t.jsx)("p",{className:"text-label-13 shrink-0",children:"AS Name"}),(0,t.jsx)("p",{className:"text-label-13 text-gray-800 text-right",children:e.asnName||"N/A"})]}),(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-baseline justify-between gap-6",children:[(0,t.jsx)("p",{className:"text-label-13",children:"AS Number"}),(0,t.jsx)("p",{className:"text-label-13 text-gray-800",children:e.asnId||"N/A"})]})]})]}),s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Divider,{}),(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)("p",{className:"text-label-13",children:[i,s].filter(Boolean).join(" ")})})]}):null]});return(0,t.jsx)(m.ContextCard.Trigger,{content:n,noPadding:!0,children:(0,t.jsxs)("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.clientIpCountry&&(0,t.jsx)(o.Flag,{countryCode:e.clientIpCountry}),(0,t.jsx)("span",{className:"truncate",title:e.clientIp,children:e.clientIp})]})})},getRowKey:e=>e.clientIp,getCopyValue:e=>e.clientIp,enrichRow:(e,t)=>{let{teamIdOrSlug:a,projectIdOrName:l,startTime:s,endTime:i}=t;return{queryLink:(0,h.computeQueryLink)({event:"blockedConnection",filter:`clientIp eq '${e.clientIp}' and wafAction eq 'deny' and wafRuleId eq 'sys_dos_mitigation'`,groupBy:["clientIp"],teamIdOrSlug:a,projectIdOrName:l,startTime:s,endTime:i}),configureLink:`/${a}/${l}/firewall/configure/bypass/new?ip=${e.clientIp}&domain=%2A`}},menuActions:[{label:"Create System Bypass",href:e=>e.configureLink}]},className:"h-full"})}var f=e.i(7808299),g=e.i(5467025),j=e.i(6060673),y=e.i(8708663),b=e.i(8674454),v=e.i(6694387),w=e.i(5257834),N=e.i(4991687),T=e.i(8459493),S=e.i(5255926),A=e.i(8835183),C=e.i(3306538),k=e.i(9334638);let _=(0,k.withNewIcon)(`<g clip-path="url(#clip0_4628_1818)">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M15.0932 7.64904C14.8377 3.56123 11.3168 0.454519 7.22898 0.710006C5.45234 0.821046 3.8593 1.54996 2.64882 2.67365L3.66933 3.77299C4.63533 2.87625 5.90403 2.29574 7.32254 2.20709C10.5835 2.00327 13.3923 4.48161 13.5961 7.74261C13.663 8.81244 14.0605 10.1035 15.1336 10.8299L15.9745 9.58773C15.4544 9.23567 15.1467 8.50463 15.0932 7.64904ZM1.21934 4.48945C0.544864 5.69225 0.197633 7.09732 0.28994 8.57425C0.414316 10.5643 0.700415 12.5343 1.14241 14.4655L2.6046 14.1308C2.1807 12.2786 1.90631 10.3893 1.78702 8.48068C1.71326 7.30048 1.99016 6.18167 2.52767 5.22312L1.21934 4.48945ZM11.9314 8.14996C11.7883 5.86143 9.81714 4.12215 7.5286 4.26518C5.24007 4.40822 3.50079 6.3794 3.64382 8.66793C3.6894 9.3971 3.75974 10.1232 3.85448 10.845L5.34173 10.6498C5.25141 9.9617 5.18435 9.2695 5.1409 8.57437C5.04955 7.11264 6.16045 5.85362 7.62217 5.76226C9.0839 5.67091 10.3429 6.78181 10.4343 8.24353C10.4726 8.85698 10.5332 9.46767 10.6157 10.0745L12.102 9.87246C12.0244 9.30161 11.9674 8.72708 11.9314 8.14996ZM13.0024 13.8749C12.7538 13.0919 12.5457 12.2962 12.379 11.4908L10.9101 11.7947C11.0749 12.5911 11.2779 13.3786 11.5181 14.1546L13.0024 13.8749ZM14.6499 24.8207L10.8508 25.5691C11.9295 25.8912 13.1347 25.7761 14.176 25.1513C14.3437 25.0507 14.5018 24.94 14.6499 24.8207ZM4.79771 15.421C4.62667 14.8172 4.47329 14.2083 4.33781 13.5951C4.27053 13.2906 4.20767 12.985 4.14924 12.6784L5.62272 12.3976C5.67842 12.6899 5.73835 12.9812 5.80249 13.2715C5.94137 13.9001 6.09998 14.5239 6.27803 15.142L4.79771 15.421ZM8.11677 14.7955L8.0783 14.6651L8.0775 14.6624C7.46325 12.5503 7.08106 10.3695 6.94287 8.1585C6.91703 7.7451 7.23122 7.38902 7.64463 7.36318C8.05803 7.33734 8.41411 7.65153 8.43995 8.06494C8.57119 10.1649 8.93413 12.2361 9.51744 14.2421L9.51783 14.2435L9.5983 14.5164L8.11677 14.7955Z" fill="currentColor" />
  </g>
  <defs>
  <clipPath id="clip0_4628_1818">
  <rect width="16" height="16" fill="white" style="fill:white;fill-opacity:1;"/>
  </clipPath>
  </defs>`);var R=e.i(6675233),I=e.i(8876434),D=e.i(6198010),L=e.i(5169576),P=e.i(9339975),B=e.i(1637579),M=e.i(9722978),F=e.i(57106),$=e.i(1717203),E=e.i(7557283),O=e.i(161312),q=e.i(3863657),H=e.i(594750),U=e.i(3538015),Z=e.i(1496379),z=e.i(5963711),Q=e.i(9943777),G=e.i(421794),V=e.i(6891161),W=e.i(5433449);function K(e){let{isOpen:a,onClose:l}=e;return(0,t.jsxs)(V.Modal.Modal,{active:a,onClickOutside:l,children:[(0,t.jsxs)(V.Modal.Body,{children:[(0,t.jsxs)(V.Modal.Header,{children:[(0,t.jsx)(V.Modal.Title,{children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:[(0,t.jsx)(W.FileText,{size:20}),"Deployment Rules"]})}),(0,t.jsxs)(V.Modal.Subtitle,{children:["Rules defined in ",(0,t.jsx)("code",{children:"vercel.json"})," files, created at build time."]})]}),(0,t.jsxs)(V.Modal.P,{children:["Deployment rules are firewall rules that are automatically created from your project's ",(0,t.jsx)("code",{children:"vercel.json"})," configuration file. They are generated at build time and run at the edge before your application code executes to protect your deployment."]}),(0,t.jsxs)(V.Modal.P,{children:["Each action type is shown separately and these rules are automatically generated from your ",(0,t.jsx)("code",{children:"vercel.json"}),"."]}),(0,t.jsxs)(V.Modal.P,{children:["Learn more about configuring deployment rules in"," ",(0,t.jsx)(F.Link,{href:"/docs/project-configuration",target:"_blank",external:!0,variant:"highlight",children:"project configuration"})," ","or read about the"," ",(0,t.jsx)(F.Link,{href:"/docs/vercel-firewall",target:"_blank",external:!0,variant:"highlight",children:"Vercel firewall"}),"."]})]}),(0,t.jsx)(V.Modal.Actions,{children:(0,t.jsx)(V.Modal.Action,{onClick:l,type:"secondary",children:"Close"})})]})}function J(e){let{config:a,project:l,rulesets:s}=e,{hoveredTimestamp:i}=(0,g.useObservabilityChartContext)(),[o,c,d]=(0,Z.useToolbarState)(),{maxByKeys:m,allData:u}=(0,y.useVisualizationContext)(),x=(0,n.useParams)(),h=function(e,t){let[a,l]=(0,r.useState)(el(e,t)),s=(0,r.useRef)(el(e,t));return(0,r.useEffect)(()=>{let a=performance.now(),i=el(e,t),n=s.current,r=n.length===i.length,o=0,c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now(),t=Math.sin(Math.min((e-a)/100,1))*Math.PI*.5;if(!r||t>=1){l(i),Object.assign(n,i);return}o=requestAnimationFrame(c);let s=Array(i.length);for(let e=i.length;e--;){let a=i[e],l=n[e];s[e]={name:a.name,total:a.total,value:es(l.value,a.value,t),ratio:es(l.ratio,a.ratio,t)}}l(s)};return c(),()=>{cancelAnimationFrame(o),l(a=>(Object.assign(n,a),el(e,t)))}},[e,t]),a}(m,(0,r.useMemo)(()=>{if(i)return Object.fromEntries(u.filter(e=>e.date.getTime()===i.getTime()).map(e=>[e.key,e.value]))},[i,u])),p=(0,r.useCallback)(e=>{let t="all_rules"===o.filter;if("BotID"===o.filter)return`/${x?.teamSlug}/${x?.project}/observability?builder=true&${new URLSearchParams({time:"1d",metric:"botIdCheck.count",by:"botCheckResult",aggregate:"sum"}).toString()}`;let a=(0,z.wafRuleId)(t?e:o.filter),s={time:"1d",by:"wafAction",filter:[l?.id&&`projectId eq '${l.id}'`,`wafRuleId eq '${a}'`].filter(e=>!!e).join(" and "),aggregate:"sum"};(0,U.isLimitedSystemRule)(a)?(s.metric="blockedConnection.count","clientIp"===o.groupBy&&(s.by="clientIp",s.where=`clientIp eq '${e}'`)):(s.metric="incomingRequest.count",t||(s.filter=[s.filter,`${o.groupBy} eq '${e}'`].join(" and ")));let i=new URLSearchParams(s);return`/${x?.teamSlug}/${x?.project}/observability?builder=true&${i.toString()}`},[x,l?.id,o.filter,o.groupBy]),f=(0,r.useCallback)(e=>{let t,a,[l]=e.split(q.SEPARATOR);switch(o.groupBy){case"clientIp":t="ip_address",a="IP Address";break;case"clientIpCountry":t="geo_country",a="Country";break;case"clientAsn":t="geo_as_number",a="ASN";break;case"requestPath":t="path",a="Request Path";break;case"edgeNetworkRegion":t="region",a="Vercel Region";break;case"clientUserAgent":t="user_agent",a="User Agent";break;case"sourcePath":t="target_path",a="Route";break;case"clientJa4Digest":t="ja4_digest",a="JA4";break;case"requestHostname":t="host",a="Host";break;default:return null}let s=[{conditions:[{type:t,op:"eq",value:l}]}],i=l;i&&i.length>60&&(i=i.slice(0,60));let n=JSON.stringify({name:`Rule for ${a}: ${i}`,description:`Automatically created from firewall table for ${a} ${i}`,conditionGroup:s,active:!0,action:{mitigate:{action:"log"}}}),r=(0,Q.getRuleTemplateSignature)(n),c=new URLSearchParams({template:n,sig:r});return`/${x?.teamSlug}/${x?.project}/firewall/configure/rule/new?${c.toString()}`},[x?.teamSlug,x?.project,o.groupBy]),j=Object.fromEntries(Object.entries((0,r.useMemo)(()=>"all_rules"===o.filter?"group_by_category"===o.groupBy?h.reduce((e,t)=>{let[a,l]=t.name.split(q.SEPARATOR),s=U.ruleToMappings[a];if(s?.groupBy){let a=e[s.groupBy];a?a.push(t):a=[t],e[s.groupBy]=a}else(0,z.isCustomRuleId)(a)?e["Custom Rules"].push(t):t.value>0&&e.System.push(t);return e},{System:[],"Custom Rules":[]}):h.reduce((e,t)=>{let[,a]=t.name.split(q.SEPARATOR),l=(0,z.formatFirewallActionForDisplay)(a),s=e[l];return s?s.push(t):s=[t],e[l]=s,e},{}):{[o.groupBy]:h},[h,o.filter,o.groupBy])).filter(e=>{let[,t]=e;return t.length>0}));return(0,t.jsx)("div",{className:(0,M.clsx)("grid w-full grid-cols-1 gap-3",{"@lg-page:grid-cols-2":Object.keys(j).length>1}),children:Object.entries(j).map(e=>{let[l,i]=e;return(0,t.jsx)(Y,{config:a,createMonitoringSearchParams:p,createRuleBuilderLink:f,header:l,params:x,rulesets:s,segment:i,toolbarState:o,ruleOptions:d},l)})})}function Y(e){let{config:a,header:l,rulesets:s,segment:i,toolbarState:n,ruleOptions:o,createMonitoringSearchParams:c,createRuleBuilderLink:d,params:m}=e,[u,x]=(0,r.useState)(""),[h,p]=(0,r.useState)(!1),f=ea(a,s,n),g=i;u&&(g=g.filter(e=>{let{label:t,suffix:a}=f(e.name);return t.toLowerCase().includes(u.toLowerCase())||a?.toLowerCase().includes(u.toLowerCase())}));let j=e=>{let t=e.name.replace(/\$\$.*/,""),l=a?.ruleMap.get(t),i=a?.ruleMap.get(t)?.type==="custom_rule";return{config:a,createMonitoringSearchParams:c,createRuleBuilderLink:d,fieldId:t,isCustomRule:i,params:m,point:e,ruleFields:l,rulesets:s,toolbarState:n,onDeploymentRuleInfoClick:()=>{p(!0)}}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(O.ExpandablePanel,{children:[(0,t.jsxs)(O.ExpandablePanel.Header,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)("p",{className:"text-label-14 font-medium leading-6",children:(0,z.formatTableHeader)(o,l)}),"Custom Rules"===l?(0,t.jsx)(X,{}):null]}),(0,t.jsx)("div",{className:"p-2 [&>*:nth-child(odd)]:bg-background-200 rounded-md",children:i.slice(0,5).map(e=>(0,t.jsx)(ee,{...j(e)},e.name))}),i.length>5&&(0,t.jsx)(O.ExpandablePanel.Footer,{children:(0,t.jsx)(O.ExpandablePanel.Expand,{})}),(0,t.jsx)(O.ExpandablePanel.Expanded,{disableFocusTrap:!0,children:(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("div",{className:"border-b border-red-100 p-5",children:(0,t.jsx)("p",{className:"text-heading-16 font-medium",children:(0,z.formatTableHeader)(o,l)})}),(0,t.jsx)("div",{className:"px-2",children:(0,t.jsx)(A.SearchInput,{clearable:!1,onChange:e=>x(e.target.value),placeholder:"Search",value:u})}),(0,t.jsx)("div",{className:"p-2",children:g.map(e=>(0,t.jsx)(ee,{...j(e)},e.name))})]})})]}),(0,t.jsx)(K,{isOpen:h,onClose:()=>p(!1)})]})}function X(){let e=(0,n.useParams)(),{isLoading:a,team:s}=(0,l.useTeam)(),{can:i,isLoading:r}=(0,$.default)(),{data:o,isLoading:c}=(0,j.useProject)(e?.project),{config:d,isLoadingConfig:m}=(0,H.useFirewallConfig)({projectId:o?.id});if(r||m||c||a)return(0,t.jsx)(S.Skeleton,{height:24,width:24});let u=i(E.Action.All,E.Resource.SeawallConfig),x=o?.microfrontends!==void 0&&!o.microfrontends.isDefaultApp,h=(0,z.isPlanLimitReached)({config:d,teamPlan:s?.billing?.plan,type:"customRules"});return(0,t.jsx)(F.ButtonLink,{"aria-label":"Add a custom rule",disabled:!u||x||h,href:"firewall/configure/rule/new",size:"tiny",style:{"--height":"24px"},svgOnly:!0,type:"secondary",children:(0,t.jsx)(D.Plus,{})})}function ee(e){let{config:a,createMonitoringSearchParams:l,createRuleBuilderLink:s,fieldId:i,isCustomRule:n,params:r,point:o,ruleFields:c,rulesets:d,toolbarState:m,onDeploymentRuleInfoClick:u}=e,{activeDataKey:x,formatter:h,seriesColor:p,setActiveDataKey:f}=(0,y.useVisualizationContext)(),g=!(0,z.isOthersAggregate)(o.name),j=s(i),S=!(0,z.isOthersAggregate)(o.name)&&null!==j,A=()=>{g&&f(x===o.name?null:o.name)};return(0,t.jsxs)("div",{className:(0,M.clsx)("flex min-h-[36px] flex-1 items-center gap-5 rounded-md p-2",{"transition-colors hover:!bg-gray-100 cursor-pointer":g}),onClick:A,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&A()},role:"button",tabIndex:0,"aria-disabled":!g,children:[(0,t.jsxs)("div",{className:"flex flex-1 items-center gap-2 border-none bg-transparent text-start",children:[(0,t.jsx)("div",{className:"size-[8px] rounded-full",style:{backgroundColor:null!==x&&x!==o.name?"var(--ds-gray-400)":p[o.name]}}),(0,t.jsx)(et,{config:a,disabled:c?.type==="custom_rule"&&!c.active,rulesets:d,toolbarState:m,children:o.name}),(0,t.jsx)("p",{className:"text-label-14 text-gray-900 select-text tabular-nums",children:h(o.value)})]}),(0,t.jsxs)(N.MenuContainer,{position:"bottom-end",children:[(0,t.jsx)(v.MenuButton,{"aria-label":"more menu button",className:"flex max-h-[24px] items-center",shape:"square",size:"small",svgOnly:!0,type:"tertiary",children:(0,t.jsx)(I.MoreHorizontal,{})}),(0,t.jsxs)(b.Menu,{className:"min-w-[180px]",portalClassName:"tailwind-preflight",children:[n?(0,t.jsx)(w.MenuLink,{href:`/${r?.teamSlug}/${r?.project}/firewall/configure/rule/${i}`,target:"_blank",children:(0,t.jsx)("span",{children:"Edit Rule"})}):null,(0,t.jsx)(T.MenuItem,{onClick:e=>{e.stopPropagation();let[t]=o.name.split("$$");navigator.clipboard.writeText(t)},children:(0,t.jsx)("span",{children:"Copy Value"})}),"deployment_defined_rules"===i?(0,t.jsx)(T.MenuItem,{onClick:e=>{e.stopPropagation(),u()},children:(0,t.jsx)("span",{children:"What is this?"})}):null,(0,z.isOthersAggregate)(o.name)?null:(0,t.jsx)(w.MenuLink,{href:l(i),target:"_blank",children:(0,t.jsx)("span",{className:"whitespace-nowrap",children:"Inspect Traffic"})}),S?(0,t.jsx)(w.MenuLink,{href:j,target:"_blank",children:(0,t.jsx)("span",{className:"whitespace-nowrap",children:"Create Custom Rule"})}):null]})]})]})}function et(e){let{children:a,config:l,disabled:s,rulesets:i,toolbarState:n}=e,{context:r,icon:o,label:c,suffix:d}=ea(l,i,n)(a);return(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-center gap-2",children:[(0,t.jsx)(m.ContextCard.Trigger,{content:r??null,noPadding:!0,children:(0,t.jsxs)("p",{className:(0,M.clsx)("text-label-14 font-medium flex items-center gap-2",s?"text-gray-600":"text-gray-1000"),children:[c,d?(0,t.jsx)("span",{className:`text-copy-14 ${s?"text-gray-600":"text-gray-900"}`,children:d}):null,o?(0,t.jsx)("span",{className:`flex items-center ${s?"text-gray-600":"text-gray-900"}`,children:o}):null]})}),s?(0,t.jsx)(C.Badge,{variant:"gray-subtle",children:"Disabled"}):null]})}function ea(e,a,l){return s=>{var i,n;if((0,z.isOthersAggregate)(s))return{label:"Other"};let[r,o,...c]=s.split(q.SEPARATOR);if("clientIp"===l.groupBy){let e=c[2]?.toUpperCase(),a=x.countriesByAlpha2[e],l=Array.isArray(a)?a[0]:a||e,s=x.flagsByAlpha2[e];return{label:r,suffix:(0,z.formatFirewallActionForDisplay)(o),context:(0,t.jsxs)("div",{className:"flex w-[250px] flex-col",children:[(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("p",{className:"text-heading-14 font-medium mb-3",children:["Details for ",r]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-baseline justify-between gap-6",children:[(0,t.jsx)("p",{className:"text-label-13 shrink-0",children:"AS Name"}),(0,t.jsx)("p",{className:"text-label-13 text-gray-800 text-right",children:c[1]||"N/A"})]}),(0,t.jsxs)("div",{className:"flex flex-1 flex-row items-baseline justify-between gap-6",children:[(0,t.jsx)("p",{className:"text-label-13",children:"AS Number"}),(0,t.jsx)("p",{className:"text-label-13 text-gray-800",children:c[0]||"N/A"})]})]})]}),l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Divider,{}),(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)("p",{className:"text-label-13",children:[s,l].filter(Boolean).join(" ")})})]}):null]})}}if("clientIpCountry"===l.groupBy){let e=x.countriesByAlpha2[r.toUpperCase()];return{label:Array.isArray(e)?e[0]:e||s,suffix:(0,z.formatFirewallActionForDisplay)(o)}}if("clientUserAgent"===l.groupBy&&(0,G.isBotProtectionData)(l.filter)&&(i=r,ei.some(e=>!(!e.must_contain.every(e=>i.includes(e))||e.must_not_contain&&e.must_not_contain.some(e=>i.includes(e)))&&!0)))return{label:r,suffix:(0,z.formatFirewallActionForDisplay)(o),icon:(0,t.jsx)(L.Information,{size:14,className:"flex-none"}),context:(0,t.jsx)("div",{className:"flex w-[250px] flex-col",children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("p",{className:"text-heading-14 font-medium mb-3 flex items-center gap-1",children:[(0,t.jsx)(R.Robot,{className:"flex-none"})," Spoofed or malicious traffic"]}),(0,t.jsxs)("p",{className:"text-label-13",children:["These requests claimed to be from a legitimate bot but were flagged because they failed our"," ",(0,t.jsx)(F.Link,{external:!0,href:"/docs/bot-management#verified-bots",isDifferentZone:!0,variant:"highlight",children:"verification"})]})]})})};if("clientUserAgent"===l.groupBy&&(0,G.isBotProtectionData)(l.filter)&&(n=r).startsWith("Mozilla/")&&!n.includes("Headless")&&!n.includes("bot")&&!n.includes("Bot"))return{label:r,suffix:(0,z.formatFirewallActionForDisplay)(o),icon:(0,t.jsx)(L.Information,{size:14,className:"flex-none"}),context:(0,t.jsx)("div",{className:"flex w-[250px] flex-col",children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("p",{className:"text-heading-14 font-medium mb-3 flex items-center gap-1",children:[(0,t.jsx)(_,{className:"flex-none"})," Likely non-browser traffic"]}),(0,t.jsxs)("p",{className:"text-label-13",children:["These requests use browser User-Agents but their HTTP and TLS"," ",(0,t.jsx)(F.Link,{external:!0,href:"/docs/bot-management#bot-protection-managed-ruleset",isDifferentZone:!0,variant:"highlight",children:"fingerprints"})," ","do not match actual browser behavior"]})]})})};if("clientUserAgent"===l.groupBy)return{label:r,suffix:(0,z.formatFirewallActionForDisplay)(o),context:(0,t.jsx)(P.UserAgentDetailCard,{value:r,hideUnknowns:!0})};if("edgeNetworkRegion"===l.groupBy){let e=B.regions[r];return e?{label:e.name,suffix:e.providerRegion}:{label:s,suffix:(0,z.formatFirewallActionForDisplay)(o)}}if("wafRuleId"===l.groupBy||"all_rules"===l.filter){if(r.startsWith("managed_")){let[e,t]=r.split("managed_"),l=(0,G.getRulesetFromRulesets)(a,t);if(l)return{label:l.name,suffix:(0,z.formatFirewallActionForDisplay)(o)}}let t=[];e&&(t.push(...e.rules),t.push(...e.crsRules),t.push(...e.currentConfig.ips.map(e=>({id:e.id,name:`IP Block ${"*"===e.hostname?"":e.hostname} ${e.ip}`}))));let l=t.find(e=>e.id===r);if(l)return{label:l.name,suffix:(0,z.formatFirewallActionForDisplay)(o)};let s=U.ruleToMappings[r];if(s)return{label:s.label,suffix:(0,z.formatFirewallActionForDisplay)(o)};if("deployment_rules"===r)return{label:"Deployment Rules",suffix:(0,z.formatFirewallActionForDisplay)(o)};if("deployment_defined_rules"===r)return{label:"Deployment Defined Rules",suffix:(0,z.formatFirewallActionForDisplay)(o)}}return"BotID"===l.filter?{label:r}:{label:r,suffix:(0,z.formatFirewallActionForDisplay)(o)}}}function el(e,t){let a=0;return Object.entries(e).map(e=>{let[l,s]=e,i=s;return void 0!==t?.[l]&&(i=t[l]),a+=i,{name:l,value:i,total:s,ratio:0}}).sort((e,t)=>(0,z.isOthersAggregate)(e.name)?1:(0,z.isOthersAggregate)(t.name)?-1:t.total-e.total).map(e=>({name:e.name,value:e.value,ratio:e.value/Math.max(a,1)*100,total:e.total}))}function es(e,t,a){if(null===e)return t;let l=e||0;return Math.max(0,l+(t-l)*a)}let ei=[{must_contain:["Googlebot"]},{must_contain:["bingbot/2.0"]},{must_contain:["DuckDuckBot"]},{must_contain:["DuckAssistBot"]},{must_contain:["YandexBot"]},{must_contain:["Applebot"]},{must_contain:["AhrefsBot"]},{must_contain:["AhrefsSiteAudit"]},{must_contain:["SemrushBot"]},{must_contain:["SiteAuditBot"]},{must_contain:["SplitSignalBot"]},{must_contain:["BacklinksExtendedBot"]},{must_contain:["ImagesiftBot"]},{must_contain:["GPTBot"]},{must_contain:["Claude-Web"]},{must_contain:["Claude-Search"]},{must_contain:["PerplexityBot"]},{must_contain:["OAI-SearchBot"]},{must_contain:["AlgoliaBot"]},{must_contain:["AdsBot-Google"]},{must_contain:["Mediapartners-Google"]},{must_contain:["APIs-Google"]},{must_contain:["Google-Safety"]},{must_contain:["Google-Site-Verification"]},{must_contain:["Google-InspectionTool"]},{must_contain:["Google-Read-Aloud"]},{must_contain:["Google-PageRenderer"]},{must_contain:["Google-PublisherCenter"]},{must_contain:["Google-Storebot"]},{must_contain:["Google-CloudVertexBot"]},{must_contain:["facebookexternalhit"],must_not_contain:["facebookexternalhit/1.1 Facebot Twitterbot/1.0"]},{must_contain:["facebookcatalog"]},{must_contain:["Twitterbot"],must_not_contain:["facebookexternalhit/1.1 Facebot Twitterbot/1.0"]},{must_contain:["LinkedInBot"]},{must_contain:["http://www.pinterest.com/bot.html"]},{must_contain:["meta-externalfetcher"]},{must_contain:["meta-externalagent"]},{must_contain:["UptimeRobot"]},{must_contain:["Pingdom"]},{must_contain:["Site24x7"]},{must_contain:["Better Uptime Bot"]},{must_contain:["Datadog/Synthetics"]},{must_contain:["SentryUptimeBot"]},{must_contain:["HetrixTools Uptime Monitoring Bot"]},{must_contain:["StatusCake"]},{must_contain:["Checkly"]},{must_contain:["Hydrozen.io"]},{must_contain:["ChatGPT-User"]},{must_contain:["Perplexity-User"]},{must_contain:["Stripe/"]},{must_contain:["PayPal"]},{must_contain:["GitHub-Hookshot"]},{must_contain:["GitHub-Camo"]},{must_contain:["Amazon-Route53-Health-Check"]},{must_contain:["amazonbot"]},{must_contain:["Amazon-Q"]},{must_contain:["Amazon-Kendra"]},{must_contain:["Cookiebot"]},{must_contain:["lumar.io"]},{must_contain:["deepcrawl.com"]},{must_contain:["inngest.com"]},{must_contain:["hookdeck.com"]},{must_contain:["qstash.com"]},{must_contain:["svix.com"]},{must_contain:["v0.dev"]},{must_contain:["Vercel Screenshot"]},{must_contain:["Vercel Favicon"]},{must_contain:["artemis web reader"]}];var en=e.i(5336094),er=e.i(6143247),eo=e.i(6850581),ec=e.i(2504781),ed=e.i(762945),em=e.i(8761240),eu=e.i(7742669);let ex=(0,k.withNewIcon)('<path d="M8 0C12.4183 0 16 3.58172 16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8C0 3.58172 3.58172 0 8 0ZM5.48242 4.87891V6.37891H8.31055L4.81836 9.87109L5.87891 10.9316L9.37109 7.43945V10.2676H10.8711V5.62891C10.871 5.24067 10.5763 4.92032 10.1982 4.88184L10.1211 4.87891H5.48242Z" fill="currentColor" />');var eh=e.i(8778858),ep=e.i(3707658),ef=e.i(8646915),eg=e.i(4989119),ej=e.i(5760285);e.i(6483798);var ey=e.i(8287059),eb=e.i(9668517);function ev(e){let{teamIdOrSlug:a,projectIdOrName:l,plan:s}=e,{data:i,error:n,isLoading:o}=(0,ef.useAlerts)({alertTypes:eg.FIREWALL_ALERT_TYPES}),{data:c,error:m,isLoading:u}=(0,eh.useAttackHistory)({teamId:a,projectId:l,since:"enterprise"===s?7:1}),x=!s||o||u,h=(0,r.useMemo)(()=>{let e=Date.now()-864e5*("enterprise"===s?7:1);return(c?.anomalies||[]).map(e=>{let t=Object.keys(e.affectedHostMap).reduce((t,a)=>{t.hosts.push(a);let l=e.affectedHostMap[a].ddosAlerts?.["sys_dos_mitigation:challenge"]?.totalReqs||0,s=e.affectedHostMap[a].ddosAlerts?.["sys_dos_mitigation:deny"]?.totalReqs||0;return t.challenged+=l,t.denied+=s,t.count+=l+s,t},{hosts:[],challenged:0,denied:0,count:0});return{id:`${e.ownerId}-${e.projectId}-${e.startTime}`,title:"DDoS Attack",type:"firewall_anomaly",startedAt:e.startTime,resolvedAt:e.endTime||void 0,detectionKey:`firewall_anomaly-${e.ownerId}-${e.projectId}-${e.startTime}`,data:t}}).concat((i?.alerts||[]).filter(t=>!t.resolvedAt||t.resolvedAt>e)).toSorted((e,t)=>!e.resolvedAt&&t.resolvedAt?-1:e.resolvedAt&&!t.resolvedAt?1:t.startedAt-e.startedAt)},[i,c,s]),p=(0,r.useCallback)(()=>(0,t.jsx)(eS,{plan:s}),[s]);return(0,t.jsx)(ep.ListPanel,{items:h||[],itemKey:e=>e.detectionKey,isLoading:x,error:n||m,Header:ew,Row:eN,RowSkeleton:eT,EmptyState:p,expandIcon:(0,t.jsx)(d.ArrowUpDiagonalScale,{})})}function ew(){let e=(0,eb.useTeamSlug)(),l=(0,a.useServerFlag)("show-security-plus",!1);return(0,t.jsxs)(ep.ListPanel.Header,{className:"py-0 text-label-14 font-medium flex flex-row items-center justify-between",children:[(0,t.jsx)("span",{className:"py-3",children:"Alerts"}),l?(0,t.jsxs)(N.MenuContainer,{position:"bottom-end",children:[(0,t.jsx)(v.MenuButton,{"aria-label":"alerts more menu button",className:"flex items-center",shape:"square",size:"small",svgOnly:!0,type:"tertiary",children:(0,t.jsx)(I.MoreHorizontal,{})}),(0,t.jsx)(b.Menu,{className:"min-w-[180px]",portalClassName:"tailwind-preflight",children:(0,t.jsx)(w.MenuLink,{href:`/${e}/~/settings/notifications`,target:"_blank",children:"Configure Notifications"})})]}):null]})}function eN(e){let{id:a,title:l,startedAt:s,resolvedAt:i,data:r}=e,o=(0,n.useRouter)(),c=(0,n.useParams)(),d=c?.teamSlug,m=c?.project,{formatter:u}=(0,y.useVisualizationContext)(),x=function(e){if("type"in e&&"firewall_anomaly"!==e.type&&"path"in e.data){let t=e.data.path;return"string"==typeof t?t:void 0}}(e);return(0,t.jsxs)("div",{onClick:()=>{let e=new URL(window.location.href);e.searchParams.set("alert",a),o.push(`/${d}/${m}/firewall?${e.searchParams.toString()}`)},className:(0,er.cn)("cursor-pointer p-4 py-3 hover:!bg-gray-100 rounded-sm","flex flex-row items-center justify-between p-2 group"),children:[(0,t.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[l,x?(0,t.jsx)("span",{className:"text-label-12 text-slate-500 bg-gray-100 px-1.5 py-0.5 rounded",children:x}):null,(0,t.jsx)(eo.RelativeTimeCard,{date:i||s,side:"bottom",children:(0,t.jsx)("span",{className:"text-label-14 text-gray-700 text-nowrap",children:i?`${(0,ej.formatRelativeTime)(i)} ago`:`Since ${(0,ej.formatRelativeTime)(s)}`})}),(0,t.jsx)(C.Badge,{className:"pl-1 pr-2",icon:i?(0,t.jsx)(em.CheckCircleFill,{color:"gray-800"}):(0,t.jsx)(ed.Warning,{}),variant:i?"gray-subtle":"amber-subtle",children:i?"Resolved":"Active"})]}),(0,t.jsx)("div",{children:(0,t.jsxs)("span",{className:"flex flex-row items-center gap-1 font-medium",children:[" ",i?null:(0,t.jsx)(ex,{color:"red-800",size:12})," ",u(r.count)]})})]})}function eT(){return(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between p-2",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,t.jsx)(S.Skeleton,{height:12,width:16,className:"rounded-xs"}),(0,t.jsx)(S.Skeleton,{width:120})]}),(0,t.jsx)(S.Skeleton,{width:120,className:"ms-auto me-2"}),(0,t.jsx)(I.MoreHorizontal,{color:"gray-600"})]})}function eS(e){let{plan:a}=e,l=(0,ey.useOpenUpgradeModal)();return"hobby"===a?(0,t.jsx)("div",{className:"flex flex-row items-center justify-center p-2 h-[200px] w-full",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("p",{className:"text-label-14 text-gray-700",children:"There are no active alerts"}),(0,t.jsx)(ec.Button,{size:"small",onClick:()=>{l({source:"firewall-alerts-panel"})},children:"Upgrade to Pro"}),(0,t.jsx)("p",{className:"text-label-12 text-gray-600",children:"to see previous alerts"})]})}):(0,t.jsx)("div",{className:"flex flex-row items-center justify-center p-2 h-[200px] w-full",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"rounded-md border border-gray-200 p-2",children:(0,t.jsx)(eu.FirewallGlobe,{color:"gray-800"})}),(0,t.jsx)("p",{className:"text-label-14 text-gray-700",children:"There are no recent alerts"})]})})}var eA=e.i(7849701),eC=e.i(9106354);function ek(){let e=(0,n.useParams)(),o=e?.teamSlug??"",c=e?.project??"",d=(0,a.useServerFlag)("firewall-overview-refresh",!1),{data:m}=(0,j.useProject)(e?.project),{toolbarState:u,setToolbarState:x,lineSeries:h,isFirewallStatusLoading:b,isGraphDataLoading:v,currentConfig:w,managedRulesets:N,activeRules:T,options:S}=(0,eC.useFirewallState)(),{team:A}=(0,l.useTeam)();m?.security?.attackModeEnabled&&m?.security?.attackModeActiveUntil&&(m.security.attackModeActiveUntil,Date.now());let C="all_rules"===u.filter&&"all"===u.action&&"group_by_action"===u.groupBy;return(0,t.jsx)(i.ConditionalNavigationMarker,{enabled:!b,phase:"content",label:"FirewallOverview",children:(0,t.jsx)("div",{"data-testid":(0,s.tid)("firewall","overview","layout"),className:"tailwind-preflight",children:(0,t.jsx)("div",{className:"container flex flex-col gap-3 px-0",children:(0,t.jsx)(g.ObservabilityChartContextProvider,{children:(0,t.jsx)(y.VisualizationContextProvider,{formatter:z.formatShortPrecision,series:h??new Map,children:C&&d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid lg:grid-cols-2 gap-3",children:[(0,t.jsx)(ev,{teamIdOrSlug:o,projectIdOrName:c,plan:A?.billing?.plan}),(0,t.jsx)(f.WafRuleIdPanel,{teamIdOrSlug:o,projectIdOrName:c,onRuleClick:e=>{x({type:"filter",value:e})}})]}),(0,t.jsxs)("div",{className:"grid lg:grid-cols-3 gap-3 lg:items-stretch",children:[(0,t.jsx)("div",{className:"lg:col-span-2 flex flex-col flex-1",children:(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(eA.FirewallEventsTable,{})})}),(0,t.jsx)("div",{className:"flex flex-col flex-1",children:(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(p,{teamIdOrSlug:o,projectIdOrName:c})})})]})]}):(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)(en.FirewallTableGroupSkeleton,{}),children:v?(0,t.jsx)(en.FirewallTableGroupSkeleton,{}):(0,t.jsx)(J,{config:w,project:m,rulesets:N??{}})})})})})})})}e.s(["FirewallOverview",()=>ek],5597167)},6928648,e=>{"use strict";var t=e.i(1146226),a=e.i(5610834),l=e.i(5169864),s=e.i(6891161),i=e.i(5255926),n=e.i(6850581),r=e.i(3306538),o=e.i(8761240),c=e.i(762945),d=e.i(5182595),m=e.i(9179929),u=e.i(5481907),x=e.i(3804618),h=e.i(5760285),p=e.i(3793583),f=e.i(6143247),g=e.i(1283928),j=e.i(8690335),y=e.i(8778858),b=e.i(5338940),v=e.i(8646915),w=e.i(7181648),N=e.i(57106),T=e.i(7849701),S=e.i(7450977),A=e.i(8708663),C=e.i(4141852),k=e.i(1829577);let _=(e,t)=>({startTime:new Date(e-18e5),endTime:new Date(t+18e5)});function R(e){let{active:a,onClose:l,children:i,modalBodyRef:n}=e;return(0,t.jsx)(s.Modal.Modal,{active:a,disableFocusTrap:!0,onClickOutside:l,style:{width:"66%",alignSelf:"flex-end",marginRight:"1rem",maxHeight:"calc(100% - 2rem)",height:"100%"},children:(0,t.jsx)(s.Modal.Body,{style:{height:"100%"},children:(0,t.jsx)("div",{ref:n,children:i})})})}function I(e){var s;let o,{teamSlug:c,projectSlug:d}=e,m=(0,a.useRouter)(),p=(0,a.usePathname)(),f=(0,a.useSearchParams)(),[g,j]=(0,l.useState)(!0),S=(0,l.useRef)(null),A=f?.get("alert"),I=!!A,O=f?.get("eventIp"),G=f?.get("eventHost"),V=f?.get("eventAction")||void 0,W=f?.get("eventActionType")||void 0,K=f?.get("eventStart"),J=f?.get("eventEnd"),Y=!!(O&&G&&K&&J),{team:X}=(0,b.useTeam)(),ee=X?.billing?.plan??"hobby",{data:et,isLoading:ea}=(0,y.useAttackHistory)({teamId:c,projectId:d,..."hobby"!==ee&&{since:"enterprise"===ee?7:1}}),{data:el}=(0,v.useAlerts)(),es=A?.split("-")||[],ei=A?.includes("team_")&&es.length>=3,en=(0,l.useMemo)(()=>{if(!ei||!A||!et)return;let e=Number.parseInt(es.at(-1)||"0",10);return et.anomalies.find(t=>t.startTime===e)},[ei,A,es,et]),er=(0,l.useMemo)(()=>{if(!ei&&el&&A)return el.alerts.find(e=>e.id===A)},[ei,A,el]),{chartData:eo,isLoading:ec}=function(e){let t=(0,l.useMemo)(()=>{if(!e)return;let t={...e.sonarQuery},a=(0,h.getChartInterval)(e);return t.startTime=a.chartStartTime,t.endTime=a.chartEndTime,t},[e]),{data:a,isLoading:s}=(0,u.useSonarQuery)(t,{noEnvironmentFilter:!0});return{chartData:a,isLoading:s}}(er),{chartData:ed,isLoading:em}=function(e){let t=(0,l.useMemo)(()=>{if(!e)return;let{startTime:t,endTime:a}=_(e.startTime,e.endTime||e.startTime);return{event:"firewallAction",reason:"firewall_tab",rollups:{count:{measure:"count",aggregation:"sum"}},filter:"wafAction in ('challenge', 'deny') and wafRuleId eq 'sys_dos_mitigation'",groupBy:["wafAction"],startTime:t,endTime:a,granularity:{minutes:1},limitRanking:"top_by_summary",orderBy:"count",limit:2,tailRollup:"truncate",summaryOnly:!1}},[e]),{data:a,isLoading:s}=(0,u.useSonarQuery)(t,{noEnvironmentFilter:!0});return{chartData:(0,l.useMemo)(()=>a&&t?{...a,query:t}:a,[a,t]),isLoading:s}}(en||void 0),{chartData:eu,isLoading:ex}=function(e){let{eventIp:t,eventHost:a,eventStart:s,eventEnd:i}=e,n=(0,l.useMemo)(()=>{let e=e=>e.endsWith("Z")?e:`${e}Z`,l=new Date(new Date(e(s)).getTime()-9e5),n=new Date(new Date(e(i)).getTime()+9e5);return{event:"firewallAction",reason:"firewall_tab",rollups:{count:{measure:"count",aggregation:"sum"}},filter:`(clientIp eq '${t}') and (requestHostname eq '${a}')`,groupBy:["wafAction"],limit:10,limitRanking:"top_by_summary",tailRollup:"truncate",startTime:l,endTime:n,granularity:{minutes:1},summaryOnly:!1}},[t,a,s,i]),{data:r,isLoading:o}=(0,u.useSonarQuery)(n,{noEnvironmentFilter:!0});return{chartData:(0,l.useMemo)(()=>r&&n?{...r,query:n}:r,[r,n]),isLoading:o}}(Y&&O&&G&&K&&J?{eventIp:O,eventHost:G,eventStart:K,eventEnd:J}:{eventIp:"",eventHost:"",eventStart:"",eventEnd:""});(0,l.useEffect)(()=>{p&&requestAnimationFrame(()=>{if(f?.has("alert")||f?.has("eventIp"))return j(!0);j(!1)})},[p,f]),s=S.current,o=(0,l.useRef)(0),(0,l.useEffect)(()=>{function e(e){var t;if(null===s||!/tab/i.test(e.key))return;e.preventDefault();let{activeElement:a}=document,l=Array.from(s.querySelectorAll(Q)).filter(e=>"focus"in e&&"function"==typeof e.focus);if(0===l.length)return;let i=l[0],n=!e.shiftKey;if(!a||!(null!==(t=a)&&"nodeType"in t&&t.nodeType===Node.ELEMENT_NODE)||!s.contains(a))return void i.focus();let r=(o.current+(n?1:-1)+l.length)%l.length;l[r].focus(),o.current=r}return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[s]);let eh=()=>{if(!p)return;let e=new URLSearchParams(f?.toString());e.delete("alert"),e.delete("eventIp"),e.delete("eventHost"),e.delete("eventAction"),e.delete("eventActionType"),e.delete("eventStart"),e.delete("eventEnd"),e.delete("eventCount");let t=e.toString()?`${p}?${e}`:p;m.push(t)},ep=(0,l.useMemo)(()=>{if(!ei||!en)return null;let{startTime:e,endTime:t}=_(en.startTime,en.endTime||en.startTime);return(0,w.computeQueryBuilderLink)({type:"project-with-slug",teamSlug:c,projectNames:[d]},{event:"firewallAction",rollups:{count:{measure:"count",aggregation:"sum"}},filter:"wafAction in ('challenge', 'deny') and wafRuleId eq 'sys_dos_mitigation'",groupBy:["wafAction"],startTime:e,endTime:t})},[ei,en,c,d]),ef=(0,l.useMemo)(()=>er?(0,w.computeQueryBuilderLink)({type:"project-with-slug",teamSlug:c,projectNames:[d]},{...er.sonarQuery,startTime:new Date(er.sonarQuery.startTime),endTime:new Date(er.sonarQuery.endTime)}):null,[er,c,d]),eg=(0,l.useMemo)(()=>{if(!Y||!O||!G||!K||!J)return null;let e=e=>e.endsWith("Z")?e:`${e}Z`,t=new Date(new Date(e(K)).getTime()-9e5),a=new Date(new Date(e(J)).getTime()+9e5);return(0,w.computeQueryBuilderLink)({type:"project-with-slug",teamSlug:c,projectNames:[d]},{event:"firewallAction",rollups:{count:{measure:"count",aggregation:"sum"}},filter:`(clientIp eq '${O}') and (requestHostname eq '${G}')`,groupBy:["wafAction"],startTime:t,endTime:a})},[Y,O,G,K,J,c,d]);return I&&ei?ea||!et?(0,t.jsx)(R,{active:g,onClose:eh,modalBodyRef:S,children:(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsx)("h2",{className:"text-heading-20 font-medium",children:"DDoS Attack"})}),(0,t.jsx)(i.Skeleton,{width:160,height:20})]}),(0,t.jsx)(D,{}),(0,t.jsx)(B,{}),(0,t.jsx)(F,{})]})}):et&&en?(0,t.jsx)(R,{active:g,onClose:eh,modalBodyRef:S,children:(0,t.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-heading-24 font-semibold",children:"DDoS Attack"}),ep&&(0,t.jsx)(N.ButtonLink,{variant:"invert",size:"medium",href:ep,children:"Explore Query"})]}),(0,t.jsx)(n.RelativeTimeCard,{date:en.startTime,side:"bottom",children:(0,t.jsx)("span",{className:"text-label-14 text-gray-700 text-nowrap",children:new Date(en.startTime).toLocaleString()})})]}),em||!ed?(0,t.jsx)(D,{}):(0,t.jsx)(L,{data:ed}),em?(0,t.jsx)(B,{}):(0,t.jsx)(M,{anomaly:en,data:ed,isLoading:em}),(0,t.jsx)($,{anomaly:en}),(0,t.jsx)(T.FirewallEventsTable,{startTime:new Date(en.startTime-18e5),endTime:new Date(en.endTime?en.endTime===en.startTime?en.startTime+18e5:en.endTime+18e5:Date.now()+18e5),disableRowClick:!0,hosts:Object.keys(en.affectedHostMap)})]})}):(0,t.jsx)(R,{active:g,onClose:eh,modalBodyRef:S,children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsx)("h2",{className:"text-heading-20 font-medium",children:"DDoS Attack"})}),(0,t.jsx)("div",{className:"h-40 flex items-center justify-center text-gray-700",children:"Alert not found"})]})}):I&&er?(0,t.jsx)(R,{active:g,onClose:eh,modalBodyRef:S,children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-heading-20 font-medium",children:(0,x.getAlertTitle)(er)}),ef&&(0,t.jsx)(N.ButtonLink,{variant:"invert",size:"medium",href:ef,children:"Explore Query"})]}),(0,t.jsx)(P,{alert:er}),(0,t.jsx)(q,{alert:er,data:eo,isLoading:ec}),(0,t.jsx)(E,{alert:er})]})}):Y&&O&&G&&K&&J?(0,t.jsx)(R,{active:g,onClose:eh,modalBodyRef:S,children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-heading-24 font-semibold",children:"Event Details"}),eg&&(0,t.jsx)(N.ButtonLink,{variant:"invert",size:"medium",href:eg,children:"Explore Query"})]}),(0,t.jsxs)("div",{className:"grid sm:grid-cols-1 lg:grid-cols-2 gap-4 justify-items-start mb-2",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-0 items-baseline grid-cols-2",children:[(0,t.jsx)("span",{className:"text-gray-700 text-xs",children:"Start Time"}),(0,t.jsx)(n.RelativeTimeCard,{date:new Date(K.endsWith("Z")?K:`${K}Z`).getTime(),side:"bottom",children:(0,t.jsx)("span",{className:"text-heading-32 font-semibold",children:new Date(K.endsWith("Z")?K:`${K}Z`).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})})})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-0 items-baseline grid-cols-2",children:[(0,t.jsx)("span",{className:"text-gray-700 text-xs",children:"End Time"}),(0,t.jsx)(n.RelativeTimeCard,{date:new Date(J.endsWith("Z")?J:`${J}Z`).getTime(),side:"bottom",children:(0,t.jsx)("span",{className:"text-heading-32 font-semibold",children:new Date(J.endsWith("Z")?J:`${J}Z`).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})})})]})]}),ex?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U,{}),(0,t.jsx)(Z,{})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(z,{data:eu,isLoading:ex}),(0,t.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)("span",{className:"text-heading-14",children:"Action"}),(0,t.jsx)("div",{className:"flex flex-col gap-1 items-start",children:(0,t.jsx)(r.Badge,{size:"md",icon:"deny"===V?(0,t.jsx)(C.FirewallFlame,{}):(0,t.jsx)(k.FirewallCheck,{}),variant:"deny"===V?"red-subtle":"amber-subtle",children:V})})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)("span",{className:"text-heading-14",children:"Affected Hosts"}),(0,t.jsx)("div",{className:"flex flex-col gap-1",children:(0,t.jsx)("span",{className:"text-label-13 font-mono text-gray-900",children:G},G)})]})]}),(0,t.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)("span",{className:"text-heading-14",children:"Action Type"}),(0,t.jsx)("div",{className:"flex flex-col gap-1",children:(0,t.jsx)("span",{className:"text-label-13 text-gray-900",children:W||"N/A"})})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)("span",{className:"text-heading-14",children:"IP Address"}),(0,t.jsx)("div",{className:"flex flex-col gap-1",children:(0,t.jsx)("span",{className:"text-label-13 font-mono text-gray-900",children:O},O)})]})]})]}),(0,t.jsx)(H,{eventIp:O,eventHost:G,eventStart:K,eventEnd:J,teamSlug:c,projectSlug:d})]})}):null}function D(){return(0,t.jsx)("div",{className:"grid gap-4",children:(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-4 border border-gray-200 rounded-lg",children:[(0,t.jsx)(i.Skeleton,{width:220,height:12}),(0,t.jsx)(i.Skeleton,{width:420,height:32})]})})}function L(e){let{data:a}=e,s=(0,l.useMemo)(()=>{let e=0,t=0;return a.summary&&a.summary.length>0&&a.summary.forEach(a=>{let l=a.wafAction,s=a.count||0;"challenge"===l?e=s:"deny"===l&&(t=s)}),{challenged:e,denied:t,total:e+t}},[a]);return(0,t.jsxs)("div",{className:"grid sm:grid-cols-1 lg:grid-cols-3 gap-4 justify-items-start mb-2",children:[0!==s.challenged&&0!==s.denied&&(0,t.jsxs)("div",{className:"flex flex-row gap-1.5 items-baseline",children:[(0,t.jsx)("span",{className:"text-heading-32 font-semibold",children:s.total.toLocaleString()}),(0,t.jsx)("span",{className:"text-gray-700 text-xs",children:"Requests"})]}),0!==s.challenged&&(0,t.jsxs)("div",{className:"flex flex-row gap-1.5 items-baseline",children:[(0,t.jsx)("span",{className:"text-heading-32 font-semibold",children:s.challenged.toLocaleString()}),(0,t.jsx)("span",{className:"text-gray-700 text-xs",children:"Challenged"})]}),0!==s.denied&&(0,t.jsxs)("div",{className:"flex flex-row gap-1.5 items-baseline",children:[(0,t.jsx)("span",{className:"text-heading-32 font-semibold",children:s.denied.toLocaleString()}),(0,t.jsx)("span",{className:"text-gray-700 text-xs",children:"Denied"})]})]})}function P(e){let{alert:a}=e,{count:l}=a.data,s=new Date(a.sonarQuery.startTime).getTime(),i=(new Date(a.sonarQuery.endTime).getTime()-s)/6e4,n=i>0?Math.round(l/i):0;return(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)("div",{className:"flex flex-col gap-1 p-4 border border-gray-200 rounded-lg",children:(0,t.jsx)("span",{className:"text-heading-24 font-semibold",children:l.toLocaleString()})}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-4 border border-gray-200 rounded-lg",children:[(0,t.jsx)("span",{className:"text-gray-700 text-xs font-medium uppercase",children:"Rate Per Minute"}),(0,t.jsx)("span",{className:"text-heading-24 font-semibold",children:n.toLocaleString()})]})]})}function B(){return(0,t.jsx)("div",{className:"h-64 flex items-center justify-center border border-gray-200 rounded-lg bg-gray-50",children:(0,t.jsx)(i.Skeleton,{width:"80%",height:"80%"})})}function M(e){let{anomaly:a,data:l,isLoading:s}=e,i={data:[{count:null,timestamp:(0,p.sub)(new Date,{hours:1})},{count:null,timestamp:new Date}],summary:[],statistics:{rowsRead:0,bytesRead:0,dbTimeSeconds:0,engineTimeSeconds:0,queryTable:""}},n=[];if(a){let e,{startTime:t,endTime:l}=_(a.startTime,a.endTime||a.startTime);e=new Date(a.endTime&&a.endTime!==a.startTime?a.endTime:a.endTime&&a.endTime===a.startTime?a.startTime+18e5:Date.now()),n=a.endTime?[{id:"anomaly-period",type:"area",startTime:new Date(a.startTime),endTime:e,label:"Attack Period"}]:[{id:"anomaly-start",type:"timestamp",timestamp:new Date(a.startTime),label:"Attack Start"}],i.data=[t,l].map(e=>({count:null,timestamp:e}))}let r=(0,m.useTimeseriesData)(l??i,{category:e=>e.wafAction||"Unknown",value:"count"}),o=(0,j.getFormatter)("sum","count");return(0,t.jsx)("div",{className:(0,f.cn)("h-64","transition-opacity duration-200",(s||!l)&&"opacity-30"),children:(0,t.jsx)(d.LineChart,{data:r??[],sonarQueryResults:l,formatValue:o,lineType:"linear",granularity:{minutes:1},marks:n,marginLeft:20,yAxisWidth:10,showRollup:!1,disableZoom:!0,headerHeight:40})})}function F(){return(0,t.jsx)("div",{className:"flex flex-col gap-4",children:(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)(i.Skeleton,{width:120,height:12}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)(i.Skeleton,{width:200,height:20}),(0,t.jsx)(i.Skeleton,{width:180,height:20})]})]})})}function $(e){let{anomaly:a}=e,l=Object.keys(a.affectedHostMap),s=a.endTime;return(0,t.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)("span",{className:"text-heading-14",children:"Affected Hosts"}),(0,t.jsx)("div",{className:"flex flex-col gap-1",children:l.map(e=>(0,t.jsx)("span",{className:"text-label-13 font-mono text-gray-900",children:e},e))})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full items-start",children:[(0,t.jsx)("span",{className:"text-heading-14",children:"Status"}),(0,t.jsx)(r.Badge,{className:"pl-1 pr-2",icon:s?(0,t.jsx)(o.CheckCircleFill,{color:"gray-800"}):(0,t.jsx)(c.Warning,{}),variant:s?"gray-subtle":"amber-subtle",children:s?"Resolved":"Active"})]})]})}function E(e){var a;let{alert:l}=e,{path:s,metric:i}={path:"path"in(a=l.data)&&O(a.path)?a.path.toString():void 0,metric:"metric"in a&&O(a.metric)?a.metric.toString():void 0};return(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[s&&(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{className:"text-gray-700 text-xs font-medium uppercase",children:"Path"}),(0,t.jsx)("span",{className:"text-label-14 font-mono",children:s})]}),i&&(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{className:"text-gray-700 text-xs font-medium uppercase",children:"Result"}),(0,t.jsx)("span",{className:"text-label-14",children:i})]})]})}function O(e){return"object"==typeof e&&null!==e&&"toString"in e&&"function"==typeof e.toString}function q(e){let a,l,s,{alert:i,data:n,isLoading:r}=e,o={data:[{count:null,timestamp:(0,p.sub)(new Date,{days:1})},{count:null,timestamp:new Date}],summary:[],statistics:{rowsRead:0,bytesRead:0,dbTimeSeconds:0,engineTimeSeconds:0,queryTable:""}},c=[];if(i){let e=(0,h.getChartInterval)(i);s=i.sonarQuery.granularity,l=(0,j.getFormatter)(i.sonarQuery.rollups.count.aggregation,g.AllMeasures[i.sonarQuery.rollups.count.measure].unit),a=(0,x.getAlertTitle)(i),c=e.marks,o.data=[e.chartStartTime,e.chartEndTime].map(e=>({count:null,timestamp:e}))}let u=(0,m.useTimeseriesData)(n??o,{category:()=>a,value:"count"});return(0,t.jsx)("div",{className:(0,f.cn)("h-96","transition-opacity duration-200",(r||!n)&&"opacity-30"),children:(0,t.jsx)(d.LineChart,{data:u??[],sonarQueryResults:n,disableLegend:!0,formatValue:l,lineType:"linear",granularity:s,marks:c,disableZoom:!0,headerHeight:40})})}function H(e){let{eventIp:a,eventHost:s,eventStart:i,eventEnd:n,teamSlug:r,projectSlug:o}=e,{toolbarState:c,overrideFilter:d,overrideTimeRange:m}=(0,l.useMemo)(()=>{let e=e=>e.endsWith("Z")?e:`${e}Z`,t=new Date(new Date(e(i)).getTime()-9e5),l=new Date(new Date(e(n)).getTime()+9e5);return{toolbarState:{filter:"all_rules",action:"all",groupBy:"requestPath",range:{from:t,to:l}},overrideFilter:`(clientIp eq '${a}') and (requestHostname eq '${s}')`,overrideTimeRange:{start:t,end:l}}},[a,s,i,n]),u=(0,j.getFormatter)("sum","count"),x=(0,l.useMemo)(()=>new Map,[]);return(0,t.jsx)(A.VisualizationContextProvider,{formatter:e=>void 0!==e?u(e):"0",series:x,children:(0,t.jsx)(S.IncomingRequestPathPanel,{teamIdOrSlug:r,projectIdOrName:o,toolbarState:c,overrideFilter:d,overrideEvent:"firewallAction",overrideTimeRange:m})})}function U(){return(0,t.jsx)("div",{className:"h-96 flex items-center justify-center border border-gray-200 rounded-lg bg-gray-50",children:(0,t.jsx)(i.Skeleton,{width:"80%",height:300})})}function Z(){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)(i.Skeleton,{width:60,height:16}),(0,t.jsx)(i.Skeleton,{width:80,height:24})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)(i.Skeleton,{width:100,height:16}),(0,t.jsx)(i.Skeleton,{width:200,height:20})]})]}),(0,t.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)(i.Skeleton,{width:80,height:16}),(0,t.jsx)(i.Skeleton,{width:100,height:20})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)(i.Skeleton,{width:80,height:16}),(0,t.jsx)(i.Skeleton,{width:120,height:20})]})]})]})}function z(e){let{data:a,isLoading:l}=e,s={data:[{count:null,timestamp:(0,p.sub)(new Date,{hours:1})},{count:null,timestamp:new Date}],summary:[],statistics:{rowsRead:0,bytesRead:0,dbTimeSeconds:0,engineTimeSeconds:0,queryTable:""}},i=(0,m.useTimeseriesData)(a??s,{category:e=>e.wafAction||"Requests",value:"count"}),n=(0,j.getFormatter)("sum","count");return(0,t.jsx)("div",{className:(0,f.cn)("h-96","transition-opacity duration-200",(l||!a)&&"opacity-30"),children:(0,t.jsx)(d.LineChart,{data:i??[],sonarQueryResults:a,disableLegend:!1,formatValue:n,lineType:"linear",granularity:{minutes:1},marginLeft:20,yAxisWidth:10,showRollup:!1,disableZoom:!0,headerHeight:40})})}let Q=`
button:not([disabled]),
input:not([disabled]):not([type="hidden"]),
select:not([disabled]),
textarea:not([disabled]),

[contenteditable],
[href],
[tabindex]:not([tabindex="-1"])`;function G(){let e=(0,a.useSearchParams)(),l=(0,a.useParams)(),s=e?.has("alert"),i=e?.has("eventIp");if(!s&&!i)return null;let n=l?.teamSlug,r=l?.project;return(0,t.jsx)(I,{teamSlug:n,projectSlug:r})}function V(){return(0,t.jsx)(l.Suspense,{fallback:null,children:(0,t.jsx)(G,{})})}e.s(["FirewallSheetOpener",()=>V],6928648)}]);

//# debugId=892364c7-3c16-5a7c-46b4-1a62645673d0
//# sourceMappingURL=35983385882194a0.js.map