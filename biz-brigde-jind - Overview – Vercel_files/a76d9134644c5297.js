;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="56b19a91-cd80-50e1-1747-5a48486b601a")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,2831393,e=>{"use strict";var a=e.i(2405338),t=e.i(5338940);function i(){let{team:e,isReady:i}=(0,t.useTeam)(),{data:r,isLoading:n,mutate:l}=(0,a.default)(e?.id&&i?`/api/ai/ai-credits-balance?teamId=${e.id}`:null,e=>fetch(e).then(e=>e.json()));return{balance:r?Number(r.cumulativeBalance):void 0,hasEverPaid:r?.hasEverPaid,hasVerifiedPaymentMethod:r?.hasVerifiedPaymentMethod,loading:!i||n,mutate:l}}e.s(["useAiCreditsBalance",()=>i])},7612113,9602070,1080526,e=>{"use strict";var a=e.i(1146226),t=e.i(5169864),i=e.i(2831393),r=e.i(2504781),n=e.i(4030453),l=e.i(6891161),s=e.i(8522580),o=e.i(455575),c=e.i(5338940),d=e.i(5140444);e.i(3512434);var u=e.i(9835407),m=e.i(7917902),p=e.i(119294),f=e.i(6352514);(0,e.i(7432042).default)("1y");var x=e.i(2405338),g=e.i(8073978);e.i(4373123);var h=e.i(5325056),y=e.i(2490412);let b=(0,y.createServerReference)("409b216e8821cb7992ac033d879233570953f3e156",y.callServer,void 0,y.findSourceMapURL,"createTopUpPurchaseIntent"),v=u.z.object({amount:u.z.number().min(10).max(5e3)}),C=[20,50,100,500];function j(e){let{activeModalType:u,setActiveModalType:y,closeModal:j,autoRechargeConfig:S,isAutoRechargeEnabled:M}=e,{setPurchaseIntent:A,setProviderDetails:w}=(0,h.useCopperClient)(),{data:k}=(0,x.default)("deferred-auto-recharge-config",{fallbackData:null}),{balance:N}=(0,i.useAiCreditsBalance)(),[B,I]=(0,t.useState)("100"),[R,_]=(0,t.useState)(!1),[T,P]=(0,t.useState)(null),[$,E]=(0,t.useState)("ready"),O=""===B||"0"===B,U=Number(B),z=O||Number.isNaN(U)?100:U,{team:D}=(0,c.useTeam)(),{user:F}=(0,d.useUser)(),{account:G}=(0,m.useAccount)(),H=(0,o.useToasts)(),W=(0,t.useCallback)(e=>{let a=e;e.includes(".")?1===e.split(".")[1].length&&(a=`${e}0`):a=`${e}.00`;let t=Number.parseFloat(a);return Number.isNaN(t)||t<10?(P("Minimum amount is $10"),!1):t>5e3?(P(`Maximum amount is $${5e3.toLocaleString()}`),!1):(P(null),t)},[]),L=(0,t.useCallback)(e=>{I(e),P(null),E("ready")},[]),K=(0,t.useMemo)(()=>S&&k||S?`Auto-reload is enabled. Your balance will be restored to $${S.targetBalance} when it falls below $${S.minimumBalance}.`:k?"Auto-reload will be enabled after your first purchase.":"Auto-reload is disabled.",[S,k]),V=(0,t.useCallback)(async()=>{try{if(!F||!D)return;let e=W(B);if(!e)return;E("in_progress");let a=v.safeParse({amount:e});if(!a.success){a.error.issues[0],e<10?E("amount_too_low"):e>5e3?E("amount_too_high"):E("invalid_amount");return}let t=await b({amount:B,returnUrl:window.location.href,teamIdOrSlug:D.id});E("completed"),A(t.purchaseIntent),w(t.providerDetails),y("checkout")}catch(e){H.error("We're having trouble processing your payment. Please try again."),E("ready"),A(null),w(null),j(),p.analytics.track(f.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[B,F,D,G,j,A,w,y,W,H]);return(0,a.jsxs)(l.Modal.Modal,{active:"top_up"===u,onClickOutside:j,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Buy AI Gateway Credit"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Purchase credit as a one time top-up to use for your team's AI Gateway usage. Credit expires 1 year after purchase and is only valid for use on AI Gateway."})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4 pb-4",children:[(0,a.jsx)("div",{className:"flex h-[84px] items-center justify-center text-gray-1000",children:R?(0,a.jsxs)("div",{className:"flex items-center justify-center w-full transition-transform duration-200 animate-in zoom-in-95",children:[(0,a.jsx)("span",{className:"text-heading-64 text-gray-1000",children:"$"}),(0,a.jsx)("input",{type:"text",value:B.startsWith("$")?B.slice(1):B,onChange:e=>{let a=e.target.value.replace(/,/g,"").replace(/[^0-9.]/g,"");a.split(".")[0].length>6||L(a)},onBlur:()=>{B&&""!==B||I("100"),_(!1)},autoFocus:!0,className:"text-heading-64 text-start border-none outline-none",style:{width:`${Math.max(3,B.length)}ch`},placeholder:"100"})]}):(0,a.jsx)("div",{className:"flex w-full items-center justify-center transition-transform duration-200 animate-in zoom-in-105 cursor-pointer hover:scale-105",onPointerDown:e=>{e.preventDefault(),_(!0),I(z.toString())},children:(0,a.jsx)(g.default,{className:"text-heading-64 text-gray-1000 cursor-pointer",value:z,format:{style:"currency",currency:"USD"}})})}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[C.map(e=>(0,a.jsxs)(r.Button,{size:"small",type:"secondary",normalStyle:B===e.toString()?{backgroundColor:"var(--ds-gray-100)",color:"var(--ds-gray-1000)",borderColor:"var(--ds-gray-alpha-300)"}:void 0,onClick:()=>{I(e.toString()),_(!1),P(null),E("ready")},children:["$",e]},e)),(0,a.jsx)(r.Button,{size:"small",type:"secondary",onClick:()=>{_(!0)},normalStyle:C.map(e=>e.toString()).includes(B)?void 0:{backgroundColor:"var(--ds-gray-100)",color:"var(--ds-gray-1000)",borderColor:"var(--ds-gray-alpha-300)"},children:"Custom"})]})]}),T&&(0,a.jsx)(n.Error,{children:T}),M?(0,a.jsx)(s.Note,{action:(0,a.jsx)(r.Button,{size:"small",type:"secondary",onClick:()=>{y("auto_recharge")},children:"Change"}),fill:!0,type:"secondary",children:K}):null]})]}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>y(null),type:"secondary",children:"Cancel"}),(0,a.jsx)(l.Modal.Action,{onClick:V,disabled:O||!!T,loading:"in_progress"===$,autoFocus:!0,children:"Continue to Payment"})]})]})}var S=e.i(7418514),M=e.i(1637825),A=e.i(5323212),w=e.i(5255926),k=e.i(6446781),N=e.i(5924191),B=e.i(5895979),I=e.i(5883567),R=e.i(57106);let _=(0,y.createServerReference)("40d38037743cb124b02a7778c758561ae10f5cba83",y.callServer,void 0,y.findSourceMapURL,"completePurchaseIntent"),T=(0,y.createServerReference)("40e7468b9d54e9e600c9f9c32e29cb690b07dcd49a",y.callServer,void 0,y.findSourceMapURL,"confirmPurchaseIntent"),P=(0,y.createServerReference)("4085146e6a71491d4460c6d1f982734133fadd314b",y.callServer,void 0,y.findSourceMapURL,"createAutoTopupConfig"),$=(0,y.createServerReference)("40955cc103b2d0b0d920774279202cc71147f2b623",y.callServer,void 0,y.findSourceMapURL,"patchPaymentMethod");var E=e.i(1175850),O=e.i(6280036),U=e.i(5978870);let z=(0,B.withBillingContext)(function(e){let{activeModalType:n,setActiveModalType:s,closeModal:u,providerDetails:x,onConversion:g}=e,{purchaseIntent:y}=(0,h.useCopperClient)(),[b,v]=(0,t.useState)("ready"),[C,j]=(0,t.useState)(null),{team:w}=(0,c.useTeam)(),{user:B}=(0,d.useUser)(),{mutate:R}=(0,N.useSWRConfig)(),{account:T}=(0,m.useAccount)(),{paymentMethods:P}=(0,M.useBillingPlatform)(),{balance:O,hasEverPaid:U}=(0,i.useAiCreditsBalance)(),z=(0,E.useStripe)(),D=(0,o.useToasts)(),F=(0,t.useMemo)(()=>{if(P){if(!C){let e=P.defaultSource;return P.sources.find(a=>a.id===e)}return P.sources.find(e=>e.id===C)}},[P,C]),L=(0,t.useMemo)(()=>K(y),[y]),V=(0,t.useCallback)(async()=>{try{if(v("in_progress"),!w||!z||!F||!B||!y||!x||void 0===O||void 0===L)return;F.billing_details.email||await $({paymentMethodId:F.id,teamIdOrSlug:w.id});let e=await z.initCheckout({fetchClientSecret:()=>Promise.resolve(x.clientSecret)}),a=await e.confirm({redirect:"if_required",paymentMethod:F.id});if("error"===a.type){p.analytics.track(f.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:a.error.message}),D.error("Failed to add funds. Please try again."),v("ready");return}await _({purchaseIntentId:y.id,teamIdOrSlug:w.id}),D.success(`Successfully added $${L} to your AI Gateway Credits balance!`);let t=Number(O)+L;g?.({amount:L,newBalance:t}),await R(`/api/ai/ai-credits-balance?teamId=${w.id}`,()=>({cumulativeBalance:t,hasEverPaid:!0}),{revalidate:!1}),v("completed"),u()}catch(e){D.error("We're having trouble processing your payment. Please try again."),v("ready"),u(),p.analytics.track(f.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[B,w,T,z,F,y,R,v,x,D,u,L,O,U,g]);return(0,a.jsxs)(l.Modal.Modal,{active:"checkout"===n,onClickOutside:u,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Confirm Payment Method"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Your default payment method will be used for a one-time charge unless you add a new payment method below."})]}),(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,a.jsx)(A.Select,{label:"Payment method",prefix:(0,a.jsx)(S.CardIcon,{brand:F?.card?.brand??"unknown"}),value:F?.id,onChange:e=>{v("ready"),j(e.target.value)},children:P?.sources.map(e=>(0,a.jsx)("option",{value:e.id,children:`${(0,k.cardBrand)(e.card?.brand)} ${e.card?.funding} ending in •••• ${e.card?.last4} ${e.id===P.defaultSource?"(Default)":""}`},e.id))}),(0,a.jsx)(r.Button,{type:"secondary",size:"medium",prefix:(0,a.jsx)(I.PlusCircle,{}),onClick:()=>{s("add_card")},children:"Add payment method"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial -mx-6 -mb-6 mt-6 px-6 py-4 pt-6 border-t bg-background-200",children:[(0,a.jsx)(W,{}),(0,a.jsx)(G,{purchaseIntent:y})]})]}),(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial px-6 py-2 border-t bg-background-200",children:(0,a.jsx)(H,{purchaseIntent:y})}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>{s("top_up")},type:"secondary",children:"Back"}),(0,a.jsx)(l.Modal.Action,{onClick:async()=>{await V()},loading:"in_progress"===b,children:"Confirm and Pay"})]})]})});function D(e){var r,n;let{activeModalType:s,setActiveModalType:u,closeModal:g,providerDetails:y,onConversion:b}=e,{purchaseIntent:v}=(0,h.useCopperClient)(),{data:C}=(0,x.default)("deferred-auto-recharge-config",{fallbackData:null}),[j,S]=(0,t.useState)("initializing"),{team:M}=(0,c.useTeam)(),{user:A}=(0,d.useUser)(),{mutate:k}=(0,N.useSWRConfig)(),{account:B}=(0,m.useAccount)(),{balance:I,hasEverPaid:R}=(0,i.useAiCreditsBalance)(),T=(0,o.useToasts)(),{resolvedTheme:$}=(0,O.useTheme)(),E=(0,t.useMemo)(()=>K(v),[v]),z=(0,t.useRef)(null),D=(0,t.useCallback)(async()=>{try{if(S("in_progress"),!M||!A||!v||!y||void 0===I||void 0===E)return void S("ready");if(z.current){let e=await z.current();if(e.success){await _({purchaseIntentId:v.id,teamIdOrSlug:M.id}),T.success(`Successfully added $${E} to your AI Gateway Credits balance!`);let e=Number(I)+E;if(b?.({amount:E,newBalance:e,autoRechargeConfig:C??void 0}),await k(`/api/ai/ai-credits-balance?teamId=${M.id}`,()=>({cumulativeBalance:e,hasEverPaid:!0}),{revalidate:!1}),C)try{let{minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}=C;await P({teamIdOrSlug:M.id,minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}),k(`/api/credit-topups?teamId=${M.id}&currency=ai_gateway_credits`),k("deferred-auto-recharge-config",null,{revalidate:!1}),T.success("Auto-reload has been enabled!")}catch(e){T.error("Payment successful, but auto-reload setup failed. Please try setting it up again.")}S("completed"),g()}else{p.analytics.track(f.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.error??"Payment checkout failed"}),T.error(e.error??"Failed to add credits. Please try again."),S("ready");return}}else{p.analytics.track(f.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:"Payment handler not initialized"}),T.error("We're having trouble processing your payment. Please try again."),S("ready");return}}catch(e){T.error("We're having trouble processing your payment. Please try again."),S("ready"),g(),p.analytics.track(f.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[A,M,B,v,k,S,y,T,g,E,I,C,R,b]);return(0,a.jsxs)(l.Modal.Modal,{active:"checkout"===s,onClickOutside:g,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Confirm Payment Method"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Your default payment method will be used for a one-time charge unless you add a new payment method below."})]}),"initializing"===j?(0,a.jsx)(w.Skeleton,{className:"h-32",width:"100%"}):null,(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:y?(0,a.jsx)(U.CopperPaymentElement,{confirmHandler:z,clientSecret:y.clientSecret,options:{elementsOptions:{appearance:(n={theme:"stripe"},{theme:"flat",variables:{fontSizeBase:"14px",fontSizeSm:"14px",colorTextPlaceholder:(r="dark"===$)?"hsl(240, 3.8%, 60%)":"hsl(240, 3.8%, 46.1%)",colorText:r?"white":"rgb(9, 9, 11)",colorPrimary:"var(--blue-700)",colorDanger:"hsl(0, 84.2%, 60.2%)",borderRadius:"6px",colorBackground:r?"black":"white",focusBoxShadow:r?"rgb(255, 255, 255) 0px 0px 0px 0px, rgb(161, 161, 170) 0px 0px 0px 1px, rgba(0, 0, 0, 0.05) 0px 1px 2px 0px":"rgb(0, 0, 0) 0px 0px 0px 0px, rgb(161, 161, 170) 0px 0px 0px 1px, rgba(0, 0, 0, 0.05) 0px 1px 2px 0px"},rules:{".Input":{border:r?"1px solid hsl(240, 5.9%, 30%)":"1px solid hsl(240, 5.9%, 90%)",padding:"10px 12px",transition:"all cubic-bezier(0.4, 0, 0.2, 1) 150ms"},".Label":{marginBottom:"8px",color:r?"#999999":"#666666",lineHeight:"20px",fontWeight:"400"},".AccordionItem":{backgroundColor:r?"black":"white"},".Block":{backgroundColor:r?"black":"white"}},...n}),loader:"never",savedPaymentMethod:{enableRedisplay:"auto"}}},onReady:()=>S("ready")}):null}),(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial -mx-6 -mb-6 mt-6 px-6 py-4 pt-6 border-t bg-background-200",children:[(0,a.jsx)(W,{}),(0,a.jsx)(G,{purchaseIntent:v})]})]}),(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial px-6 py-2 border-t bg-background-200",children:(0,a.jsx)(H,{purchaseIntent:v})}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>{u("top_up"),S("initializing")},type:"secondary",children:"Back"}),(0,a.jsx)(l.Modal.Action,{onClick:async()=>{await D()},loading:["in_progress","initializing"].includes(j),children:"Confirm and Pay"})]})]})}function F(e){let{activeModalType:r,setActiveModalType:n,closeModal:s,providerDetails:u,onConversion:g}=e,{purchaseIntent:y}=(0,h.useCopperClient)(),{data:b}=(0,x.default)("deferred-auto-recharge-config",{fallbackData:null}),[v,C]=(0,t.useState)("ready"),{team:j}=(0,c.useTeam)(),{user:S}=(0,d.useUser)(),{mutate:M}=(0,N.useSWRConfig)(),{account:A}=(0,m.useAccount)(),{balance:w,hasEverPaid:k}=(0,i.useAiCreditsBalance)(),B=(0,o.useToasts)(),I=(0,t.useMemo)(()=>K(y),[y]),R=(0,t.useCallback)(async()=>{if(j&&S&&y&&u&&void 0!==w&&void 0!==I&&"in_progress"!==v)try{C("in_progress"),await T({purchaseIntentId:y.id,teamIdOrSlug:j.id}),await _({purchaseIntentId:y.id,teamIdOrSlug:j.id}),B.success(`Successfully added $${I} to your AI Gateway Credits balance!`);let e=Number(w)+I;if(g?.({amount:I,newBalance:e,autoRechargeConfig:b??void 0}),await M(`/api/ai/ai-credits-balance?teamId=${j.id}`,()=>({cumulativeBalance:e,hasEverPaid:!0}),{revalidate:!1}),b)try{let{minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}=b;await P({teamIdOrSlug:j.id,minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}),M(`/api/credit-topups?teamId=${j.id}&currency=ai_gateway_credits`),M("deferred-auto-recharge-config",null,{revalidate:!1}),B.success("Auto-reload has been enabled!")}catch(e){B.error("Payment successful, but auto-reload setup failed. Please try setting it up again.")}C("completed"),s()}catch(e){B.error("We're having trouble processing your payment. Please try again."),C("ready"),s(),p.analytics.track(f.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[S,j,A,y,M,C,v,u,B,s,I,w,b,k,g]);return(0,a.jsxs)(l.Modal.Modal,{active:"checkout"===r,onClickOutside:s,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Confirm Purchase"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Your purchase will be reported to AWS Markeplace for invoicing and payment."})]}),(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial -mx-6 -mb-6 mt-6 px-6 py-4 pt-6 border-t bg-background-200",children:[(0,a.jsx)(W,{}),(0,a.jsx)(G,{purchaseIntent:y})]})]}),(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial px-6 py-2 border-t bg-background-200",children:(0,a.jsx)(H,{purchaseIntent:y})}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>{n("top_up")},type:"secondary",children:"Back"}),(0,a.jsx)(l.Modal.Action,{onClick:async()=>{await R()},loading:"in_progress"===v,children:"Confirm and Pay"})]})]})}function G(e){let{purchaseIntent:i}=e,r=(0,t.useMemo)(()=>i?i.lineItems?.map(e=>({name:e.name,amount:Number(e.unitAmount)*Number(e.quantity)}))??[]:[],[i]),n=i?.tax?Number(i.tax):0,l=n>0;return(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:[r.map((e,t)=>(0,a.jsxs)("div",{className:`flex flex-row items-stretch justify-between gap-4 flex-initial py-2 ${l||t<r.length-1?"border-b":""}`,children:[(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-gray-900",children:e.name}),(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-gray-900",children:`$${e.amount.toFixed(2)}`})]},e.name)),n>0?(0,a.jsxs)("div",{className:"flex flex-row items-stretch justify-between gap-4 flex-initial py-4 border-b",children:[(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-foreground",children:"Estimated Tax"}),(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-foreground",children:`$${n.toFixed(2)}`})]}):null]})}function H(e){let{purchaseIntent:t}=e,i=t?.total?Number(t.total):0;return(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-1 flex-initial py-2",children:[(0,a.jsxs)("div",{className:"flex flex-row items-stretch justify-between gap-4 flex-initial",children:[(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-foreground",children:"Total"}),(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-foreground",children:`$${i.toFixed(2)}`})]}),(0,a.jsx)("p",{className:"text-label-12 text-gray-900 text-right",children:"* Plus applicable tax and fees"})]})}function W(){return(0,a.jsxs)("p",{className:"text-copy-14 text-gray-900",children:['By pressing "Confirm and Pay" and accessing AI Gateway, you agree to'," ",(0,a.jsx)(R.Link,{href:"/legal/ai-product-terms",className:"text-foreground underline",target:"_blank",children:"Vercel's AI Product Terms."})]})}function L(e){var t;let{isUpdatedStripeElementsEnabled:i}=e,{purchaseIntent:r,providerDetails:n}=(0,h.useCopperClient)();return(t=r,t?.provider?.type==="tackle_aws_marketplace")?(0,a.jsx)(F,{...e,providerDetails:n}):i?(0,a.jsx)(D,{...e,providerDetails:n}):(0,a.jsx)(z,{...e,providerDetails:n})}function K(e){return e?e.lineItems?.filter(e=>"AI Gateway Credits"===e.name).reduce((e,a)=>e+Number(a.unitAmount)*(Number(a.quantity)||1),0):0}var V=e.i(8158658),Y=e.i(2471070);function q(){let{topups:e,loading:a,mutate:t}=(0,Y.useAiGatewayCreditTopups)(),i=e?.find(e=>"orb_ledger"!==e.provider.type||"miu"!==e.provider.currency);return{autoRechargeConfig:i?{minimumBalance:i.minimumBalance,targetBalance:i.targetBalance,maximumMonthlySpend:i.maximumMonthlySpend??""}:void 0,loading:a,mutate:t}}e.s(["useAiCreditsAutoRecharge",()=>q],9602070);var J=e.i(3500331),Q=e.i(1906681);let X=(0,y.createServerReference)("407139578dfcc212ee2e211cedfc1412dcd3a109f9",y.callServer,void 0,y.findSourceMapURL,"deleteAutoTopupConfig"),Z=(0,y.createServerReference)("407a6256c10fae7c7e3eaafd4783071d07bb9c6bc6",y.callServer,void 0,y.findSourceMapURL,"updateAutoTopupConfig"),ee=u.z.object({minimumBalance:u.z.string().refine(e=>!Number.isNaN(Number(e))&&Number.isInteger(Number(e))&&Number(e)>=5,{message:"Minimum balance must be a whole number and at least $5"}),targetBalance:u.z.string().refine(e=>!Number.isNaN(Number(e))&&Number.isInteger(Number(e))&&Number(e)>=25,{message:"Target balance must be a whole number and at least $25"}),maximumMonthlySpend:u.z.string().optional().refine(e=>!e||!Number.isNaN(Number(e))&&Number.isInteger(Number(e))&&Number(e)>=50,{message:"Maximum monthly spend must be a whole number and at least $50"})}).refine(e=>{let{minimumBalance:a,targetBalance:t}=e;return Number(t)>Number(a)},{message:"Target balance must be greater than minimum balance",path:["targetBalance"]});function ea(e){let{autoRechargeConfig:a,draftAutoRechargeConfig:t,type:i}=e;return t?t[i]??"":a?a[i]??"":"minimumBalance"===i?"5":"targetBalance"===i?"25":"maximumMonthlySpend"===i?"50":"0"}function et(e){let{autoRechargeConfig:n,onCancel:l,onComplete:s}=e,{data:d,mutate:u}=(0,x.default)("deferred-auto-recharge-config",{fallbackData:null}),m=n??d??void 0,[p,f]=(0,t.useState)(!!m),[g,h]=(0,t.useState)(null),[y,b]=(0,t.useState)("ready"),[v,C]=(0,t.useState)({}),{balance:j,hasEverPaid:S}=(0,i.useAiCreditsBalance)(),M=!!m!==p||null!==g,{team:A}=(0,c.useTeam)(),{mutate:w}=(0,N.useSWRConfig)(),k=(0,o.useToasts)(),B=function(e){let{autoRechargeConfig:a,draftAutoRechargeConfig:t}=e;return(e,i)=>({minimumBalance:"minimumBalance"===e?i:ea({autoRechargeConfig:a,draftAutoRechargeConfig:t,type:"minimumBalance"}),targetBalance:"targetBalance"===e?i:ea({autoRechargeConfig:a,draftAutoRechargeConfig:t,type:"targetBalance"}),maximumMonthlySpend:"maximumMonthlySpend"===e?i:ea({autoRechargeConfig:a,draftAutoRechargeConfig:t,type:"maximumMonthlySpend"})})}({autoRechargeConfig:m,draftAutoRechargeConfig:g}),I=(0,t.useCallback)(async()=>{if(!A||!g)return;let{minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}=g;S?(await P({teamIdOrSlug:A.id,minimumBalance:e,targetBalance:a,maximumMonthlySpend:t??""}),w(`/api/credit-topups?teamId=${A.id}&currency=ai_gateway_credits`),k.success("Successfully enabled auto-reload!")):(u({minimumBalance:e,targetBalance:a,maximumMonthlySpend:t??""}),k.success("Auto-reload will be enabled after your first purchase."))},[A,g,w,k,S,u]),R=(0,t.useCallback)(async()=>{if(!A||!n||!g)return;let{maximumMonthlySpend:e,minimumBalance:a,targetBalance:t}=g;await Z({teamIdOrSlug:A.id,updatedMaximumMonthlySpend:e??"",updatedMinimumBalance:a,updatedTargetBalance:t}),w(`/api/credit-topups?teamId=${A.id}&currency=ai_gateway_credits`),k.success("Successfully updated auto-reload!")},[A,n,g,w,k]),_=(0,t.useCallback)(async()=>{A&&n&&(await X({teamIdOrSlug:A.id}),w(`/api/credit-topups?teamId=${A.id}&currency=ai_gateway_credits`),k.success("Successfully disabled auto-reload!"))},[A,n,w,k,X]),T=(0,t.useCallback)(async()=>{if(b("in_progress"),!M)return void b("ready");let e=ee.safeParse({minimumBalance:ea({autoRechargeConfig:m,draftAutoRechargeConfig:g,type:"minimumBalance"}),targetBalance:ea({autoRechargeConfig:m,draftAutoRechargeConfig:g,type:"targetBalance"}),maximumMonthlySpend:ea({autoRechargeConfig:m,draftAutoRechargeConfig:g,type:"maximumMonthlySpend"})});if(!e.success){b("ready");let a={};e.error.errors.forEach(e=>{a[e.path[0]]=e.message}),C(a);return}if(void 0!==j&&Number(e.data.minimumBalance)>=Number(j)&&!0===S){b("ready"),C({minimumBalance:"Minimum balance must be lower than your current balance"});return}C({});try{m&&!p?n?await _():u(null):!n&&g?await I():n&&g&&await R(),b("completed"),s?.()}catch{k.error("Failed to update auto-reload. Please try again."),b("ready")}},[n,g,p,m,I,R,_,u,k,M,s,j,b,C,S]);return(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 flex-initial",children:[(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:"Auto-reload"}),(0,a.jsx)(Q.Toggle,{"aria-label":"Enable Auto-reload",checked:p,size:"large",onChange:()=>{f(e=>{let a=!e;return a&&h({minimumBalance:"5",targetBalance:"25",maximumMonthlySpend:""}),C({}),a})}})]}),(0,a.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-4 flex-initial",children:[(0,a.jsx)(J.Input,{"aria-labelledby":"balance-trigger-label",label:"When balance falls below",width:"100%",suffix:"USD",value:ea({autoRechargeConfig:m,draftAutoRechargeConfig:g,type:"minimumBalance"}),onChange:e=>{h(()=>B("minimumBalance",e.target.value)),v.minimumBalance&&C(e=>({...e,minimumBalance:void 0}))},disabled:!p,suffixStyling:!1,error:v.minimumBalance}),(0,a.jsx)(J.Input,{"aria-labelledby":"balance-reload-label",label:"Recharge to target balance",width:"100%",suffix:"USD",value:ea({autoRechargeConfig:m,draftAutoRechargeConfig:g,type:"targetBalance"}),onChange:e=>{h(()=>B("targetBalance",e.target.value)),v.targetBalance&&C(e=>({...e,targetBalance:void 0}))},disabled:!p,suffixStyling:!1,error:v.targetBalance})]}),(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:(0,a.jsx)(J.Input,{"aria-labelledby":"max-spend-label",label:"Maximum monthly spend",width:"100%",suffix:"USD",placeholder:ea({autoRechargeConfig:m,draftAutoRechargeConfig:g,type:"maximumMonthlySpend"}),value:ea({autoRechargeConfig:m,draftAutoRechargeConfig:g,type:"maximumMonthlySpend"}),onChange:e=>{h(()=>B("maximumMonthlySpend",e.target.value)),v.maximumMonthlySpend&&C(e=>({...e,maximumMonthlySpend:void 0}))},disabled:!p,suffixStyling:!1,error:v.maximumMonthlySpend})})]}),(0,a.jsxs)("div",{className:"flex flex-row items-stretch justify-end gap-2 flex-initial",children:[l?(0,a.jsx)(r.Button,{type:"secondary",onClick:l,size:"small",children:"Cancel"}):null,(0,a.jsx)(r.Button,{onClick:T,loading:"in_progress"===y,disabled:!M,size:"small",children:"Save Changes"})]})]})}e.s(["AutoRechargeForm",()=>et],1080526);var ei=e.i(5610834);function er(e){let{activeModalType:t,setActiveModalType:i,autoRechargeConfig:r}=e,n=(0,ei.useParams)(),o="string"==typeof n?.teamSlug?n.teamSlug:void 0,{topups:c}=(0,Y.useAiGatewayCreditTopups)(),d=c?.some(e=>"orb_ledger"===e.provider.type&&"miu"===e.provider.currency)??!1;return(0,a.jsxs)(l.Modal.Modal,{active:"auto_recharge"===t,onClickOutside:()=>i(null),children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsx)(l.Modal.Header,{children:(0,a.jsx)(l.Modal.Title,{children:"Enable Auto-reload"})}),d&&o?(0,a.jsx)(s.Note,{fill:!0,children:(0,a.jsxs)("p",{className:"text-copy-14",children:["Buy with MIU is enabled for AI Gateway. Auto-reload is managed in your"," ",(0,a.jsx)(R.Link,{href:`/${o}/~/settings/billing#plan`,variant:"highlight",children:"billing settings"}),"."]})}):(0,a.jsx)(et,{autoRechargeConfig:r,onCancel:()=>i("top_up"),onComplete:()=>i("top_up")})]}),d&&(0,a.jsx)(l.Modal.Actions,{children:(0,a.jsx)(l.Modal.Action,{type:"secondary",onClick:()=>i("top_up"),children:"Back"})})]})}var en=e.i(3089600),el=e.i(2166755),es=e.i(7837522),eo=e.i(7780974);let ec=(0,t.createContext)(null);function ed(e){let{children:r,isUpdatedStripeElementsEnabled:n,isAutoRechargeEnabled:l}=e,{openModal:s,closeModal:o,modals:d}=function(e){let{isUpdatedStripeElementsEnabled:r,isAutoRechargeEnabled:n}=e,{data:l,mutate:s}=(0,x.default)("modal:ai-credits",{fallbackData:null}),o=(0,t.useRef)(void 0),{track:d,isReady:u}=(0,es.useTrackActivity)(),[p,f]=(0,t.useState)(void 0),{autoRechargeConfig:g}=q(),{balance:y}=(0,i.useAiCreditsBalance)(),{team:b}=(0,c.useTeam)(),{account:v}=(0,m.useAccount)(),C=(0,el.useEnvironment)(v),S=(0,t.useRef)(null);(0,en.default)("modal",(e,a)=>{"top-up"===e&&f(`modal-query${a?.source?`.${a.source}`:""}`)},["source"]);let M=(0,t.useCallback)(e=>{o.current=e,s("top_up"),d(eo.VercelActivityAction.AiGatewayAddCreditsModalOpened,{source:e,previousBalance:y,autoRechargeConfig:g})},[d,y,g,s]);(0,t.useEffect)(()=>{p&&u&&(M(p),f(void 0))},[p,u,M]);let A=(0,t.useCallback)(()=>{s(null),S.current?.(),o.current=void 0},[s]),w=(0,t.useCallback)(e=>{d(eo.VercelActivityAction.AiGatewayAddCreditsModalCompleted,{source:o.current,previousBalance:y,...e,autoRechargeConfig:e.autoRechargeConfig??g})},[g,d,y]),k=(0,a.jsxs)(h.CopperProvider,{environment:C,teamIdOrSlug:b?.id,clearPaymentStateRef:S,children:[(0,a.jsx)(j,{activeModalType:l??null,setActiveModalType:s,closeModal:A,isAutoRechargeEnabled:n,autoRechargeConfig:g}),(0,a.jsx)(L,{activeModalType:l??null,setActiveModalType:s,closeModal:A,isUpdatedStripeElementsEnabled:r,onConversion:w}),(0,a.jsx)(V.default,{active:"add_card"===l,onAdded:()=>{s("checkout")},onCancel:()=>{s("checkout")}}),(0,a.jsx)(er,{activeModalType:l??null,setActiveModalType:s,autoRechargeConfig:g},JSON.stringify(g))]});return{openModal:M,closeModal:A,modals:k}}({isUpdatedStripeElementsEnabled:n,isAutoRechargeEnabled:l});return(0,a.jsxs)(ec.Provider,{value:{openModal:s,closeModal:o,modals:d},children:[r,d]})}function eu(){let e=(0,t.useContext)(ec);if(!e)throw Error("useAddCreditsModalContext must be used within AddCreditsModalProvider");return e}e.s(["AddCreditsModalProvider",()=>ed,"useAddCreditsModalContext",()=>eu],7612113)},231107,e=>{"use strict";var a=e.i(5169864),t=e.i(3089600);function i(){let[e,i]=(0,a.useState)();return(0,t.default)("source",e=>{i(e)}),e}e.s(["useSourceFromParams",()=>i])},4375105,e=>{"use strict";var a=e.i(1146226),t=e.i(2831393),i=e.i(2504781),r=e.i(5255926),n=e.i(5468328),l=e.i(5169864),s=e.i(6347389),o=e.i(7612113),c=e.i(1717203),d=e.i(7557283),u=e.i(5338940),m=e.i(4597921),p=e.i(231107);function f(){let{type:e="inline"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=(0,p.useSourceFromParams)(),{can:x}=(0,c.default)(),g=x(d.Action.Update,d.Resource.PaymentMethod),{team:h,isReady:y}=(0,u.useTeam)(),{balance:b,hasEverPaid:v}=(0,t.useAiCreditsBalance)(),{openModal:C}=(0,o.useAddCreditsModalContext)(),j=h?.billing?.status==="overdue",S=(0,l.useCallback)(e=>{if(void 0===e)return"";let a=Math.max(0,e);return a<100?a.toFixed(2):a<1e3?a.toFixed(0):`${(a/1e3).toFixed(0)}k`},[]),M=(0,m.useServerFlag)("enable-ai-gateway-free-usage-insights",!1);return(0,a.jsx)("div",{className:"flex items-center gap-2",children:void 0!==b&&y?(0,a.jsx)(n.Tooltip,{position:"bottom",disableTriggers:g&&!j,boxAlign:"center",text:g?"AI Gateway credit purchases are disabled due to an overdue invoice.":"You need additional permissions to manage your team’s AI Gateway credit.",children:(0,a.jsx)(i.Button,{type:"on-demand"===e?"default":"secondary",size:"on-demand"===e?"small":void 0,disabled:!g||j,onClick:()=>C(f?`credits-button.${f}`:"credits-button"),prefix:"inline"===e?(0,a.jsx)(s.Coins,{}):void 0,children:"inline"===e?`${S(b)} ${M&&!1===v?"Free Credit":"Credit"}`:"Buy Credit"})}):(0,a.jsx)(r.Skeleton,{children:(0,a.jsx)(i.Button,{type:"on-demand"===e?"default":"secondary",size:"on-demand"===e?"small":void 0,prefix:"inline"===e?(0,a.jsx)(s.Coins,{}):void 0,children:"inline"===e?"Loading Credit":"Buy Credit"})})})}e.s(["ViewBalanceAndPurchaseCreditsModal",()=>f])},1912982,e=>{"use strict";var a=e.i(2405338),t=e.i(8042625),i=e.i(5338940);function r(){let{start:e,end:r,currency:n,configuration:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{team:s}=(0,i.useTeam)(),o="string"==typeof e?e:e?.toISOString(),c="string"==typeof r?r:r?.toISOString(),d=function(e){let{teamId:a,start:t,end:i,currency:r,configuration:n}=e,l={};if(a&&(l.teamId=a),t&&(l.start=t),i&&(l.end=i),l.property="subtotal",r&&(l.currency="string"==typeof r?r:String(r)),n&&"type"in n&&n.type&&(l["configuration.type"]="string"==typeof n.type?n.type:String(n.type),"options"in n&&n.options&&"currency"in n.options&&n.options.currency)){let e=n.options.currency;l["configuration.options.currency"]="string"==typeof e?e:String(e)}return l}({teamId:s?.id,start:o,end:c,currency:n,configuration:l}),{data:u,error:m,isLoading:p,mutate:f}=(0,a.default)(s?.id?`/api/purchase-intents/aggregate${(0,t.encode)(d)}`:null,async e=>{let a=await fetch(e);if(!a.ok)throw Error(a.statusText);return a.json()});return{count:u?.count,total:u?.total,loading:p,error:m,mutate:f}}e.s(["usePurchaseIntentAggregate",()=>r])}]);

//# debugId=56b19a91-cd80-50e1-1747-5a48486b601a
//# sourceMappingURL=c9c1812d10267cd2.js.map