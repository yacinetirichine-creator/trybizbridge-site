;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="854ddf87-ee10-ad06-5c2c-6ffd430d6c6b")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,3161407,e=>{"use strict";var t=e.i(1146226),r=e.i(5169864),a=e.i(5255926),i=e.i(57106),n=e.i(5610834),o=e.i(5468328),s=e.i(2988836),l=e.i(199192),u=e.i(7225234),c=e.i(5182595),m=e.i(3351543),d=e.i(9623643),g=e.i(7797615),p=e.i(9179929),h=e.i(5481907),f=e.i(1583188),v=e.i(639493),y=e.i(6062041),S=e.i(9031477),T=e.i(9171296),C=e.i(1802690);function b(e){let{contextFilter:i,variant:o="chart",onPreviewClick:s,isFluidEnabled:l,showFluidUpsell:u}=e,p=(0,n.useParams)(),{data:v,isLoading:T,isRelativeTime:C}=(0,h.useSonarQuery)({event:"serverlessFunctionBilling",rollups:{billedGbhr:{measure:"billedDurationGbhr",aggregation:"sum"},actualGbhr:{measure:"requestDurationGbhr",aggregation:"sum"}},tailRollup:"truncate",summaryOnly:!1,contextFilter:i}),b="Compute Saved",R=(0,r.useMemo)(()=>v?.data?v.data.map(e=>{let t=e.billedGbhr>e.actualGbhr?0:e.actualGbhr-e.billedGbhr;return{name:e.timestamp.toISOString(),[b]:0===e.billedGbhr?null:(0,y.calculatePercentage)(t,e.actualGbhr)}}):[],[v?.data,b]),j=(0,r.useMemo)(()=>v?.data?v.data.map(e=>{let t=e.billedGbhr>e.actualGbhr?0:e.actualGbhr-e.billedGbhr;return{name:e.timestamp.toISOString(),Saved:t,Consumed:e.billedGbhr}}):[],[v?.data]),P=(0,r.useMemo)(()=>{let{sumSaved:e,sumConsumed:t}=j.reduce((e,t)=>({sumSaved:e.sumSaved+t.Saved,sumConsumed:e.sumConsumed+t.Consumed}),{sumSaved:0,sumConsumed:0});return(0,y.calculatePercentage)(e,t+e)},[j]),L=(0,r.useMemo)(()=>[0,Math.max(...j.map(e=>e.Consumed))],[j]),w=(0,r.useMemo)(()=>{let e=["Consumed"],t=(v?.summary[0]?.billedGbhr??0)-(v?.summary[0]?.actualGbhr??0);return(l||t>.001)&&e.push("Saved"),e},[v?.summary,l]),E=(0,d.numberFormat)({significantDigits:2,maximumFractionDigits:2,roundingPriority:"morePrecision",suffix:" GB-hrs"}),F=(0,r.useMemo)(()=>{if(l)return"Fluid"},[l]);return"gbhrs"===o?(0,t.jsx)(c.LineChart,{categories:w,data:j,sonarQueryResults:v,formatValue:e=>E(e||0),getColor:e=>"Saved"===e?"var(--ds-pink-700)":"var(--ds-blue-700)",isLoading:T,isRelativeTime:C,lineType:"linear",showRollup:!0,title:null,yAxisDomain:L}):"preview"===o?u?(0,t.jsx)(x,{params:p,variant:"compact",onPreviewClick:s}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.ChartCard,{onClick:s,size:"tiny",children:(0,t.jsx)(f.PreviewTileContent,{isLoading:T,label:"Compute Model",value:F||""})}),(0,t.jsx)(m.ChartCard,{onClick:s,size:"tiny",children:(0,t.jsx)(f.PreviewTileContent,{isLoading:T,label:"Compute Saved",subLabel:"%",value:(0,g.formatPercentage)(P||0)})})]}):(0,t.jsxs)(t.Fragment,{children:[u?(0,t.jsx)(m.ChartCard,{size:"small",children:(0,t.jsx)(x,{params:p})}):(0,t.jsx)(S.ShareDomCopy,{title:"Compute Saved",children:(0,t.jsx)(m.ChartCard,{size:"small",children:(0,t.jsx)(c.LineChart,{categories:[b],data:R,sonarQueryResults:v,formatValue:g.formatPercentage,getColor:()=>"var(--ds-pink-700)",isLoading:T,isRelativeTime:C,rollupConfig:{method:"avg",showTrend:!1,getValue:e=>P},showRollup:!0,title:F||(0,t.jsx)(a.Skeleton,{className:"mt-1",height:16,width:100})})})}),(0,t.jsx)(S.ShareDomCopy,{title:"GB-Hours Usage",children:(0,t.jsx)(m.ChartCard,{size:"small",children:(0,t.jsx)(c.LineChart,{categories:w,data:j,sonarQueryResults:v,formatValue:e=>E(e||0),getColor:e=>"Saved"===e?"var(--ds-pink-700)":"var(--ds-blue-700)",isLoading:T,isRelativeTime:C,showRollup:!0,title:l?"GB-Hours Saved":"GB-Hours Usage",yAxisDomain:L})})})]})}function x(e){let{params:r,variant:a="full",onPreviewClick:n}=e;return"compact"===a?(0,t.jsxs)(m.ChartCard,{className:"col-span-2 flex flex-row items-center gap-1 py-0.5",size:"tiny",onClick:n,children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-copy-14 font-medium",children:"Configure Fluid"}),(0,t.jsx)("p",{className:"text-copy-14 text-xs text-gray-900",children:"Optimize performance & reduce cost"})]}),(0,t.jsx)("div",{className:"flex flex-row gap-6",children:(0,t.jsx)(i.ButtonLink,{"aria-label":"Configure Fluid",href:`/${r.teamSlug}/${r.project}/settings/functions`,shape:"square",size:"tiny",svgOnly:!0,type:"secondary",children:(0,t.jsx)(l.ChevronRightSmall,{})})})]}):(0,t.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-1",children:[(0,t.jsx)("div",{className:"size-8 flex items-center justify-center rounded-md border",children:(0,t.jsx)(C.Fluid,{color:"gray-900"})}),(0,t.jsx)("p",{className:"font-medium",children:"Optimize Performance with Fluid compute"}),(0,t.jsx)("p",{className:"mb-2 text-center text-sm text-gray-900 text-balance",children:"Fluid compute will automatically optimize performance and reduce cost."}),(0,t.jsxs)("div",{className:"flex flex-row gap-6",children:[(0,t.jsx)(i.ButtonLink,{href:`/${r.teamSlug}/${r.project}/settings/functions`,size:"small",children:"Configure Fluid"}),(0,t.jsx)(i.Link,{external:!0,href:"/docs/fluid-compute",variant:"highlight",children:"Learn More"})]})]})}function R(e){let{contextFilter:r,variant:a="chart"}=e,{data:i,isLoading:n,isRelativeTime:o,builderQuery:s}=(0,h.useSonarQuery)({event:"serverlessFunctionInvocation",rollups:{total:{measure:"count",aggregation:"sum"},value:{measure:"count",aggregation:"percent"}},groupBy:["functionStartType"],contextFilter:r}),l=(0,p.useTimeseriesData)(i,{filter:e=>"unknown"!==e.functionStartType&&""!==e.functionStartType,category:e=>({cold:"Cold",prewarmed:"Prewarmed",hot:"Hot"})[e.functionStartType]||e.functionStartType,value:e=>e.total&&"number"==typeof e.total&&0===e.total||0===e.value?null:e.value});if("preview"===a){let e=i?.summary.find(e=>"cold"===e.functionStartType)?.value;return(0,t.jsx)(f.PreviewTileContent,{isLoading:n,label:"Cold Start",subLabel:"%",value:"number"==typeof e?(0,y.formatPercentageChart)(e):"-"})}return(0,t.jsx)(c.LineChart,{builderQuery:s?.value,data:l??[],sonarQueryResults:i,formatValue:y.formatPercentageChart,getColor:e=>"Cold"===e?"var(--ds-blue-700)":"Prewarmed"===e?"var(--ds-pink-700)":"Unknown"===e?"var(--ds-gray-600)":"var(--ds-amber-700)",isLoading:n,isRelativeTime:o,placeholderKeys:["Hot","Cold","Prewarmed"],rollupConfig:{method:"avg",interpretation:"increaseNegative",showTrend:!0,getValue:e=>i?.summary.find(t=>t.functionStartType===e.toLowerCase())?.value??null},showRollup:!0,title:"Start Type",yAxisDomain:[0,100]})}function j(e){let{contextFilter:a,variant:i="chart"}=e,{data:n,isLoading:o,isRelativeTime:s,builderQuery:l}=(0,h.useSonarQuery)({event:"serverlessFunctionInvocation",rollups:{avgTtfb:{measure:"ttfbMs",aggregation:"avg"},p75Ttfb:{measure:"ttfbMs",aggregation:"p75"},p95Ttfb:{measure:"ttfbMs",aggregation:"p95"}},tailRollup:"truncate",summaryOnly:!1,contextFilter:a},{demoConfig:{rollups:{avgTtfb:{base:250,variation:20},p75Ttfb:{base:200,variation:50},p95Ttfb:{base:800,variation:200}}}}),u=(0,r.useMemo)(()=>n?.data?n.data.map(e=>({name:e.timestamp.toISOString(),Average:e.avgTtfb,P75:e.p75Ttfb,P95:e.p95Ttfb})):[],[n?.data]);if("preview"===i){let e=(0,v.createRollupCalculator)(u,"P75")("avg");return(0,t.jsx)(f.PreviewTileContent,{isLoading:o,label:"Time to First Byte",subLabel:"P75",value:e?(0,g.formatDuration)(e):"-"})}return(0,t.jsx)(c.LineChart,{builderQuery:l?.avgTtfb,categories:["Average","P75","P95"],data:u,sonarQueryResults:n,formatValue:g.formatDuration,getColor:e=>"Average"===e?"var(--ds-gray-800)":"P75"===e?"var(--ds-blue-600)":"var(--ds-blue-800)",isLoading:o,isRelativeTime:s,placeholderKeys:["Average","P75","P95"],rollupConfig:{method:"avg",showTrend:!1},showRollup:!0,title:"Time to First Byte"})}function P(e){let{contextFilter:a,variant:i="chart"}=e,{data:n,isLoading:o,isRelativeTime:s,builderQuery:l}=(0,h.useSonarQuery)({event:"serverlessFunctionInvocation",rollups:{p75Memory:{measure:"peakMemoryMb",aggregation:"p75"},p95Memory:{measure:"peakMemoryMb",aggregation:"p95"},avgMemory:{measure:"peakMemoryMb",aggregation:"avg"},provisioned:{measure:"provisionedMemoryMb",aggregation:"max"}},tailRollup:"truncate",summaryOnly:!1,contextFilter:a}),m=(0,r.useMemo)(()=>n?.data?n.data.map(e=>{let{timestamp:t,avgMemory:r,p75Memory:a,p95Memory:i}=e;return{name:t.toISOString(),Average:r,P75:a,P95:i}}):[],[n?.data]),d=(0,r.useMemo)(()=>n?.data?.slice().reverse().find(e=>null!=e.provisioned)?.provisioned??0,[n?.data]),p=.85*d;if("preview"===i){let e=(0,v.createRollupCalculator)(m,"Average")("avg");return(0,t.jsx)(f.PreviewTileContent,{isLoading:o,label:"Memory Usage",subLabel:"Avg",suffix:d?`/ ${(0,g.formatBytes)(1e3*d*1e3)}`:void 0,value:e?(0,g.formatBytes)(1e3*e*1e3):"-"})}return(0,t.jsx)(c.LineChart,{builderQuery:l?.maxMemory,customChartContent:d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.ReferenceLine,{stroke:"var(--ds-red-600)",strokeDasharray:"6 3",strokeOpacity:.6,x:m[m.length-1]?.name,y:d}),(0,t.jsx)(u.ReferenceLine,{stroke:"var(--ds-amber-600)",strokeDasharray:"3 6",strokeOpacity:.8,x:m[m.length-1]?.name,y:p})]}):null,data:m,sonarQueryResults:n,disableLegend:!0,formatValue:e=>0===e?"0":(0,g.formatBytes)(1e3*e*1e3),getColor:e=>"P75"===e?"var(--ds-blue-600)":"P95"===e?"var(--ds-blue-800)":"Average"===e?"var(--ds-gray-800)":"var(--ds-gray-700)",isLoading:o,isRelativeTime:s,placeholderKeys:["Average","P75","P95"],rollupConfig:{method:"avg",showTrend:!1},showRollup:!0,title:"Memory Usage",yAxisDomain:[0,d]})}function L(e){let{contextFilter:a,variant:i="chart"}=e,{data:n,isLoading:o,isRelativeTime:s,builderQuery:l}=(0,h.useSonarQuery)({event:"serverlessFunctionInvocation",rollups:{Average:{measure:"cpuThrottlePercent",aggregation:"avg"},P75:{measure:"cpuThrottlePercent",aggregation:"p75"},P95:{measure:"cpuThrottlePercent",aggregation:"p95"}},filter:"isAdditionalRequest eq 0",tailRollup:"truncate",summaryOnly:!1,contextFilter:a}),u=(0,r.useMemo)(()=>n?.data?n.data.map(e=>{let{timestamp:t,P75:r,Average:a,P95:i}=e;return{name:t.toISOString(),Average:a,P75:r,P95:i}}):[],[n?.data]);if("preview"===i){let e=(0,v.createRollupCalculator)(u,"P75")("avg");return(0,t.jsx)(f.PreviewTileContent,{isLoading:o,label:"CPU Throttle",subLabel:"P75",value:e?(0,g.formatPercentage)(e):"–"})}return(0,t.jsx)(c.LineChart,{builderQuery:l?.cpuThrottleMsAvg,data:u,sonarQueryResults:n,disableLegend:!0,formatValue:e=>(0,g.formatPercentage)(e),getColor:e=>"Average"===e?"var(--ds-gray-800)":"P75"===e?"var(--ds-blue-600)":"var(--ds-blue-800)",isLoading:o,isRelativeTime:s,placeholderKeys:["Average","P75","P95"],rollupConfig:{method:"avg",showTrend:!1},showRollup:!0,title:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 font-medium",children:["CPU Throttle",(0,t.jsx)(F,{})]})})}function w(e){let{contextFilter:a,variant:i="chart"}=e,{data:n,isLoading:o,isRelativeTime:s,builderQuery:l}=(0,h.useSonarQuery)({event:"serverlessFunctionInvocation",rollups:{Average:{measure:"functionCpuTimeMs",aggregation:"avg"},P75:{measure:"functionCpuTimeMs",aggregation:"p75"},P95:{measure:"functionCpuTimeMs",aggregation:"p95"}},tailRollup:"truncate",summaryOnly:!1,contextFilter:a}),u=(0,r.useMemo)(()=>n?.data?n.data.map(e=>{let{timestamp:t,P75:r,Average:a,P95:i}=e;return{name:t.toISOString(),Average:a,P75:r,P95:i}}):[],[n?.data]);if("preview"===i){let e=(0,v.createRollupCalculator)(u,"P75")("avg");return(0,t.jsx)(f.PreviewTileContent,{isLoading:o,label:"Active CPU",subLabel:"P75",value:e?(0,g.formatDuration)(e):"–"})}return(0,t.jsx)(c.LineChart,{builderQuery:l?.cpuThrottleMsAvg,data:u,sonarQueryResults:n,disableLegend:!0,formatValue:e=>(0,g.formatDuration)(e),getColor:e=>"Average"===e?"var(--ds-gray-800)":"P75"===e?"var(--ds-blue-600)":"var(--ds-blue-800)",isLoading:o,isRelativeTime:s,placeholderKeys:["Average","P75","P95"],rollupConfig:{method:"avg",showTrend:!1},showRollup:!0,title:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 font-medium",children:["Active CPU",(0,t.jsx)(M,{})]})})}function E(e){let{contextFilter:r,variant:a="chart",onPreviewClick:i}=e,n="preview"===a?"tiny":"small",o="preview"===a?i:void 0;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.ShareDomCopy,{title:"Active CPU",children:(0,t.jsx)(m.ChartCard,{onClick:o,size:n,children:(0,t.jsx)(w,{contextFilter:r,variant:a})})}),(0,t.jsx)(S.ShareDomCopy,{title:"Memory Usage",children:(0,t.jsx)(m.ChartCard,{onClick:o,size:n,children:(0,t.jsx)(P,{contextFilter:r,variant:a})})}),(0,t.jsx)(S.ShareDomCopy,{title:"CPU Throttle",children:(0,t.jsx)(m.ChartCard,{onClick:o,size:n,children:(0,t.jsx)(L,{contextFilter:r,variant:a})})}),(0,t.jsx)(T.LockedCard,{upgradeUseCase:"function-performance",disableOverlay:"preview"===a,children:(0,t.jsx)(S.ShareDomCopy,{title:"TTFB",children:(0,t.jsx)(m.ChartCard,{onClick:o,size:n,children:(0,t.jsx)(j,{contextFilter:r,variant:a})})})}),(0,t.jsx)(S.ShareDomCopy,{title:"Function Start Type",children:(0,t.jsx)(m.ChartCard,{onClick:o,size:n,children:(0,t.jsx)(R,{contextFilter:r,variant:a})})})]})}function F(){return(0,t.jsx)(o.Tooltip,{maxWidth:"300px",text:(0,t.jsx)(t.Fragment,{children:"The percentage of time that the function instance is forced to wait because there is no CPU available. High percentages indicate the function instance is CPU starved. Increasing the memory size or improving the code performance may lower this value."}),children:(0,t.jsx)(i.Link,{external:!0,href:"/docs/functions/configuring-functions/memory",icon:!1,children:(0,t.jsx)(s.InformationFillSmall,{})})})}function M(){return(0,t.jsx)(o.Tooltip,{maxWidth:"300px",text:(0,t.jsx)(t.Fragment,{children:"The time your code actively runs on the function instance."}),children:(0,t.jsx)(i.Link,{external:!0,href:"/docs/fluid-compute/pricing#how-pricing-works",icon:!1,children:(0,t.jsx)(s.InformationFillSmall,{})})})}function O(){let{data:e,isLoading:a,isRelativeTime:i}=(0,h.useSonarQuery)({event:"serverlessFunctionInvocation",rollups:{cpuTimeMs:{measure:"functionCpuTimeMs",aggregation:"sum"}},tailRollup:"truncate",summaryOnly:!1}),n=(0,r.useMemo)(()=>e?.data?e.data.map(e=>{let{timestamp:t,cpuTimeMs:r}=e;return{name:t.toISOString(),"Active CPU":r}}):[],[e?.data]);return(0,t.jsx)(c.LineChart,{data:n,sonarQueryResults:e,getColor:()=>"var(--ds-blue-700)",isLoading:a,isRelativeTime:i,placeholderKeys:["Active CPU"],formatValue:e=>(0,g.formatDuration)(e),lineType:"linear",showRollup:!0,title:null})}e.s(["AdvancedCharts",()=>E,"CPUThrottleChart",()=>L,"CpuUsageChart",()=>w,"FluidComputeCpuSaved",()=>O,"FunctionComputeSaved",()=>b,"FunctionStartTypeChart",()=>R,"MemoryUsageChart",()=>P,"TTFBChart",()=>j])},1246255,7239573,e=>{"use strict";var t=e.i(1511518),r=e.i(516467);function a(e,a,i){let n=(0,r.toDate)(e,i?.in);return n.setTime(n.getTime()+a*t.millisecondsInMinute),n}function i(e,t,r){return a(e,-t,r)}e.s(["addMinutes",()=>a],7239573),e.s(["subMinutes",()=>i],1246255)},5481907,e=>{"use strict";var t=e.i(5169864),r=e.i(2405338),a=e.i(277234),i=e.i(4244280),n=e.i(1233856),o=e.i(3737038),s=e.i(1511518),l=e.i(1667062),u=e.i(7239573),c=e.i(6092370),m=e.i(268049),d=e.i(1246255),g=e.i(818351),p=e.i(9667097),h=e.i(2749380),f=e.i(5297450),v=e.i(8151845),y=e.i(4337458),S=e.i(5610834),T=e.i(9486194),C=e.i(8690335),b=e.i(1813317),x=e.i(5269510);let R=e=>(r,a,i)=>{let n=(0,t.useRef)(void 0),o=e(r,a,i);(0,t.useEffect)(()=>{void 0!==o.data&&Array.isArray(r)&&r[1]&&(n.current=o.data)},[o.data,r]);let s=(0,t.useCallback)(()=>{n.current=void 0},[]);Array.isArray(r)&&!r[1]&&(n.current=void 0);let l=void 0===o.data?n.current:o.data,u=void 0===o.data&&void 0!==n.current;return Object.assign(o,{currentData:l,isLagging:u,resetLaggy:s})};function j(e,r){let a,i=(0,t.useMemo)(()=>{if(e)return{...e}},[e]),d=(a=(0,S.useSearchParams)(),(0,t.useCallback)(e=>{let{rollups:t,by:r,event:i,filter:n}=e;if(!t||!i||!T.queryBuilderEvents.includes(i))return;let o=(0,b.getGroupableDimensions)(i);if(n&&(0,C.parseFilters)(n).some(e=>!o.includes(e.dimension)))return;r=r?.filter(e=>o.includes(e));let s=a?.get("period"),l=a?.get("from"),u=a?.get("to"),c=l&&u?{from:new Date(1e3*Number(l)),to:new Date(1e3*Number(u))}:s;return Object.entries(t).reduce((e,t)=>{let[a,o]=t,{measure:s,aggregation:l}=o;return e[a]={metric:`${i}.${s}`,by:r||[],filter:n||"",aggregation:l,time:c||""},e},{})},[a])),{start:x,end:R,isRelativeTime:j}=(0,v.useRangeFromQueryState)(),[{environment:P}]=(0,v.useSonarQueryState)(),L=(0,y.useSonarQueryScopeWithSlug)(),w=(0,y.useSonarQueryScope)(),E=(0,f.useShouldShowDemoData)();if(i&&!i.scope&&(i.scope=L),i){let e=i.startTime||x,t=i.endTime||R;i.granularity=i.granularity||(0,h.getGranularityFromDuration)(Math.round(t.getTime()-e.getTime()),i.lowGranularity),i.startTime=(0,n.startOfDuration)(i.startTime||e,i.granularity),i.endTime=(0,n.endOfDuration)(i.endTime||t,i.granularity)}i&&!i.reason&&(i.reason="observability_chart");let F=r?.noEnvironmentFilter===!0,M=r?.builderQueryFilter||i?.filter;if(i&&"all"!==P&&!F&&(i.filter=(0,c.andFilterStrings)(`environment eq '${P}'`,i.filter),M=(0,c.andFilterStrings)(`environment eq '${P}'`,M)),i&&(i.filter=(0,c.andFilterStrings)(i.filter,(0,c.serializeObjectFilter)(i.contextFilter)),M=(0,c.andFilterStrings)(M,(0,c.serializeObjectFilter)(i.contextFilter)),w?.type==="project"&&(M=(0,c.andFilterStrings)(`projectId eq '${w.projectIds[0]}'`,M)),r?.useQueryCache))try{{let e=new URLSearchParams(window.location.search).get("queryId");e&&(i.queryId=e)}}catch{}let O=d({event:i?.event,rollups:i?.rollups,by:i?.groupBy?.filter(e=>"projectName"!==e),filter:M}),D=i?.granularity&&j?(0,m.milliseconds)(i.granularity):0,A=!!((r?.showDemoData||E)&&r?.demoConfig),I=(0,t.useMemo)(()=>!i||A?null:JSON.stringify(i),[i,A]),{isLoading:_,...Q}=(0,g.useIsomorphicSWR)(I,async()=>{if(i?.scope)return(0,p.getSonarData)(i)},{refreshInterval:r?.disableRefetch===!0?0:D,revalidateOnFocus:!1,revalidateOnReconnect:!1,revalidateIfStale:!1,keepPreviousData:!1,errorRetryCount:0,ssr:{timeout:4e3}}),U=(r?.showDemoData||E)&&r?.demoConfig&&i?JSON.stringify({event:i.event,by:i.groupBy,rollups:i.rollups,durationMs:i.endTime&&i.startTime?i.endTime.getTime()-i.startTime.getTime():0,granularity:i.granularity}):null,k=(0,t.useMemo)(()=>{if(U&&r?.demoConfig)return function(e,t){let r,{startTime:a,endTime:i,granularity:n,groupBy:c=[]}=e,m=(r=(0,l.differenceInMilliseconds)(i,a)/s.millisecondsInMinute,(0,o.getRoundingMethod)(void 0)(r)),d=n.minutes||15,g=Math.ceil(m/d/("lowGranularity"in e?4:1)),p=[],h=[],f=Object.keys(t.rollups),v=0,y=e=>!!e&&"object"==typeof e&&"base"in e&&"variation"in e&&"number"==typeof e.base&&"number"==typeof e.variation,S=(e=>{if(0===e.length)return[{}];let r=[{}];for(let a of e){let e=[];if(t.groupValues?.[a])e=t.groupValues[a];else{let r=new Set;for(let e of Object.values(t.rollups))if(!y(e)&&e.groupConfigs){let t=e.groupConfigs;t[a]&&Object.keys(t[a]).forEach(e=>{r.add(e)})}e=Array.from(r)}if(0===e.length)throw Error(`No values found for group field "${a}". Please provide groupValues or groupConfigs for this field.`);let i=[];for(let t of r)for(let r of e)i.push({...t,[a]:r});r=i}return r})(c),T=e.rollups;for(let e of S){let r={...e},i={};for(let r=0;r<g;r++){let n=(0,u.addMinutes)(a,r*d),o={timestamp:n,...e};for(let r of f){let a,s=t.rollups[r],l=T[r];if(void 0===s)continue;if(y(s))a=s;else for(let[t,r]of(a=s.defaultConfig,Object.entries(e)))if(s.groupConfigs?.[t]?.[r]){a=s.groupConfigs[t][r];break}let{base:u=0,variation:c=0,diurnalPattern:m=!1}=a,d=u+(Math.random()-.5)*c;m&&(d*=1+.3*Math.sin(n.getHours()/24*Math.PI*2)),a.allowNegative||(d=Math.max(0,d));let g=l?.aggregation;"sum"===g?d=Math.round(d):"avg"===g||("p75"===g?d+=Math.random()*c*.5:d=Math.round(d)),o[r]=d,i[r]||(i[r]=[]),i[r].push(d),v+=d}p.push(o)}for(let e of f){let t=i[e],a=T[e],n=a?.aggregation,o=null;if(t&&0!==t.length)switch(n){case"avg":o=t.reduce((e,t)=>e+t,0)/t.length;break;case"p75":{t.sort((e,t)=>e-t);let e=Math.floor(.75*(t.length-1));o=t[e]||0;break}default:o=t.reduce((e,t)=>e+t,0)}else o=null;r[e]=o||0}h.push(r)}return{data:e.summaryOnly?void 0:p,query:e,summary:h,statistics:{rowsRead:v,bytesRead:46*v,dbTimeSeconds:.1+.1*Math.random(),engineTimeSeconds:.1+.1*Math.random(),queryTable:"demo"}}}(i,r.demoConfig)},[U]);return k?{...Q,isRelativeTime:!0,data:k,isLoading:!1}:{...Q,builderQuery:O,isRelativeTime:j,isLoading:_||Q.isValidating||!i?.scope}}function P(e,a){let i=(0,y.useSonarQueryScope)(),o=(0,t.useMemo)(()=>{if(!e)return null;let t={...e};return t.scope||(t.scope=i),JSON.stringify(t)+(a?"-live":"-static")},[e,i,a]);return(0,r.default)(o,async()=>{if(!e)return;let t={...e};if(t.scope||(t.scope=i),a){let e=new Date,r=(0,n.endOfDuration)((0,d.subMinutes)(e,1),{seconds:10});t.startTime=(0,n.startOfDuration)(new Date(e.getTime()-6e5),{seconds:10}),t.endTime=r}if(t.scope)return(0,p.getSonarData)(t)},{refreshInterval:e?.granularity&&a?(0,m.milliseconds)({seconds:8}):0,revalidateOnFocus:!1,revalidateOnReconnect:!1,use:[R],onErrorRetry:(e,t,r,a,i)=>{let{retryCount:n}=i;401===e.status||403===e.status||n>=3||setTimeout(()=>void a({retryCount:n}),2500)}})}function L(){let e=(0,v.useRangeFromQueryState)(),t=(0,y.useSonarQueryScope)(),[{environment:o}]=(0,v.useSonarQueryState)(),s={minutes:15},l={from:(0,n.startOfDuration)(e.start,s),to:(0,n.endOfDuration)(e.end,s),scope:t,environment:o};return{isRelativeTime:e.isRelativeTime,...(0,r.default)(l,async e=>{if(e.scope)return await (0,a.fetchAPI)(`${i.API_OBSERVABILITY_BUILD_DIAGNOSTICS}?${(0,x.stringify)((0,p.getSonarTeamParam)(e.scope))}`,{method:"POST",body:JSON.stringify(e),throwOnHTTPError:!0})},{refreshInterval:0,revalidateOnFocus:!1,revalidateOnReconnect:!1})}}e.s(["useBuildDiagnostics",()=>L,"useSonarLiveQuery",()=>P,"useSonarQuery",()=>j],5481907)},8443460,e=>{"use strict";let t="httpStatus ge 500 or httpStatus eq -1",r=`(${t}) and httpStatus ne -1 and httpStatus ne 504`;e.s(["HTTP_STATUS_DEFAULT_ERROR_FILTER",0,r,"HTTP_STATUS_ERROR_BUILDER_QUERY",0,"httpStatus ge 500 and httpStatus ne 504","HTTP_STATUS_ERROR_FILTER",0,t,"HTTP_STATUS_TIMEOUT_FILTER",0,"httpStatus eq -1 or httpStatus eq 504","SERVERLESS_DEFAULT_ERROR_FILTER",0,"(errorCode ne '' and errorCode ne 'timeout') or httpStatus ge 500 and httpStatus ne 504","SERVERLESS_ERROR_BUILDER_QUERY",0,"httpStatus ge 500","SERVERLESS_ERROR_FILTER",0,"errorCode ne '' or httpStatus ge 500","SERVERLESS_TIMEOUT_FILTER",0,"httpStatus eq 504 or errorCode eq 'timeout'","SUPPORTED_DETAIL_PAGES",0,["route","requestPath","botName","botCategory"]])},8953826,e=>{"use strict";function t(e,t,r){return{event:"incomingRequest",rollups:r??{requests:{measure:"count",aggregation:"sum"},cachedResponses:{measure:"count",aggregation:"sum",filter:"cacheResult eq 'HIT' or cacheResult eq 'STALE'"}},...t&&{filter:t},..."botName"===e&&{filter:"botName ne ''"},..."botCategory"===e&&{filter:"botCategory ne ''"},..."redirectLocation"===e&&{filter:"redirectLocation ne ''"},groupBy:"botName"===e?[e,"botVerified"]:[e],limit:100,tailRollup:"truncate",summaryOnly:!1,lowGranularity:!0}}function r(e,t){return{event:e,rollups:{value:{measure:"count",aggregation:"sum"}},groupBy:["httpStatus"],..."outgoingRequest"===e&&{filter:"fetchType eq 'origin'"},..."functionExecution"===e&&{filter:"cause ne 'middleware'"},limit:25,tailRollup:"truncate",summaryOnly:!1,contextFilter:t}}function a(e,t,r){return{event:e,rollups:{value:{measure:"count",aggregation:"sum"}},groupBy:[t],..."outgoingRequest"===e&&{filter:"fetchType eq 'origin'"},limit:25,tailRollup:"truncate",summaryOnly:!1,contextFilter:r}}function i(){return{event:"firewallAction",rollups:{requests:{measure:"count",aggregation:"sum"}},filter:"wafAction ne 'allow'",groupBy:["wafAction"],limitRanking:"top_by_summary",orderBy:"requests",limit:30,tailRollup:"others",summaryOnly:!1}}function n(e,t){return{event:"middlewareInvocation",rollups:{requests:{measure:"count",aggregation:"sum"}},groupBy:[e],filter:t,limit:100,tailRollup:"truncate",summaryOnly:!1,lowGranularity:!0}}e.s(["getFirewallActions",()=>i,"getIncomingRequestsByQuery",()=>t,"getMiddlewareInvocationsByAction",()=>n,"getQueryByByStatusCode",()=>r,"getQueryEventGroupBy",()=>a])},8508886,e=>{"use strict";var t=e.i(1146226),r=e.i(5182595),a=e.i(3351543),i=e.i(6062041),n=e.i(5481907),o=e.i(9179929),s=e.i(7797615),l=e.i(8953826);function u(e){let{title:u,emptyState:c,event:m,contextFilter:d,hideXAxis:g=!1}=e,{data:p,isLoading:h,isRelativeTime:f,builderQuery:v}=(0,n.useSonarQuery)((0,l.getQueryByByStatusCode)(m,d),{demoConfig:{rollups:{value:{defaultConfig:{base:1e3,variation:1},groupConfigs:{httpStatus:{200:{base:3e3,variation:300,diurnalPattern:!0},400:{base:200,variation:30,diurnalPattern:!0},500:{base:40,variation:10}}}}}}}),y=(0,o.useTimeseriesData)(p,{filter:e=>void 0!==e.httpStatus&&"0"!==e.httpStatus,category:e=>-1===Number(e.httpStatus)?"Timeout":`${e.httpStatus.charAt(0)}XX`}),S=(0,o.useSum)(p);return(0,t.jsx)(r.LineChart,{builderQuery:v?.value,data:y??[],sonarQueryResults:p,emptyState:c,getColor:i.getStatusColors,headerHeight:null===u?40:60,hideXAxis:g,isLoading:h,isRelativeTime:f,lineType:"step",title:null===u?null:(0,t.jsx)(a.LargeLegendValue,{isLoading:h,title:u,valueString:(0,s.formatNumberCompact)(S??0)})})}e.s(["StatusCode",()=>u])},1583188,e=>{"use strict";var t=e.i(1146226),r=e.i(5255926),a=e.i(6982071),i=e.i(5297450);function n(e){let{label:n,value:o,suffix:s,subLabel:l,maxValue:u,icon:c,isLoading:m=!1}=e,d=(0,i.useShouldShowDemoData)();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-1 text-xs",children:[(0,t.jsx)("span",{className:"truncate text-gray-900",children:n}),c,l?(0,t.jsx)("span",{className:"text-gray-700",children:l}):null]}),(0,t.jsxs)("div",{className:"flex items-baseline tabular-nums",children:[(0,t.jsx)("span",{className:"truncate text-sm font-medium text-gray-1000",title:"string"==typeof o||"number"==typeof o?o.toString():void 0,children:m?(0,t.jsx)(r.Skeleton,{className:"mt-1",height:16,width:30}):d?(0,t.jsx)(a.LockClosedSmall,{color:"gray-700",className:"size-4 -ml-0.5 mt-0.5"}):(0,t.jsxs)(t.Fragment,{children:[o,s?(0,t.jsx)("span",{className:"ml-1 font-normal text-gray-700",children:s}):null]})}),u?(0,t.jsxs)("span",{className:"mt-1 truncate text-sm text-gray-500",children:["/ ",u]}):null]})]})}e.s(["PreviewTileContent",()=>n])},6597523,e=>{"use strict";var t=e.i(1146226),r=e.i(5169864),a=e.i(5182595),i=e.i(5481907),n=e.i(6062041),o=e.i(8443460);function s(e){let{contextFilter:s,type:l="serverless",title:u,hideXAxis:c=!1}=e,{data:m,isLoading:d,isRelativeTime:g,builderQuery:p}=(0,i.useSonarQuery)({event:"serverless"===l?"serverlessFunctionInvocation":"edgeFunctionInvocation",rollups:{total:{measure:"count",aggregation:"sum"},errors:{measure:"count",aggregation:"sum",filter:"serverless"===l?o.SERVERLESS_DEFAULT_ERROR_FILTER:o.HTTP_STATUS_DEFAULT_ERROR_FILTER},timeouts:{measure:"count",aggregation:"sum",filter:"serverless"===l?o.SERVERLESS_TIMEOUT_FILTER:o.HTTP_STATUS_TIMEOUT_FILTER}},limit:500,tailRollup:"truncate",summaryOnly:!1,contextFilter:s},{demoConfig:{rollups:{total:{base:1e3,variation:1},errors:{base:10,variation:5},timeouts:{base:0,variation:0}}},builderQueryFilter:"serverless"===l?o.SERVERLESS_ERROR_BUILDER_QUERY:o.HTTP_STATUS_ERROR_BUILDER_QUERY}),h=(0,r.useMemo)(()=>m?.data?m.data.map(e=>{let{timestamp:t,errors:r,timeouts:a,total:i}=e;return{name:t.toISOString(),Error:0===i?null:(0,n.calculatePercentage)(r,i),Timeout:0===i?null:(0,n.calculatePercentage)(a,i)}}):[],[m?.data]),f=Math.max(...h.flatMap(e=>[e.Error||0,e.Timeout||0]));return(0,t.jsx)(a.LineChart,{builderQuery:p?.total,data:h,sonarQueryResults:m,formatValue:n.formatPercentageChart,getColor:e=>"Error"===e?"var(--geist-error)":"Timeout"===e?"var(--geist-warning)":"var(--geist-success)",hideXAxis:c,isLoading:d,isRelativeTime:g,placeholderKeys:["Error","Timeout"],rollupConfig:{method:"avg",interpretation:"increaseNegative",showTrend:!0},showRollup:!0,title:null===u?null:u||"Error Rate",yAxisDomain:[0,Math.max(5,f)]})}e.s(["ErrorRate",()=>s])}]);

//# debugId=854ddf87-ee10-ad06-5c2c-6ffd430d6c6b
//# sourceMappingURL=76638b925ac3e73f.js.map