;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="956200b8-af30-1757-162c-e7f3a6f88399")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,4443312,e=>{"use strict";var t=e.i(4603164),i=e.i(5338940);function r(e){let{deploymentId:r,swrOptions:l,enableCiChecksAndPolicies:o}=e,{team:n}=(0,i.useTeam)();return(0,t.useTypedSWR)("/v2/deployments/{deploymentId}/check-runs",o&&r&&n?.id?{deploymentId:r,teamId:n.id}:null,{refreshInterval:3e3,...l})}e.s(["CHECK_RUNS_REFRESH_INTERVAL",0,3e3,"useProjectCheckRuns",()=>r])},8529990,e=>{"use strict";let t=encodeURIComponent;function i(e){return"string"==typeof e?e:void 0}function r(e){if(!e)return null;let{meta:r}=e;if(r?.githubDeployment){let e=`https://github.com/${t(r.githubCommitOrg??"")}/${t(r.githubCommitRepo??"")}/commit/${r.githubCommitSha}`,l=`https://github.com/${t(r.githubCommitOrg??"")}/${t(r.githubCommitRepo??"")}/tree/${t(r.githubCommitRef??"")}`,o=r.githubPrId?`https://github.com/${t(r.githubOrg??"")}/${t(r.githubRepo??"")}/pull/${r.githubPrId}`:void 0;return{type:"github",commitRef:String(r.githubCommitRef),commitSha:String(r.githubCommitSha),commitAuthorName:String(r.githubCommitAuthorName),commitAuthorLogin:i(r.githubCommitAuthorLogin),commitMessage:String(r.githubCommitMessage),repoName:String(r.githubCommitRepo),repoNamespace:String(r.githubCommitOrg),orgNamespace:String(r.githubOrg),commitUrl:e,refUrl:l,viaFork:r.githubOrg!==r.githubCommitOrg,prId:r.githubPrId?Number(r.githubPrId):void 0,prUrl:o,gitDirty:String(r.gitDirty),isPublic:"public"===r.githubRepoVisibility}}if(r?.gitlabDeployment){let e=`https://gitlab.com/${r.gitlabProjectPath}/tree/${t(r.gitlabCommitRef??"")}`,l=`https://gitlab.com/${r.gitlabProjectPath}/commit/${r.gitlabCommitSha}`;return{type:"gitlab",commitRef:String(r.gitlabCommitRef),commitSha:String(r.gitlabCommitSha),commitAuthorName:String(r.gitlabCommitAuthorName),commitAuthorLogin:i(r.gitlabCommitAuthorLogin),commitMessage:String(r.gitlabCommitMessage||r.gitCommitMessage),repoName:String(r.gitlabProjectName),repoNamespace:String(r.gitlabProjectNamespace),orgNamespace:String(r.gitlabProjectNamespace),commitUrl:l,refUrl:e,isPublic:"public"===r.gitlabProjectVisibility}}if(r?.bitbucketDeployment){let e=`https://bitbucket.org/${r.bitbucketRepoOwner}/${r.bitbucketRepoSlug}/branch/${t(r.bitbucketCommitRef??"")}`,l=`https://bitbucket.org/${r.bitbucketRepoOwner}/${r.bitbucketRepoSlug}/commits/${r.bitbucketCommitSha}`;return{type:"bitbucket",commitRef:String(r.bitbucketCommitRef),commitSha:String(r.bitbucketCommitSha),commitAuthorName:i(r.bitbucketCommitAuthorName),commitAuthorLogin:i(r.bitbucketCommitAuthorLogin),commitMessage:String(r.bitbucketCommitMessage),repoName:String(r.bitbucketRepoSlug),repoNamespace:String(r.bitbucketRepoOwner),orgNamespace:String(r.bitbucketRepoOwner),commitUrl:l,refUrl:e,isPublic:"public"===r.bitbucketRepoVisibility}}return null}e.s(["getGitInfoFromDeployment",()=>r])},3907048,e=>{"use strict";var t=e.i(1146226),i=e.i(4585051),r=e.i(5169864),l=e.i(2982888),o=e.i(8651268);let n=(0,r.memo)(e=>{let{deployment:r,size:n=24,showProviderIcon:a=!1}=e;return r.meta?.deployHookId?(0,t.jsx)(l.DeployHookAvatar,{height:n,width:n}):r.creator?.uid?(0,t.jsx)(o.PrincipalAvatar,{size:n,principalId:r.creator.uid,principal:{type:"user",uid:r.creator.uid,username:r.creator.username},deploymentMeta:r.meta?.originalDeploymentId?void 0:r.meta,showProviderIcon:{github:!1,gitlab:a,bitbucket:a}}):(0,t.jsx)(i.Avatar,{size:n})});n.displayName="CreatorAvatar",e.s(["CreatorAvatar",0,n])},8227242,e=>{"use strict";var t=e.i(1146226);e.i(9623499);var i=e.i(5576066);function r(e){let r,{text:l}=e;return(0,t.jsx)("span",{children:(r=/(?<temp1>https?:\/\/[^\s]+)/g,l.split(r).map(e=>r.test(e)?(0,t.jsx)(i.Link,{className:"break-all font-normal",href:e,rel:"noopener noreferrer",target:"_blank",type:"blend",children:e},e):(0,t.jsx)("span",{children:e},e)))})}e.s(["LinkParser",()=>r])},930810,9745887,e=>{"use strict";var t=e.i(1146226),i=e.i(2504781),r=e.i(9334091),l=e.i(3306538),o=e.i(57106),n=e.i(3753138),a=e.i(6226725),s=e.i(4345845),c=e.i(8893913),d=e.i(7218483),m=e.i(9722978),u=e.i(9375869),p=e.i(8529990),g=e.i(3907048);function h(e){let{isForm:i,children:r,className:l}=e;return i?(0,t.jsx)("label",{className:l,children:r}):(0,t.jsx)("div",{className:l,children:r})}function x(e){let{deployment:i,isForm:r,isPromote:x,isPreviousDeployment:y,isProductionDeployment:b,isRolledBackDeployment:f,selectedDeployment:j,setSelectedDeployment:k,ariaLabel:v="Rollback Deployment"}=e,N=(0,d.useAgo)(i.createdAt||0),C="number"==typeof i.aliasAssigned?i.aliasAssigned:0,P=C>0,R=(0,d.useAgo)(C),S=(0,u.useDeploymentLink)(i),D=(0,p.getGitInfoFromDeployment)(i),A=b||y||f;y&&f&&(y=!1);let w="Preview";if("target"in i)switch(i.target){case"staging":w="Staging";break;case"production":w="Production";break;default:w="Preview"}else w="Production";let I="uid"in i?i.uid:i.id,M=null;x?D?.commitRef&&(M=(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-0.5 flex-initial",children:[(0,t.jsx)(s.GitBranch,{color:"gray-900"}),(0,t.jsx)("span",{className:"text-copy-14-mono text-gray-900 truncate whitespace-nowrap",style:{marginRight:"4px",maxWidth:120,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0},title:D.commitRef,children:D.commitRef}),(0,t.jsxs)("span",{className:"text-copy-14 text-gray-900 truncate whitespace-nowrap flex items-center gap-1",style:{flexBasis:"50%",flexShrink:0,flexGrow:1,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0,maxWidth:260},children:["Staged"," ",N," by"," ",(0,t.jsx)("span",{children:(0,t.jsx)(g.CreatorAvatar,{deployment:i,showProviderIcon:!0,size:24})}),(0,t.jsx)("span",{children:!i.meta?.originalDeploymentId&&i.creator?.username?i.creator.username:D.commitAuthorLogin})]})]})):M=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"inline-flex flex-row items-center",children:[(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",style:{marginRight:"4px"},children:w}),D?.commitRef?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.GitBranch,{color:"gray-900",size:14}),(0,t.jsx)("span",{className:"text-copy-14-mono max-w-[100px] truncate whitespace-nowrap px-1 text-center text-sm leading-5 text-gray-900",title:D.commitRef,children:D.commitRef}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"by"}),(0,t.jsxs)("div",{className:"ml-1 inline-flex flex-row items-center gap-1",children:[(0,t.jsx)(g.CreatorAvatar,{deployment:i,size:20}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900 truncate max-w-[140px]",children:!i.meta?.originalDeploymentId&&i.creator?.username?`${i.creator.username}`:D.commitAuthorLogin})]})]}):null]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"Deployed "}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:N}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:", "}),P?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"promoted "}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:R})]}):(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"never promoted"})]})]});let T=null;return r||(T=x?(0,t.jsx)(n.ArrowCircleUp,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):b?(0,t.jsx)(a.CrossCircle,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):(0,t.jsx)(c.RotateCounterClockwise,{className:"mr-4 hidden self-center sm:block",color:"gray-1000",style:{flexShrink:0}})),(0,t.jsxs)(h,{className:(0,m.clsx)("flex w-full items-end justify-start px-4 py-3","rounded border border-solid border-[var(--accents-2)]","rounded-b-none","last:rounded-b","[&+&]:rounded-t-none [&+&]:border-t-0",{"bg-[var(--accents-1)] shadow-none":b,"bg-[var(--geist-background)]":!b}),isForm:r,children:[r?(0,t.jsx)("input",{"aria-label":v,checked:j?.uid===I,className:`
            relative m-0 mr-4 size-4 shrink-0 appearance-none
            self-center rounded-[1000px] border
            border-solid border-[var(--geist-foreground)] after:absolute after:inset-[3px]
            after:rounded-[1000px] after:bg-[var(--geist-foreground)]
            after:content-none checked:after:content-['']
          `,name:"rollbackDeployment",onChange:()=>{"uid"in i&&"type"in i&&k&&k(i)},type:"radio",value:I}):T,(0,t.jsxs)("div",{style:{width:A?"initial":"100%",minWidth:0},children:[(0,t.jsx)(o.Link,{className:"flex w-[calc(100%-1ch)] items-center gap-0.5 break-all text-sm font-bold leading-5",href:S,target:"_blank",children:(0,t.jsx)("span",{className:"text-[14px] leading-[20px] font-medium line-clamp-1",title:i.url,children:i.url})}),D?.commitMessage?(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900 line-clamp-1 break-words",title:D.commitMessage,children:[D.commitSha.substring(0,7)," ",D.commitMessage]}):null,M]}),b?(0,t.jsx)(l.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"inverted",children:"Current"}):null,y?(0,t.jsx)(l.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"gray-subtle",children:"Previous"}):null,f?(0,t.jsx)(l.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"red-subtle",children:"Rolled back"}):null]})}e.s(["DeploymentCardSmall",()=>x],9745887);var y=e.i(8227242),b=e.i(8651268);function f(e){return"id"in e?e.id:"uid"in e?e.uid:void 0}function j(e){return void 0!==e.deleted}function k(e){let{rollbackDescription:i,project:r,preview:l}=e,o=(0,d.useAgo)(i.createdAt);return(0,t.jsxs)("div",{className:"px-4 py-3 rounded bg-background-200 shadow-border",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900 break-words",children:i.description.length>0?(0,t.jsxs)(t.Fragment,{children:["“",(0,t.jsx)(y.LinkParser,{text:i.description}),"”"]}):(0,t.jsx)("span",{className:"text-copy-14",children:"No reason provided."})}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[l?null:(0,t.jsx)("p",{className:"text-copy-14",children:"Rolled back by"}),i.username?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.PrincipalAvatar,{size:20,principalId:i.userId,principal:{type:"user",uid:i.userId,username:i.username}}),(0,t.jsx)("p",{className:"text-copy-14",children:i.username}),r?.lastAliasRequest!==void 0&&!l&&(0,t.jsx)("p",{className:"text-copy-14",children:o})]}):null]})]})}function v(e){let{deployments:r,previousDeployment:l,rolledBackDeploymentId:o,productionDeployment:n,selectedDeployment:a,setSelectedDeployment:s,swr:c,ariaLabel:d}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:r.map(e=>n.id!==e.uid&&(0,t.jsx)(x,{deployment:e,isForm:!0,isPreviousDeployment:l?.uid===e.uid,isRolledBackDeployment:o===e.uid,selectedDeployment:a,setSelectedDeployment:s,ariaLabel:d},e.uid))}),!c.isReachingEnd&&(0,t.jsx)(i.Button,{loading:c.isLoadingMore,onClick:()=>{c.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})]})}function N(e){if(0===e.length)return;let t=e.reduce((e,t)=>e.aliasAssigned&&t.aliasAssigned?e.aliasAssigned>t.aliasAssigned?e:t:t.aliasAssigned?t:e);if(t.aliasAssigned)return t}function C(e){let{value:i,onChange:l,id:o}=e;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(r.Textarea,{autoFocus:!0,className:"text-base min-h-24",error:i.length>=250?"Reason cannot be longer than 250 characters.":void 0,id:o,onChange:e=>l(e.target.value),placeholder:"Production is not behaving as expected…",required:!0,value:i,style:{fontSize:14}})})}e.s(["ChooseDeploymentList",()=>v,"REASON_MAX_CHARACTER_LENGTH",0,250,"RollbackDescriptionCard",()=>k,"RollbackDescriptionTextarea",()=>C,"getDeploymentId",()=>f,"getMostRecentlyPromotedDeployment",()=>N,"isDeleted",()=>j],930810)},6619197,5645345,e=>{"use strict";var t=e.i(1146226),i=e.i(5169864),r=e.i(8248823),l=e.i(5610834),o=e.i(57106),n=e.i(3869281),a=e.i(4030453),s=e.i(2455417),c=e.i(6891161),d=e.i(8522580),m=e.i(5255926),u=e.i(9318197),p=e.i(455575),g=e.i(8761240),h=e.i(472117),x=e.i(4004502),y=e.i(8042625),b=e.i(277234),f=e.i(4244280),j=e.i(4443312),k=e.i(5140444),v=e.i(5338940),N=e.i(5924191),C=e.i(4450569),P=e.i(4396019),R=e.i(9375869),S=e.i(8518548);function D(e){if(!e)return;if("id"in e==!1)return e;let{aliasAssigned:t,aliasError:i=null,aliasAssignedAt:r,buildingAt:l,created:o=e.createdAt,createdAt:n,creator:a,name:s,ready:c,readyState:d,readySubstate:m,target:u=null,uid:p=e.id,url:g,isRollbackCandidate:h="production"===e.target,prebuilt:x}=e;return{aliasAssigned:t,aliasError:i,aliasAssignedAt:r,buildingAt:l,created:o,createdAt:n,creator:{email:"",githubLogin:"",...a},name:s,ready:c,readyState:d,readySubstate:m,target:u,prebuilt:x,type:"LAMBDAS",uid:p,url:g,isRollbackCandidate:h}}e.s(["asListDeployment",()=>D],5645345);var A=e.i(1840726),w=e.i(930810),I=e.i(7952834),M=e.i(1173672),T=e.i(9745887),O=e.i(3008300),L=e.i(3981247),B=e.i(6060673);function $(e){let t=e?.name,{deployment:r,isLoading:l}=(0,P.useProjectProductionDeployment)(t);return(0,i.useMemo)(()=>{let t=D(e);return t?l?"Loading…":t.uid===r?.id?"This Deployment is already in Production.":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be promoted.":"prebuilt"in t&&!0===t.prebuilt&&"production"!==t.target?"Prebuilt deployments from non-production environments cannot be promoted.":"":""},[e,l,r?.id])}function F(e){let{title:i}=e;return(0,t.jsx)(c.Modal.Header,{children:(0,t.jsx)(c.Modal.Title,{center:!0,children:i})})}function E(e){let{deploymentId:i}=e,r=(0,h.useChecksPrivateBetaFlag)(),l=(0,h.useCiChecksAndPoliciesFlagV2)(),n=r||l,{data:a,isLoading:s}=(0,j.useProjectCheckRuns)({deploymentId:i,enableCiChecksAndPolicies:n});if(!n)return null;if(s)return(0,t.jsx)(m.Skeleton,{});if(a?.runs.every(e=>"succeeded"===e.conclusion))return null;let c=a?.runs.filter(e=>"succeeded"!==e.conclusion)||[];return(0,t.jsxs)(d.Note,{type:"error",fill:!0,className:"mt-6",children:["By clicking Promote, you acknowledge that you are bypassing promotion requirements:",c.length>0&&(0,t.jsx)("ul",{className:"flex flex-col gap-1 ml-4 list-disc",children:c.slice(0,5).map(e=>(0,t.jsx)("li",{children:e.externalUrl?(0,t.jsx)(o.Link,{href:e.externalUrl,external:!0,children:e.name}):(0,t.jsx)("span",{children:e.name})},e.id||e.name||`${e.conclusion}-${e.status}`))})]})}function U(e,r){let{onDeploymentPromoted:l}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},[m,p]=(0,i.useState)(!1),[h,y]=(0,i.useState)(null),{team:b}=(0,v.useTeam)(),f=e??h?.name,{data:j}=(0,B.useProject)(f),N=r??j,R=(0,A.useShowIgnoreBuildStep)({project:N,deployment:h}),[D,I]=(0,i.useState)(O.DEFAULT_USE_IGNORE_BUILD_STEP_PROMOTE),M=(0,i.useCallback)(()=>{p(!1)},[]),{error:$,loading:U,promote:z,setError:W,setLoading:H}=_({deployment:h,useIgnoreBuildStep:D,project:N,onCurrentDeploymentPromoted:(0,i.useCallback)(()=>{M(),l?.()},[M,l])}),{user:q}=(0,k.useUser)(),{data:G}=(0,L.useRollingRelease)({teamIdOrSlug:b?.slug,projectSlug:f}),V=N?.rollingRelease?.stages!==void 0&&N.rollingRelease.stages.length>0,K=G?.rollingRelease?.state==="ACTIVE",Y=G?.rollingRelease?.canaryDeployment?.id,X=K&&Y===h?.uid,J=V&&!K&&h?.target==="production",Q=V&&K&&h?.target==="production",Z=J&&N.rollingRelease?.stages!==void 0?N.rollingRelease.stages[0]?.targetPercentage:null,{data:ee}=(0,S.useProjectDomains)(f,{limit:11,production:"true",redirects:"false",verified:"true",order:"ASC"}),et=(0,i.useCallback)(e=>{y(e),p(!0)},[]),ei=(0,i.useCallback)(()=>{H(!1),y(null),W(void 0)},[W,H]),{rollbackDescription:er,deploymentIsStale:el}=(0,P.useProjectProductionDeployment)(N?.name),{andMoreDomains:eo,remainingDomains:en}=(0,i.useMemo)(()=>{if(!ee)return{andMoreDomains:!1,remainingDomains:[]};let e=ee.length>2,t=e?ee.slice(2).map(e=>e.name):[];return{andMoreDomains:e,remainingDomains:t}},[ee]),ea=(0,i.useMemo)(()=>{if(!N||!h)return(0,t.jsx)(C.default,{center:!0,style:{marginTop:10},children:(0,t.jsx)(s.LoadingDots,{size:4})});let e=!!(ee&&ee.length>0);return(0,t.jsxs)(t.Fragment,{children:["production"===h.target?(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"16px"},children:"Deployment to promote:"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"16px"},children:"A new deployment will be built using your production environment."}),(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"16px"},children:"Deployment to promote to production:"})]}),(0,t.jsx)("div",{children:(0,t.jsx)(T.DeploymentCardSmall,{deployment:h,isPromote:!0,selectedDeployment:null})}),J?(0,t.jsxs)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:["This will start a new rolling release with initial traffic of"," ",Z,"%."]}):null,Q?(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:"This will queue the deployment for promotion after the current rolling release completes."}):null,J||Q||!e?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:"It will be aliased to the following domains:"}),(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial pl-12",children:ee?.slice(0,2).map(e=>{let{name:i}=e;return(0,t.jsx)("p",{className:"text-copy-14",children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-3 flex-initial",children:[(0,t.jsx)(g.CheckCircleFill,{color:"blue-700",size:20}),(0,t.jsx)("span",{children:i.startsWith("*")?i:(0,t.jsx)(o.Link,{"data-testid":(0,x.tid)("deployments","promote-to-production-overlay","preview-link"),external:!0,href:`https://${i}`,variant:"highlight",children:i})})]})},i)})}),eo?(0,t.jsxs)("p",{className:"text-copy-14 mt-6 mb-4",children:["...and ",en.length," more"]}):null]}),!J&&!e&&(0,t.jsxs)("p",{className:"text-copy-14",style:{marginBottom:"24px",marginTop:"24px"},children:["Warning: Your Project does not have a Production Domain. We recommend you"," ",(0,t.jsx)(o.Link,{href:`/${b?b.slug:q?.username}/${encodeURIComponent(N.name)}/settings/domains`,variant:"highlight",children:"add"})," ","one."]}),N.link&&h.gitSource?(0,t.jsx)(E,{deploymentId:h.id}):null,R?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Spacer,{y:1}),(0,t.jsx)(n.Checkbox,{checked:D,fullWidth:!0,onChange:()=>{I(!D)},children:"Use project's Ignore Build Step"})]}):null,X?(0,t.jsx)(d.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",style:{padding:1},children:(0,t.jsx)("div",{className:"flex flex-col items-start justify-start flex-initial",children:(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"This will complete the rolling release for this deployment."})})})}):null,el?(0,t.jsx)(d.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",style:{padding:1},children:(0,t.jsx)("div",{className:"flex flex-col items-start justify-start flex-initial",children:(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:J?"Completing the Rolling Release will undo the current Instant Rollback":"This action will undo the current Instant Rollback"})})})}):null,er?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:"Rollback Details:"}),(0,t.jsx)(w.RollbackDescriptionCard,{rollbackDescription:er,project:N})]}):null]})},[eo,en,ee,N,b,q,h,D,R,el,er,Z,J,Q,X]),es=(0,i.useMemo)(()=>(0,t.jsx)(c.Modal.Action,{"data-testid":(0,x.tid)("deployments","promote-to-production-overlay","confirm-button"),loading:U,onClick:z,children:h&&"target"in h&&"production"===h.target?"Promote":"Promote to Production"}),[z,U,h]);return{modal:(0,i.useMemo)(()=>(0,t.jsxs)(c.Modal.Modal,{active:m,"data-testid":(0,x.tid)("deployments","promote-to-production-overlay"),onAnimationDone:ei,onClickOutside:M,sticky:!0,width:"500px",children:[(0,t.jsxs)(c.Modal.Body,{children:[(0,t.jsx)(F,{title:Q?"Queue for Promotion":h&&"target"in h&&"production"!==h.target?"Promote to Production":"Promote"}),ea,$?(0,t.jsx)(a.Error,{error:$}):null]}),(0,t.jsxs)(c.Modal.Actions,{children:[(0,t.jsx)(c.Modal.Action,{"data-testid":(0,x.tid)("deployments","promote-to-production-overlay","cancel-button"),loading:!1,onClick:M,type:"secondary",children:"Cancel"}),es]})]}),[m,ei,M,ea,$,es,Q,h]),close:M,open:et}}let _=e=>{let{deployment:t,project:o,useIgnoreBuildStep:n,onCurrentDeploymentPromoted:a}=e,s=(0,p.useToasts)(),c=(0,l.useRouter)(),{team:d}=(0,v.useTeam)(),{user:m}=(0,k.useUser)(),{mutate:u}=(0,N.useSWRConfig)(),[g,h]=(0,i.useState)(!1),[x,j]=(0,i.useState)(void 0),C=(0,A.useShowIgnoreBuildStep)({project:o,deployment:t});return{promote:(0,i.useCallback)(async()=>{if(t&&o){h(!0),j(void 0);try{let e,i=d?.id,r="Promoted Deployment successfully.";if("production"===t.target)await (0,b.fetchAPI)(`${(0,f.API_DEPLOYMENT_PROMOTE)(o.id,t.uid||t.id)}${(0,y.encode)({teamId:i})}`,{method:"POST",body:{},throwOnHTTPError:!0}),e=(0,R.pathFromDeployment)(t,{user:m,team:d});else{let l=await (0,b.fetchAPI)(`${(0,f.API_DEPLOYMENTS)("v13")}${(0,y.encode)({teamId:i,skipIgnoreBuildStep:C&&!n?"1":null})}`,{method:"POST",body:JSON.stringify({deploymentId:t.uid||t.id,meta:{action:"promote"},name:o.name,target:"production"}),throwOnHTTPError:!0});e=(0,R.pathFromDeployment)(l,{user:m,team:d});let a=t.uid||t.id;r="production"===t.target?a===l.id?"Deployment is already the current Production Deployment.":"Promoted Deployment to Production successfully.":"Created Production Deployment successfully."}d&&((0,I.revalidateProject)(u,o),await u((0,M.getProjectProductionDeploymentKey)({projectIdOrName:o.id,teamId:d.slug}))),s.success({text:r,key:"production-deployment"}),e&&(e===location.pathname?a?.():c.push(e))}catch(e){j((0,r.normalizeError)(e))}finally{h(!1)}}},[t,o,c,C,d,s,n,m,u,a]),loading:g,setLoading:h,error:x,setError:j}};e.s(["default",()=>U,"usePromoteDeployment",0,_,"usePromoteTooltip",()=>$],6619197)},1553329,e=>{"use strict";var t=e.i(1146226),i=e.i(5169864),r=e.i(6891161),l=e.i(5610834),o=e.i(1717203),n=e.i(7557283),a=e.i(930810),s=e.i(6060673),c=e.i(4396019),d=e.i(5771992),m=e.i(6619197);function u(e){let{open:u,setOpen:p}=e,g=(0,i.useRef)(!1),h=(0,l.useParams)(),{data:x}=(0,s.useProject)(h?.project),{can:y}=(0,o.default)({projectIdOrName:h?.project}),b=y(n.Action.Delete,n.Resource.DeploymentRollback),{deployment:f,rollbackDescription:j}=(0,c.useProjectProductionDeployment)(h?.project),[,k]=(0,d.useDeploymentsInfinite)({projectId:x?x.id:"",requireProject:!0,limit:10,rollbackCandidate:!0},{}),{deployments:v}=k,[N,C]=(0,i.useState)(null);null===N&&v.length>0&&C(v[0]);let{loading:P,promote:R}=(0,m.usePromoteDeployment)({deployment:N,project:x,useIgnoreBuildStep:!1});return((0,i.useEffect)(()=>{u&&!g.current?(k.loadMore(),g.current=!0):u||(g.current=!1)},[u,k]),void 0===f)?null:(0,t.jsxs)(r.Modal.Modal,{active:u,onClickOutside:()=>p(!1),sticky:!0,children:[(0,t.jsxs)(r.Modal.Body,{children:[(0,t.jsx)(r.Modal.Header,{children:(0,t.jsx)(r.Modal.Title,{center:!0,children:"Undo Rollback"})}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-6 flex-initial",children:[j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-16",children:"Rollback details:"}),(0,t.jsx)(a.RollbackDescriptionCard,{project:x,rollbackDescription:j})]}):null,(0,t.jsx)("p",{className:"text-copy-16",children:"Undo this rollback by promoting a different deployment:"}),(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:(0,t.jsx)(a.ChooseDeploymentList,{deployments:v,productionDeployment:f,rolledBackDeploymentId:x?.lastAliasRequest?.type==="rollback"?x.lastAliasRequest.fromDeploymentId:void 0,selectedDeployment:N,setSelectedDeployment:C,swr:k,ariaLabel:"Promote Deployment"})})]})]}),(0,t.jsxs)(r.Modal.Actions,{children:[(0,t.jsx)(r.Modal.Action,{onClick:()=>p(!1),type:"secondary",children:"Cancel"}),(0,t.jsx)(r.Modal.Action,{disabled:!b,loading:P,onClick:()=>{R()},children:"Confirm"})]})]})}e.s(["UndoRollbackModal",()=>u])}]);

//# debugId=956200b8-af30-1757-162c-e7f3a6f88399
//# sourceMappingURL=761324d9a9cb99c1.js.map