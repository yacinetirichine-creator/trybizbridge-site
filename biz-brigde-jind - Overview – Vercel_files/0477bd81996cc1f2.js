;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="15a5f825-479c-b224-0c29-9fcd4c7e7b8a")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,1482429,2128692,2863467,1135066,e=>{"use strict";var t=e.i(1146226),r=e.i(9192216),i=e.i(5086286),n=e.i(4998750),s=e.i(4244280),l=e.i(9668517),a=e.i(5338940),o=e.i(9979783),u=e.i(119294),c=e.i(6352514),d=e.i(5169864),m=e.i(5924191),f=e.i(4689995),p=e.i(8673480),g=e.i(2749380);function b(e){let{mutate:t}=(0,m.useSWRConfig)(),r=(0,l.useTeamSlug)()??"",{team:i}=(0,a.useTeam)(),b=i?.id,x=i?.billing?.plan??"hobby",h=(0,p.buildSWRKey)(s.API_NOTEBOOK,{id:e?.id,teamSlug:r}),y=(0,p.buildSWRKey)(s.API_NOTEBOOKS,{teamSlug:r}),{trigger:v,isMutating:w}=(0,f.default)(h,async(t,i)=>{let{arg:l}=i,a=l.id??e?.id;if(!a)throw Error("Notebook ID is required to save a notebook");return(0,n.parseNotebook)(await (0,o.typedFetchData)(s.API_NOTEBOOK,"put",{id:a,slug:r},{title:l.title,variables:(0,n.serializeVariables)(l.variables)},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:j,isMutating:N}=(0,f.default)(h,async(t,i)=>{let{arg:n}=i,l=n?.id??e?.id;if(!l)throw Error("Notebook ID is required to delete a notebook");return(0,o.typedFetchData)(s.API_NOTEBOOK,"delete",{id:l,slug:r},{throwOnHTTPError:!0})},{revalidate:!1}),{trigger:E,isMutating:k}=(0,f.default)(h,async(t,i)=>{let{arg:l}=i,a=l?.id??e?.id;if(!a)throw Error("Notebook ID is required to share a notebook");return(0,n.parseNotebook)(await (0,o.typedFetchData)(s.API_NOTEBOOK_SHARE,"put",{id:a,slug:r},{},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:C,isMutating:R}=(0,f.default)(h,async(t,i)=>{let{arg:l}=i,a=l.notebookId??e?.id;if(!a)throw Error("Notebook ID is required to save a notebook widget");let{id:u,query:c,...d}=l.widget;return(0,n.parseNotebook)(await (0,o.typedFetchData)(s.API_NOTEBOOK_WIDGET,"put",{id:a,slug:r,widgetId:u},{query:(0,g.serializeQuery)(c),...d},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:T,isMutating:O}=(0,f.default)(h,async(t,i)=>{let{arg:l}=i,a=l.notebookId??e?.id;if(!a)throw Error("Notebook ID is required to remove a notebook widget");return(0,n.parseNotebook)(await (0,o.typedFetchData)(s.API_NOTEBOOK_WIDGET,"delete",{id:a,slug:r,widgetId:l.id},{throwOnHTTPError:!0}))},{revalidate:!1}),M=(0,d.useCallback)(async e=>(await Promise.all([t((0,p.buildSWRKey)(s.API_NOTEBOOK,{id:e.id,teamSlug:r}),e),t((0,p.buildSWRKey)(s.API_NOTEBOOKS,{teamSlug:r}),(0,p.updateCachedList)(e))]),e),[r,t]);return{saveNotebook:async e=>{let t=await M(await v(e,{optimisticData:(0,p.updateCachedNotebook)(e),rollbackOnError:!0}));return u.analytics.track(c.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"title_edited",source:"notebook-details-page"}),t},deleteNotebook:async r=>{await j(r),u.analytics.track(c.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_DELETED,{teamId:b,plan:x,source:"notebook-details-page"});let i=r?.id??e?.id;return await t(y,(0,p.updateCachedList)({id:i},!1)),null},shareNotebook:async e=>{let t=M(await E(e));return u.analytics.track(c.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"notebook_shared",source:"notebook-details-page"}),t},saveWidget:async(e,t)=>{let r=await M(await C(e,{optimisticData:(0,p.updateCachedNotebook)({},e.widget),rollbackOnError:!0}));return u.analytics.track(c.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"new"===e.widget.id?"widget_added":"widget_edited",source:t??"notebook-details-page"}),r},removeWidget:async e=>{let t=await M(await T(e,{optimisticData:(0,p.updateCachedNotebook)({},null,e.id),rollbackOnError:!0}));return u.analytics.track(c.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"widget_removed",source:"notebook-details-page"}),t},isSaving:w||N||k||R||O}}e.s(["useNotebookOperations",()=>b],2128692);var x=e.i(7371622),h=e.i(5115727),y=e.i(854682),v=e.i(9220646),w=e.i(2504781),j=e.i(5468328),N=e.i(455575),E=e.i(5610834);let k="new-notebook";function C(e){let{query:s}=e,{hasObservabilityPlusAccess:l,ready:o}=(0,y.useHasObservabilityPlus)(),u=!o||!l,{notebooks:c}=(0,x.useNotebooks)(),{createNotebook:m,isSaving:f}=(0,i.useCreateNotebook)(),{saveWidget:p,isSaving:g}=b(),[C,S]=(0,d.useState)(!1),{team:I}=(0,a.useTeam)(),A=(0,N.useToasts)(),D=(0,E.useRouter)(),B=(0,h.useDefaultQueryTitle)(s),F=(0,d.useMemo)(()=>c.map(e=>({...e,group:I&&e.contributors.includes(I.id)?"Team":"Personal"})),[c,I]),P=(0,d.useCallback)(e=>{(async()=>{try{if(!I)throw Error("Team not found");S(!1);let t=e.id,r={id:"new",query:s,title:B};t===k?t=(await m({title:e.title,widget:r},"query-builder")).id:await p({notebookId:t,widget:r},"query-builder"),D.push(`/${I.slug}/~/observability/notebooks/${t}`)}catch(e){A.error({preserve:!0,text:(0,t.jsxs)(t.Fragment,{children:["Failed to add query to the notebook.",(0,t.jsx)("br",{}),(0,n.extractError)(e)]})})}})()},[m,p,B,s,A,D,I]),q=(0,t.jsx)(w.Button,{disabled:u,loading:g||f,onClick:()=>S(!0),size:"medium",type:"default",typeName:"button",children:"Add to Notebook"});return u?(0,t.jsx)(j.Tooltip,{text:"Unlock all advanced query features with Observability Plus",children:q}):(0,t.jsxs)(v.Root,{modal:!0,onOpenChange:S,open:C,children:[(0,t.jsx)(v.Anchor,{className:"flex",children:(0,t.jsx)(v.Trigger,{asChild:!0,children:q})}),(0,t.jsx)(v.Portal,{children:(0,t.jsx)(v.Content,{align:"end",onCloseAutoFocus:()=>S(!1),sideOffset:8,children:(0,t.jsx)(r.CommandMenu,{getId:T,getValue:O,label:"notebook",onChange:P,options:F,parseNewValue:R,renderItem:M,reverse:!0,allowEmptyAdd:!0,addLabel:"Create"})})})]})}function R(e){return{id:k,title:e||"Untitled Notebook",group:"Personal"}}function T(e){return e.id}let O=e=>{let{title:t,group:r}=e;return`${t}${r?` ${r}`:""}`};function M(e){return(0,t.jsx)("div",{className:"flex w-full items-center gap-2 px-2 py-1.5",children:(0,t.jsx)("span",{children:e.title})})}e.s(["AddToNotebookButton",()=>C],1482429);var S=e.i(5467025),I=e.i(1482596),A=e.i(8815885),D=e.i(3500331),B=e.i(5255926),F=e.i(8923565),P=e.i(1663964),q=e.i(244424),_=e.i(1918911),L=e.i(7749365),z=e.i(9096446),U=e.i(218692),Q=e.i(4047087),K=e.i(3675495),$=e.i(2006677),G=e.i(6143247),V=e.i(2713400),W=e.i(7073483),Y=e.i(8119470),H=e.i(1794286),J=e.i(7432042);function X(e){let{value:r,onChange:i,disabled:s,trackEvents:l,variables:a}=e,{start:o,end:u}=(0,g.fromTimeToRange)(r),c=(0,Y.subDays)(new Date,90),d=(0,g.getTimeRangePresets)(!0,a?.time?{[n.TIME_VARIABLE]:{start:new Date,end:new Date,text:`Notebook (${(0,g.printTime)(a.time)})`}}:void 0),m=Object.keys(d).findIndex(e=>e===r);return(0,t.jsx)(H.Calendar,{allowClear:!1,compact:!0,minValue:c,disabled:s,onChange:(e,t)=>{let r=new Date(e.start),n=new Date(e.end),s=t||(0,J.default)(n.getTime()-r.getTime());l&&(0,W.track)("Query Builder Changed Date Range Period",{period:s}),t?i(t):i({from:r,to:n})},popoverAlignment:"center",presetIndex:m,presets:d,size:"small",value:{start:o,end:u},width:"210px"},"date-range-select-query-builder")}e.s(["DateRangeSelect",()=>X],2863467);var Z=e.i(9689002),ee=e.i(7087273),et=e.i(2942788),er=e.i(3228096),ei=e.i(4333930),en=e.i(4796642),es=e.i(787358),el=e.i(8004707),ea=e.i(1898517),eo=e.i(1379708),eu=e.i(6401841),ec=e.i(4141852),ed=e.i(762945),em=e.i(7807066),ef=e.i(2712781),ep=e.i(2923544),eg=e.i(1813317);function eb(e){let[r,i]=function(){let[e,t]=(0,d.useState)({x:0,y:0});return(0,d.useEffect)(()=>{let e=e=>{t({x:e.clientX,y:e.clientY})};return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}},[]),[e.x,e.y]}(),[n,s]=(0,d.useState)({button:null,container:null,metrics:null,firstMetric:null});(0,d.useEffect)(()=>{let t=()=>{if(!e.containerRef.current||!e.metricsRef.current)return void s({button:null,container:null,metrics:null,firstMetric:null});let t=e.metricsRef.current.querySelectorAll("button");0===t.length?s({button:null,container:null,metrics:null,firstMetric:null}):s({button:e.buttonRef.current?.getBoundingClientRect()||null,container:e.containerRef.current.getBoundingClientRect(),metrics:e.metricsRef.current.getBoundingClientRect(),firstMetric:t[0].getBoundingClientRect()})};t();let r=new ResizeObserver(t);return e.buttonRef.current&&r.observe(e.buttonRef.current),e.containerRef.current&&r.observe(e.containerRef.current),e.metricsRef.current&&r.observe(e.metricsRef.current),()=>r.disconnect()},[e.buttonRef,e.containerRef,e.metricsRef]);let[l,a]=(0,d.useState)({x:r,y:i});(0,d.useEffect)(()=>{let e=setTimeout(()=>{a({x:r,y:i})},16);return()=>clearTimeout(e)},[r,i]);let o=(0,d.useMemo)(()=>{if(!n.container||!n.metrics||!n.firstMetric)return null;let e=Math.min(n.metrics.bottom,n.container.bottom),t=l.x-n.container.left,r=n.button?n.button.right-n.container.left:260,i=Math.min(1,Math.max(0,(t-.5*r)/(.5*r))),s=l.y-n.container.top,a=Math.max(260,r),o=Math.max(n.button?n.button.left-n.container.left:0,Math.min(t-(8+18*i),a-10)),u=a-o,c=s;if(n.button){let e=n.button.top-n.container.top,t=n.button.bottom-n.container.top;if(s>=e-10&&s<=t+10){let t=Math.max(0,Math.min(n.button.height,s-e));c=e+t}}let d=n.firstMetric.top-n.container.top,m=e-n.container.top,f=Math.max(50,c),p=Math.min(f,Math.max(50,d)),g=m-p;if(g<=0||u<=0||!Number.isFinite(p)||!Number.isFinite(c)||!Number.isFinite(o))return null;let b=Math.max(0,Math.min(100,(f-p)/g*100));return{position:"absolute",left:`${o}px`,top:`${p}px`,width:`${u}px`,height:`${g}px`,clipPath:`polygon(0 ${b}%, 100% 0, 100% 100%, 0 ${b}%)`,pointerEvents:"auto",zIndex:1,cursor:"pointer"}},[l.x,l.y,n]);return o?(0,t.jsx)("div",{className:"group-hover:block hidden",style:o,onMouseEnter:e.onMouseEnter,onWheel:t=>{e.eventsScrollerRef.current&&(e.eventsScrollerRef.current.scrollTop+=t.deltaY)},onClick:e=>{let t=document.elementsFromPoint(e.clientX,e.clientY).find(t=>t!==e.currentTarget&&("BUTTON"===t.tagName||t.closest("button")));if(t){let e="BUTTON"===t.tagName?t:t.closest("button");e&&e.click()}}}):null}let ex={incomingRequest:er.Globe,serverlessFunctionInvocation:ei.FunctionSquare,edgeFunctionInvocation:en.FunctionEdge,middlewareInvocation:es.FunctionMiddleware,edgeMiddlewareInvocation:es.FunctionMiddleware,outgoingRequest:el.ArrowGlobe,imageTransformation:ea.Image,imageTransformationFailure:ea.Image,isrOperation:eo.Isr,blockedConnection:eu.Stop,firewallAction:ec.FirewallFlame,botIdCheck:ed.Warning,aiGatewayRequest:ef.Sparkles};function eh(e){return ex[e]||et.Database}let ey=["count","durationMs","functionDurationMs","functionWallTimeMs","functionCpuTimeMs","functionDurationGbhr","ttfbMs","coldStartDurationMs","initDurationMs","fotInBytes","fotOutBytes","fotTotalBytes","isrReadBytes","isrWriteBytes","isrReadUnits","isrWriteUnits","vdcReadUnits","invokedMemoryMb","maxMemoryUsedMb","billedMemoryMb"];function ev(e){return(0,eg.getAggregableMeasures)(e).map(t=>({id:t,label:(0,ep.labelForMeasure)(e,t)})).toSorted((e,t)=>{let r=ey.indexOf(e.id),i=ey.indexOf(t.id);return -1!==r&&-1!==i?r-i:-1!==r?-1:-1!==i?1:e.label.localeCompare(t.label)})}function ew(e){let{disabled:r,selectedEventId:i,selectedMetricId:n,events:s,onSelect:l}=e,[a,o]=(0,d.useState)(!1),[u,c]=(0,d.useState)(""),[m,f]=(0,d.useState)(null),[p,g]=(0,d.useState)(null),[b,x]=(0,d.useState)(!1),[h,y]=(0,d.useState)(!1),[j,N]=(0,d.useState)("events"),[E,k]=(0,d.useState)(null),C=(0,d.useRef)(null),R=(0,d.useRef)(null),T=(0,d.useRef)(null),O=(0,d.useRef)(null),M=(0,d.useRef)(new Map),S=(0,d.useRef)(null),I=(0,d.useMemo)(()=>s.find(e=>e.id===i),[s,i]),A=(0,d.useMemo)(()=>{if(!u.trim())return{events:s,metrics:[],firstMatchingEventId:null};let e=u.toLowerCase(),t=new Set,r=null;return s.forEach(i=>{i.label.toLowerCase().includes(e)&&(t.add(i.id),r||(r=i.id))}),s.forEach(i=>{(0,eg.getAggregableMeasures)(i.id).map(e=>({id:e,label:(0,ep.labelForMeasure)(i.id,e)})).some(t=>t.label.toLowerCase().includes(e)||t.id.toLowerCase().includes(e))&&(t.add(i.id),r||(r=i.id))}),{events:s.filter(e=>t.has(e.id)),firstMatchingEventId:r}},[s,u]),D=h&&"metrics"===j&&E?E:m||(u.trim()&&A.firstMatchingEventId?A.firstMatchingEventId:i)||A.events[0]?.id,B=(0,d.useMemo)(()=>s.find(e=>e.id===D),[s,D]),F=(0,d.useMemo)(()=>D?ev(D):[],[D]),P=(0,d.useMemo)(()=>{if(!u.trim())return F;let e=u.toLowerCase(),t=F.filter(t=>t.label.toLowerCase().includes(e)||t.id.toLowerCase().includes(e));return 0===t.length&&D?F:t},[F,u,D]),q=(0,d.useMemo)(()=>{let e={};return A.events.forEach(t=>{let r=t.group||"Other";e[r]||(e[r]=[]),e[r].push(t)}),Object.entries(e).sort((e,t)=>{let[r]=e,[i]=t;return"Deprecated"===r&&"Deprecated"!==i?1:"Deprecated"!==r&&"Deprecated"===i?-1:0})},[A.events]),L=(0,d.useMemo)(()=>{let e=q.flatMap(e=>{let[,t]=e;return t});return m&&!e.some(e=>e.id===m),e},[q,m]),z=(0,d.useCallback)((e,t)=>{l(e,t),o(!1),c("")},[l]),U=(0,d.useCallback)(e=>{if(h)k(e),N("metrics");else{let t=ev(e)[0];t&&z(e,t.id)}},[h,z]),Q=(0,d.useCallback)(e=>{let t=h&&E?E:D;t&&z(t,e)},[h,E,D,z]),K=(0,d.useCallback)(e=>{if("ArrowDown"===e.key)if(e.preventDefault(),x(!0),m||p){if(m&&!p){let e=L.findIndex(e=>e.id===m);if(-1===e){let e=L[0];e&&f(e.id)}else{let t=L[e+1];t&&f(t.id)}}else if(p){let e=P.findIndex(e=>e.id===p),t=P[e+1];t&&g(t.id)}}else{let e=L[0];e&&f(e.id)}else if("ArrowUp"===e.key){if(e.preventDefault(),x(!0),m&&!p){let e=L.findIndex(e=>e.id===m);if(-1===e){let e=L[L.length-1];e&&f(e.id)}else e>0&&f(L[e-1].id)}else if(p){let e=P.findIndex(e=>e.id===p);e>0?g(P[e-1].id):g(null)}}else if("ArrowRight"===e.key)e.preventDefault(),x(!0),m&&P.length>0&&g(P[0].id);else if("ArrowLeft"===e.key)e.preventDefault(),x(!0),p&&g(null);else if("Enter"===e.key){if(m&&p)z(m,p);else if(m)if(u.trim()&&P.length>0)z(m,P[0].id);else{let e=s.find(e=>e.id===m);e&&U(e.id)}}else"Escape"===e.key&&o(!1)},[L,P,m,p,z,s,U,u]);(0,d.useEffect)(()=>{a&&(f(null),g(null),i&&R.current&&setTimeout(()=>{let e=R.current?.querySelector(`[data-event-id="${i}"]`);e?.scrollIntoView({block:"nearest",behavior:"auto"})},50))},[a,i]),(0,d.useEffect)(()=>{!m||L.some(e=>e.id===m)||u.trim()&&m===A.firstMatchingEventId||f(null)},[m,L,u,A.firstMatchingEventId]),(0,d.useEffect)(()=>{u.trim()&&A.firstMatchingEventId&&!b?(f(A.firstMatchingEventId),s.some(e=>e.id===A.firstMatchingEventId&&e.label.toLowerCase().includes(u.toLowerCase()))||P.length):u.trim()||i||f(null)},[u,A.firstMatchingEventId,P.length,i,s,b]),(0,d.useEffect)(()=>{if(b&&m&&R.current){let e=R.current.querySelector(`[data-event-id="${m}"]`);e&&e.scrollIntoView({block:"center",behavior:"smooth"})}},[m,b]),(0,d.useEffect)(()=>{let e=()=>{y(window.innerWidth<640)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,d.useEffect)(()=>{a||(N("events"),k(null))},[a]);let $=(0,d.useMemo)(()=>(function(e,t){if(!t||!e)return null;let r=(0,eg.getAggregableMeasures)(e).find(e=>e===t);return r?{id:r,label:(0,ep.labelForMeasure)(e,r)}:null})(i,n),[i,n]),V=I&&$?(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsxs)("span",{children:[I.label," "]}),(0,t.jsx)("span",{className:"text-gray-900 inline-block ml-1",children:$.label})]}):"Select Metric";return(0,t.jsxs)(v.Root,{modal:!0,onOpenChange:o,open:a,children:[(0,t.jsx)(v.Anchor,{className:"flex",children:(0,t.jsx)(v.Trigger,{asChild:!0,children:(0,t.jsx)(w.Button,{"aria-label":"Select event and metric",className:(0,G.cn)("!px-2 !py-4",r&&"!bg-white"),disabled:r,prefix:I?d.default.createElement(eh(I.id),{color:"gray-900"}):(0,t.jsx)(et.Database,{color:"gray-900"}),size:"small",suffix:(0,t.jsx)(_.ChevronUpDown,{color:"gray-800"}),type:"secondary",typeName:"button",children:V})})}),(0,t.jsx)(v.Portal,{children:(0,t.jsx)(v.Content,{align:"start",className:"tailwind-preflight",sideOffset:8,children:(0,t.jsxs)("div",{ref:O,className:(0,G.cn)("flex rounded-lg border-gray-alpha-400 bg-background-100 shadow-menu overflow-hidden font-sans relative isolate group",h?"w-[320px]":"w-[520px]"),children:[m&&!h&&(0,t.jsx)(eb,{buttonRef:m&&M.current.get(m)?{current:M.current.get(m)||null}:{current:null},containerRef:O,metricsRef:T,eventsScrollerRef:S,onMouseEnter:()=>{f(m)}}),(0,t.jsxs)("div",{className:"flex flex-1 flex-col",children:[h&&"metrics"===j&&(0,t.jsx)("div",{className:"flex items-center border-b px-2 py-3",children:(0,t.jsxs)("button",{onClick:()=>N("events"),className:"flex items-center gap-1 bg-transparent text-sm text-gray-800 hover:text-gray-900",type:"button",children:[(0,t.jsx)(em.ChevronRight,{className:"size-3 rotate-180"}),"Back to Events"]})}),!(h&&"metrics"===j)&&(0,t.jsxs)("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[(0,t.jsx)("input",{className:"w-full border-none bg-transparent text-sm outline-none",onChange:e=>c(e.target.value),placeholder:"Find metric…",ref:C,value:u,onKeyDown:K}),(0,t.jsx)(Z.Kbd,{small:!0,style:{paddingRight:"0.5rem"},children:"Esc"})]}),(0,t.jsx)("div",{className:(0,G.cn)("flex h-[340px]",h&&"flex-col"),children:u.trim()&&0===A.events.length?(0,t.jsx)("div",{className:"flex flex-1 items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center text-sm text-gray-800",children:[(0,t.jsx)("div",{className:"mb-2",children:"No events or metrics found"}),(0,t.jsx)("div",{className:"text-xs text-gray-600",children:"Try adjusting your search terms"})]})}):(0,t.jsxs)(t.Fragment,{children:[(!h||"events"===j)&&(0,t.jsx)("div",{className:(0,G.cn)(h?"flex-1":"w-[260px] border-r"),children:(0,t.jsx)(ee.Scroller,{className:"h-[340px]",overflow:"y",setContainerRef:e=>{S.current=e},children:(0,t.jsx)("div",{className:"px-2 py-2",ref:R,children:q.map(e=>{let[r,n]=e;return(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)("p",{className:"text-copy-14 mb-1 px-2 text-xs text-gray-800",children:r}),n.map(e=>{let r=eh(e.id),n=function(e){let{eventId:t,selectedEventId:r,activeEventId:i,activeMetricId:n,displayEventId:s}=e,l=t===r,a=t===s;return{isSelected:l,isActive:t===i,isDisplayed:a,showSelectedBg:l&&!i,isIndirectlyActive:a&&n}}({eventId:e.id,selectedEventId:i,activeEventId:m,activeMetricId:p,displayEventId:D});return(0,t.jsxs)("button",{ref:t=>{t?M.current.set(e.id,t):M.current.delete(e.id)},"data-event-id":e.id,className:(0,G.cn)("flex w-full items-center gap-2 rounded px-2 py-1.5 text-sm font-sans cursor-pointer","bg-white focus:bg-gray-100 focus:outline-none",!b&&"hover:bg-gray-100",(n.showSelectedBg||n.isIndirectlyActive)&&"bg-gray-100",n.isActive&&!p&&"bg-gray-100"),onMouseEnter:()=>{b||f(e.id)},onMouseMove:()=>x(!1),onFocus:()=>f(e.id),onClick:()=>U(e.id),type:"button",children:[(0,t.jsx)(r,{className:"size-4",color:"gray-900"}),(0,t.jsx)("span",{className:"flex-1 text-left",children:e.label}),(0,t.jsx)(em.ChevronRight,{className:(0,G.cn)("size-3 text-gray-800 ",n.isDisplayed?"opacity-100":"opacity-0")})]},e.id)})]},r)})})})}),(!h||"metrics"===j)&&(0,t.jsx)("div",{className:(0,G.cn)("flex-1"),ref:T,children:(0,t.jsx)(ee.Scroller,{className:"h-[340px]",overflow:"y",children:(0,t.jsxs)("div",{className:"px-2 py-2",children:[B&&(0,t.jsxs)("p",{className:"text-copy-14 mb-1 px-2 text-xs text-gray-800",children:["Metrics for ",B.label]}),P.length>0?P.map((e,r)=>{let s=function(e){let{metricId:t,metricIndex:r,selectedMetricId:i,activeEventId:n,activeMetricId:s,displayEventId:l,selectedEventId:a,isMobile:o,mobileStep:u}=e,c=t===i&&l===a;return{isSelected:c,isActive:(!o||"metrics"!==u)&&t===s,isFirstAndActive:(!o||"metrics"!==u)&&0===r&&n&&!s&&!c,showSelectedBg:c&&!s}}({metricId:e.id,metricIndex:r,selectedMetricId:n,activeEventId:m,activeMetricId:p,displayEventId:D,selectedEventId:i,isMobile:h,mobileStep:j});return(0,t.jsx)("button",{className:(0,G.cn)("flex w-full items-center rounded px-2 py-1.5 text-sm font-sans cursor-pointer","bg-white focus:bg-gray-100 focus:outline-none",!b&&"hover:bg-gray-100",(s.isFirstAndActive||s.showSelectedBg)&&"bg-gray-100",s.isActive&&"bg-gray-100"),onMouseEnter:()=>{b||h&&"metrics"===j||g(e.id)},onMouseLeave:()=>{b||h&&"metrics"===j||g(null)},onMouseMove:()=>x(!1),onClick:()=>Q(e.id),type:"button",children:(0,t.jsx)("span",{className:"flex-1 text-left",children:e.label})},e.id)}):(0,t.jsx)("div",{className:"px-2 py-4 text-center text-sm text-gray-800",children:u?"No metrics match your search":"No metrics available"})]})})})]})})]})]})})})]})}var ej=e.i(7813548),eN=e.i(8735244),eE=e.i(2924363),ek=e.i(7867910),eC=e.i(1438473);function eR(e){let{onGeneratedQuery:r,query:i,disabled:n,className:l}=e,o=(0,N.useToasts)(),{team:m}=(0,a.useTeam)(),f=(0,d.useRef)(null),[p,g]=(0,d.useState)(!1),[b,x]=(0,d.useState)(""),{isGenerating:h,generate:y,error:v}=(e=>{let{onSuccess:t,query:r}=e,[i,n]=(0,d.useState)(!1),[l,o]=(0,d.useState)(null),{team:m}=(0,a.useTeam)(),f=(0,N.useToasts)();return{isGenerating:i,generate:(0,d.useCallback)(async e=>{if(!e.trim())return;n(!0);let i=new URLSearchParams({previousQuery:JSON.stringify(r),prompt:e}).toString();try{let e=await fetch(`${s.API_OBSERVABILITY_QUERY_GENERATION}?${i}`),r=await e.json(),n=r.rollups.value,l=(0,eg.getGroupableDimensions)(r.event),a=r.groupBy?.filter(e=>l.includes(e))??[];o(null),t({metric:`${r.event}.${n.measure}`,by:a,filter:r.filter??"",aggregation:n.aggregation,time:r.range??{from:new Date(r.startTime),to:new Date(r.endTime)}})}catch{let e="Error generating query";f.error(e),o(e)}finally{n(!1),u.analytics.track(c.AnalyticsEvent.QUERY_BUILDER_GENERATED_QUERY,{prompt:e,plan:m?.billing?.plan??"hobby"})}},[t,r,m,f]),error:l}})({query:i,onSuccess:e=>{r(e),f.current={query:JSON.stringify(e),prompt:b},x("")}}),j=(0,d.useRef)(null),[E,k]=(0,d.useState)(!1),C=E&&!h&&!v,R=async e=>{e.preventDefault(),b.trim()&&(k(!0),await y(b))},T="query-builder-input";return(0,ek.useHotkey)(()=>{g(!0),setTimeout(()=>j.current?.focus(),0)},"/"),(0,t.jsx)(ej.Root,{className:(0,G.cn)("border-t border-gray-400 px-4 bg-background-100",l),collapsible:!0,value:p?"query-assistant":"",type:"single",children:(0,t.jsxs)(ej.Item,{value:"query-assistant",children:[(0,t.jsxs)(ej.Trigger,{className:"group flex items-center w-full bg-transparent text-label-14 text-gray-800 font-medium p-0 py-3 gap-3 cursor-pointer",onClick:()=>{g(!p),p||setTimeout(()=>j.current?.focus(),0)},children:[(0,t.jsx)(em.ChevronRight,{className:"transition-transform group-[[data-state=open]]:rotate-90"}),(0,t.jsx)("span",{className:"mr-auto",children:"Query Assistant"}),(0,t.jsx)(Z.Kbd,{className:(0,G.cn)("transition-opacity",0!==b.trim().length&&"hidden"),small:!0,children:"/"})]}),(0,t.jsx)(ej.Content,{className:"pb-4",children:(0,t.jsxs)("form",{onSubmit:R,children:[(0,t.jsx)("label",{className:"sr-only",htmlFor:T,children:"Prompt"}),(0,t.jsx)(D.Input,{className:"h-12 rounded-lg",id:T,innerWrapperClassName:(0,G.cn)("bg-background-100 shadow h-12 font-sans text-[14px] relative z-10 border-gray-200 focus:border-gray-600 rounded-lg overflow-hidden m-1","h-10 shadow-border rounded-md",{"bg-gray-100":h}),name:T,disabled:h||n,onChange:e=>{x(e.target.value),k(!1)},placeholder:"Show me requests by host…",prefix:(0,t.jsx)(ef.Sparkles,{size:14}),prefixStyling:!1,ref:j,suffix:(0,t.jsxs)("div",{className:"flex h-full gap-2 !pr-1",children:[C?(0,t.jsx)(w.Button,{"aria-label":"Not what I expected",className:"!px-0",size:"small",type:"secondary",onClickCapture:e=>{e.preventDefault()},onClick:()=>{k(!1),u.analytics.track(c.AnalyticsEvent.QUERY_BUILDER_FEEDBACK,{feedback:"badly-generated-query",plan:m?.billing?.plan??"hobby",prompt:f.current?.prompt??"",generatedQuery:f.current?.query??""}),o.success("Thank you for the feedback!")},children:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 px-0.5 md:px-0",children:[(0,t.jsx)("span",{className:"hidden px-1.5 md:block",children:"Not what I expected"}),(0,t.jsx)(eE.ThumbDown,{})]})}):null,h&&(0,t.jsx)("div",{className:"flex items-center justify-center px-2",children:(0,t.jsx)(eN.Spinner,{size:14})}),(0,t.jsx)(w.Button,{"aria-label":"Build It",className:"!px-0 disabled:hidden",disabled:0===b.trim().length||h,size:"small",typeName:"submit",children:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 px-0.5 md:px-0",children:[(0,t.jsx)("span",{className:"hidden px-1.5 md:block",children:"Generate Query"}),(0,t.jsx)(eC.ArrowRight,{})]})})]}),suffixContainer:!1,suffixStyling:!1,typeName:"text",value:b})]})})]})})}var eT=e.i(962099),eO=e.i(6029070),eM=e.i(5627633),eS=e.i(268049);function eI(e){return{granularity:e,id:(0,eS.milliseconds)(e).toString(),label:(0,eM.formatDuration)(e),type:"string"}}var eA=e.i(6190059),eD=e.i(1283928),eB=e.i(1717203),eF=e.i(9486194),eP=e.i(8690335),eq=e.i(9372366),e_=e.i(1111237),eL=e.i(6198010);let ez="!ring-1 ring-gray-400 outline-offset-2 outline-[var(--ds-focus-color)] outline-2 overflow-visible focus:outline";function eU(e){let{addButtonLabel:r,className:i,dimensions:n,values:s,onChange:l,isLoading:a,disabled:o,id:u}=e,[c,m]=(0,d.useReducer)(eK,{values:s,dimensions:n},eQ);(0,d.useEffect)(()=>{m({type:"updateProps",dimensions:n,values:s})},[n,s]);let f=c.values.length>0;return(0,t.jsxs)("fieldset",{id:u,className:(0,G.cn)("flex flex-row flex-wrap items-center gap-2",i),children:[c.values.map((e,r)=>(0,t.jsxs)("span",{className:"flex flex-row",children:[(0,t.jsx)(A.SingleFilterPopoverBox,{className:(0,G.cn)("!p-1",ez,!o&&"!rounded-l"),disabled:o,label:"dimension",onChange:e=>m({type:"change",value:e,index:r,onChange:l}),onOpenChange:e=>m({type:"toggle",open:e,index:r}),open:c.open[r],options:c.remaining,rounded:o,value:e}),o?null:(0,t.jsx)(w.Button,{"aria-label":`Remove ${e.label}`,className:(0,G.cn)("!px-0.5 !text-gray-900 hover:!text-gray-1000",ez),onClick:()=>m({type:"remove",index:r,onChange:l}),size:"small",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},svgOnly:!0,type:"secondary",typeName:"button",children:(0,t.jsx)(z.CrossSmall,{size:"small"})})]},e.id)),(0,t.jsx)(A.SingleFilterPopoverBox,{className:"border !p-1",isLoading:a,label:"dimension",onChange:e=>m({type:"add",value:e,onChange:l}),onOpenChange:e=>m({type:"toggle",open:e}),open:c.openAdd,options:c.remaining,rounded:!0,children:(0,t.jsx)(w.Button,{"aria-label":"Add dimension",className:"!text-gray-900 data-[state='open']:!bg-gray-100 hover:!text-gray-1000",disabled:o,size:"small",type:"tertiary",...f?{shape:"square",svgOnly:!0,children:(0,t.jsx)(eL.Plus,{})}:{children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(eL.Plus,{}),r]})}})})]})}function eQ(e){let{values:t,dimensions:r}=e;return{open:Array.from(t,()=>!1),openAdd:!1,values:t,remaining:e$(r,t),allDimensions:r}}function eK(e,t){switch(t.type){case"toggle":if(void 0===t.index)return{...e,openAdd:t.open};return t.index<0||t.index>=e.values.length?{...e}:{...e,open:[...e.open.slice(0,t.index),t.open,...e.open.slice(t.index+1)]};case"updateProps":{let{dimensions:r}=t,i=t.values.filter(e=>{let{id:t}=e;return r.some(e=>e.id===t)});return{...e,remaining:e$(r,i),values:i,allDimensions:r}}case"add":return{...e,...eG(e.allDimensions,[...e.values,t.value],t.onChange)};case"change":{let{index:r,value:i,onChange:n}=t;if(r<0||r>=e.values.length)return e;return{...e,...eG(e.allDimensions,[...e.values.slice(0,r),i,...e.values.slice(r+1)],n)}}case"remove":{let{index:r,onChange:i}=t;return{...e,...eG(e.allDimensions,[...e.values.slice(0,r),...e.values.slice(r+1)],i)}}default:return e}}function e$(e,t){return e.filter(e=>{let{id:r}=e;return!t.some(e=>e.id===r)})}function eG(e,t,r){return setTimeout(()=>r?.(t),0),{open:Array.from(t,()=>!1),openAdd:!1,values:t,remaining:e$(e,t)}}var eV=e.i(8522580),eW=e.i(6982071);e.i(6728635);var eY=e.i(2630141),eH=e.i(5348482);function eJ(){let{team:e}=(0,a.useTeam)(),r=(0,eY.useOpenEnableModal)(),[,i]=(0,eH.useQueryBuilderQueryState)(),n=e?.billing?.plan==="hobby"?"Upgrade to Pro":"Get Observability Plus";return(0,t.jsx)(eV.Note,{action:(0,t.jsx)(w.Button,{size:"small",onClick:()=>{u.analytics.track(c.AnalyticsEvent.OBSERVE_FEATURE_SEPARATION,{plan:e?.billing?.plan??"hobby",page:"query-builder",type:"modal_opened"}),r({from:"observability",via:"query-builder",upgradeUseCase:"query-builder"}),i({builder:!1})},children:n}),variant:"contrast",fill:!0,icon:(0,t.jsx)(eW.LockClosedSmall,{}),type:"secondary",className:"!rounded-md !pr-1.5",size:"small",children:(0,t.jsxs)("p",{children:["Read-only mode."," ",(0,t.jsx)("span",{className:"font-medium",children:"Unlock custom queries"})," by upgrading to"," ",e?.billing?.plan==="hobby"?"Pro and Observability Plus":"Observability Plus","."]})})}function eX(e){let{query:r,setQuery:i,Actions:s,Title:l,variables:a,children:o,embedded:u=!0}=e,[c,m]=(0,d.useState)(!1),{hasObservabilityPlusAccess:f}=(0,y.useHasObservabilityPlus)(),p=(0,d.useMemo)(()=>(0,n.replaceVariables)(r,a),[r,a]),{isReady:g}=(0,eA.useAccessibleMetrics)(),b=!g||!f,x=(0,d.useRef)(null),h=(0,d.useCallback)(()=>{x.current&&m(x.current.scrollTop>40)},[]),v=(0,d.useCallback)(()=>{x.current&&x.current.scrollTo({top:0,behavior:"smooth"})},[]);return(0,t.jsx)(S.ObservabilityChartContextProvider,{children:u?(0,t.jsxs)("div",{ref:x,className:"relative flex flex-1 flex-col overflow-y-auto m-4",onScroll:h,children:[(0,t.jsxs)("div",{className:"sticky left-0 top-0 z-10 pb-3 flex items-center justify-between gap-3 bg-background-100",children:[(0,t.jsx)("div",{className:"flex flex-1 items-center justify-start gap-2",children:l}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(w.Button,{"aria-label":"Scroll to top",onClick:v,type:"tertiary",svgOnly:!0,"aria-hidden":!c,shape:"square",className:(0,G.cn)("transition-all duration-200",c?"opacity-100 translate-y-0":"opacity-0 translate-y-2 pointer-events-none"),tabIndex:c?0:-1,children:(0,t.jsx)(P.ArrowUp,{size:16})}),s]})]}),(0,t.jsx)(e1,{className:"sticky inset-x-0 pt-px",disabled:b,embedded:u,query:r,setQuery:i,variables:a}),(0,t.jsx)(e6,{className:"p-px sticky inset-x-0",disabled:b,query:r,setQuery:i}),(0,t.jsx)(e_.ResultsChart,{query:p,readOnly:b,scrollerRef:u?x:void 0,setQuery:i,showTable:r.by.length>0,sticky:u,variant:"minimal"}),o]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e1,{disabled:b,embedded:u,query:r,setQuery:i,variables:a}),(0,t.jsxs)("div",{className:"p-4 flex flex-col gap-3 border-1 rounded-md shadow-border bg-background-100",children:[(0,t.jsx)(e6,{disabled:b,query:r,setQuery:i}),(0,t.jsx)(e_.ResultsChart,{query:p,readOnly:b,scrollerRef:u?x:void 0,setQuery:i,showTable:r.by.length>0,sticky:u,variant:"minimal"}),o]})]})})}function eZ(e){let{query:r,setQuery:i,embedded:n}=e,{hasObservabilityPlusAccess:s,ready:l}=(0,y.useHasObservabilityPlus)(),a=(0,d.useMemo)(()=>(0,eP.toSonarQuery)(r),[r]);return!l||s?(0,t.jsx)(eR,{className:n?"bg-background-200 border-0 rounded-md":"rounded-b-md",onGeneratedQuery:i,query:a}):(0,t.jsx)("div",{className:n?"pl-2":"p-4 pt-0",children:(0,t.jsx)(eJ,{})})}let e0="flex flex-col md:flex-row gap-3 align-center";function e1(e){let{disabled:r,embedded:i,query:n,setQuery:s,variables:l,className:o}=e,[u,c]=(0,d.useState)(!1),{isReady:m,accessibleDimensions:f,by:p}=(0,eO.useAccessibleDimensions)(n),{accessibleEvents:g}=(()=>{let{can:e}=(0,eB.default)(),{team:t}=(0,a.useTeam)();return t?{isReady:!0,accessibleEvents:eF.queryBuilderEvents.filter(r=>(0,eg.canAccessEvent)({event:r,team:t,can:e})).map(e=>({id:e,label:"label"in eD.AllEvents[e]?eD.AllEvents[e].label:e,type:"string",group:(e=>{switch(e){case"serverlessFunctionInvocation":case"middlewareInvocation":case"outgoingRequest":return"Compute";case"incomingRequest":case"imageTransformation":case"isrOperation":return"Edge Network";case"blockedConnection":case"firewallAction":case"botIdCheck":return"Security";case"aiGatewayRequest":return"AI";case"edgeFunctionInvocation":return"Deprecated";default:return"Other"}})(e)})).toSorted((e,t)=>"Deprecated"===e.group&&"Deprecated"!==t.group?1:"Deprecated"!==e.group&&"Deprecated"===t.group?-1:0)}:{isReady:!1,accessibleEvents:[]}})(),{event:b,measure:x}=(0,eP.splitEventAndMeasure)(n),{accessibleAggregations:h,aggregation:y}=(0,eT.useAccessibleAggregations)(n),v=(0,eq.useValuesResolver)(n);((e,t)=>{let{event:r}=(0,eP.splitEventAndMeasure)(e),i=(0,d.useCallback)((e,t)=>{let r=(0,eg.getGroupableDimensions)(e);return t.filter(e=>r.includes(e))},[]);(0,d.useEffect)(()=>{if(e.by.length>0){let n=i(r,e.by);n.length!==e.by.length&&t({by:n})}},[e.by,t,r,i])})(n,s);let w=(0,d.useMemo)(()=>f.toSorted((e,t)=>e.label.localeCompare(t.label)),[f]),j=(0,d.useMemo)(()=>({dimensions:w,operators:V.operators,resolveValues:v,defaultSingleOperator:V.defaultSingleOperator,defaultMultiOperator:V.defaultMultiOperator,defaultArrayOperator:V.defaultArrayOperator}),[w,v]),N=(0,d.useMemo)(()=>(0,eP.parseFilters)(n.filter),[n.filter]),E=0===N.length&&n.filter,k=(0,d.useCallback)(e=>s({filter:(0,eP.serializeFilters)(e)}),[s]),C=(0,d.useCallback)(e=>{let t=n.view;0===e.length&&t?.type==="table"?t={type:"big-number"}:e.length>0&&t?.type==="big-number"&&(t={type:"table"}),s({by:e.map(e=>{let{id:t}=e;return t}),view:t})},[s,n.view]);return(0,t.jsxs)("div",{className:(0,G.cn)("flex flex-col bg-background-100 mb-3",!i&&"shadow-border rounded-md",o),children:[(0,t.jsxs)("div",{className:(0,G.cn)("flex flex-col flex-1 gap-3",i?"p-2 pt-0 pb-4":"p-4 pb-3"),children:[(0,t.jsxs)("div",{className:e0,children:[(0,t.jsx)(e4,{htmlFor:"event-metric",className:e2,children:"Metric"}),(0,t.jsxs)("div",{className:"flex flex-col flex-wrap md:flex-row gap-2 flex-1 [&>:nth-child(2)]:mr-auto",children:[(0,t.jsx)(ew,{disabled:r,selectedEventId:b,selectedMetricId:x,events:g,onSelect:(e,t)=>{s({metric:`${e}.${t}`,aggregation:function(e){let t=eD.AllMeasures[e];if(!t)return"sum";let{unit:r,aggregations:i}=t;switch(r){case"count":return i.includes("sum")?"sum":i[0];case"milliseconds":case"seconds":case"bytes":case"megabytes":case"gigabyte_hour":case"ratio":case"percent":return i.includes("avg")?"avg":i[0];default:return i[0]}}(t)})}}),(0,t.jsx)(A.SingleFilterPopoverBox,{id:"aggregation",className:"!px-2 !py-4",disabled:r,label:"aggregation",onChange:e=>{s({aggregation:e.id}),c(!1)},onOpenChange:c,open:u,options:h,rounded:!0,suffix:(0,t.jsx)(_.ChevronUpDown,{color:"gray-800"}),value:y}),(0,t.jsx)(X,{disabled:r,value:n.time,onChange:e=>s({time:e}),trackEvents:!0,variables:l})]})]}),(0,t.jsxs)("div",{className:e0,children:[(0,t.jsx)(e4,{htmlFor:"by",className:e2,children:"Group By"}),(0,t.jsx)("div",{className:"flex-1",children:m?(0,t.jsx)(eU,{addButtonLabel:"Add",id:"by",dimensions:w,disabled:r,isLoading:!m,onChange:C,values:p}):(0,t.jsx)(B.Skeleton,{height:32,width:100})})]}),E?(0,t.jsx)(e8,{setQuery:s,query:n}):(0,t.jsxs)("div",{className:e0,children:[(0,t.jsx)(e4,{htmlFor:"filter",className:e2,children:"Filter"}),(0,t.jsx)("div",{className:"flex-1",children:m?(0,t.jsx)(I.FilterBar,{config:j,disabled:r,filters:N,onChange:k}):(0,t.jsx)(B.Skeleton,{height:32,width:200})})]})]}),(0,t.jsx)(eZ,{embedded:i,query:n,setQuery:s})]})}let e2="md:w-16 md:shrink-0 md:pt-1.5";function e4(e){let{children:r,className:i,htmlFor:n,...s}=e;return(0,t.jsx)("label",{className:(0,G.cn)("text-sm font-medium text-gray-800",i),htmlFor:n,...s,children:r})}function e8(e){let{setQuery:r,query:i}=e;return(0,t.jsxs)("div",{className:"flex w-full flex-row items-center gap-2 py-2 col-span-2",children:[(0,t.jsx)(j.Tooltip,{text:"Invalid or unsupported filter saved",children:(0,t.jsx)($.Question,{size:16})}),(0,t.jsxs)("div",{className:"flex w-full flex-row items-center",children:[(0,t.jsx)(j.Tooltip,{className:"w-full",text:i.filter,children:(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(D.Input,{"aria-label":"Invalid or unsupported filter saved",className:"w-full overflow-visible outline-2 outline-offset-2 outline-[var(--ds-focus-color)] !ring-1 ring-gray-400 focus:outline",disabled:!0,style:{borderTopRightRadius:0,borderBottomRightRadius:0},value:i.filter})})}),(0,t.jsx)(w.Button,{"aria-label":"Clear filter",className:"overflow-visible !border-l-0 outline-2 outline-offset-2 outline-[var(--ds-focus-color)] !ring-1 ring-gray-400 focus:outline",onClick:()=>r({filter:""}),size:"medium",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},svgOnly:!0,type:"secondary",children:(0,t.jsx)(z.CrossSmall,{size:20})})]})]})}function e6(e){let r,i,n,s,{className:l,query:a,setQuery:o,disabled:u}=e,[c,m]=(0,d.useState)(!1),{accessibleGranularities:f,granularity:p}=(r=(0,d.useMemo)(()=>{let{start:e,end:t}=(0,g.fromTimeToRange)(a.time);return Math.round(t.getTime()-e.getTime())},[a.time]),i=(0,d.useMemo)(()=>(0,g.getGranularityFromDuration)(r),[r]),n=(0,d.useMemo)(()=>{let e=[],t=(0,eS.milliseconds)(i);for(let i of g.preferredGranularities){let n=(0,eS.milliseconds)(i);n>=t&&n<=r&&e.push(eI(i))}return e},[i,r]),s=(0,d.useMemo)(()=>n.find(e=>{let{id:t}=e;return t===(0,eS.milliseconds)(a.granularity??{}).toString()})??eI(i),[i,n,a.granularity]),{accessibleGranularities:n,granularity:s});return(0,t.jsxs)("div",{className:(0,G.cn)("flex flex-wrap gap-2 items-center justify-end",l),children:[(0,t.jsx)(A.SingleFilterPopoverBox,{id:"granularity",disabled:u,label:"granularity",onChange:e=>{let{granularity:t}=e;o({granularity:t}),m(!1)},onOpenChange:m,open:c,options:f,prefix:(0,t.jsx)(L.Clock,{color:"gray-900"}),rounded:!0,suffix:(0,t.jsx)(_.ChevronUpDown,{color:"gray-800"}),value:p}),(0,t.jsx)(e9,{query:a,onChange:e=>o({view:e})})]})}let e3=[{type:"line",icon:(0,t.jsx)(U.LineChart,{})},{type:"area",icon:(0,t.jsx)(q.BarChart,{})},{type:"table",icon:(0,t.jsx)(Q.MenuAlt,{}),isDisabled:e=>(e?.by.length??0)===0?"Add a Group By clause to view results in a Table.":null},{type:"big-number",icon:(0,t.jsx)(K.Percentage,{}),isDisabled:e=>(e?.by.length??0)>=1?"Remove your Group By clause to view results as a number.":null}];function e9(e){let{query:r,onChange:i}=e,n=e3.filter(e=>{let{isDisabled:t}=e;return!t?.(r)});return(0,t.jsx)(F.Switch,{name:"view",size:"small",children:n.map(e=>{let{type:n,icon:s}=e;return(0,t.jsx)(F.Switch.Control,{checked:(r?.view?.type??"line")===n,icon:s,value:n,onChange:()=>i({type:n})},n)})})}e.s(["QueryBuilder",()=>eX],1135066)}]);

//# debugId=15a5f825-479c-b224-0c29-9fcd4c7e7b8a
//# sourceMappingURL=dd6667468e184df1.js.map