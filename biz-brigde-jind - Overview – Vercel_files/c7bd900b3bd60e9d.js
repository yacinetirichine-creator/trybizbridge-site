;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="eee4cdb3-83f2-d851-dc0f-00bb80c83f9f")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6269588,e=>{e.v({badge:"bell-module__AXcxMG__badge",badgeMotion:"bell-module__AXcxMG__badgeMotion",btn:"bell-module__AXcxMG__btn",buttonContent:"bell-module__AXcxMG__buttonContent",content:"bell-module__AXcxMG__content",fadeOut:"bell-module__AXcxMG__fadeOut",focus:"bell-module__AXcxMG__focus",frame:"bell-module__AXcxMG__frame",frameMotion:"bell-module__AXcxMG__frameMotion",hover:"bell-module__AXcxMG__hover",icon:"bell-module__AXcxMG__icon",lg:"bell-module__AXcxMG__lg",md:"bell-module__AXcxMG__md",pressed:"bell-module__AXcxMG__pressed",shadow:"bell-module__AXcxMG__shadow",sm:"bell-module__AXcxMG__sm",statusIcon:"bell-module__AXcxMG__statusIcon",svgNoPointerEvents:"bell-module__AXcxMG__svgNoPointerEvents",text:"bell-module__AXcxMG__text"})},1889129,e=>{e.v({archiveFooter:"feed-module__491t5W__archiveFooter",breakAll:"feed-module__491t5W__breakAll",cell:"feed-module__491t5W__cell",commentsView:"feed-module__491t5W__commentsView",emptyIcon:"feed-module__491t5W__emptyIcon",emptyLabel:"feed-module__491t5W__emptyLabel",feed:"feed-module__491t5W__feed",feedContent:"feed-module__491t5W__feedContent",header:"feed-module__491t5W__header",headerGrid:"feed-module__491t5W__headerGrid",settingsLink:"feed-module__491t5W__settingsLink",tabText:"feed-module__491t5W__tabText",view:"feed-module__491t5W__view"})},6241262,e=>{e.v({archive:"item-module__Hg2RJW__archive",archiveButton:"item-module__Hg2RJW__archiveButton",dot:"item-module__Hg2RJW__dot",fallbackIcon:"item-module__Hg2RJW__fallbackIcon","focus-visible":"item-module__Hg2RJW__focus-visible",focusVisible:"item-module__Hg2RJW__focusVisible",hidden:"item-module__Hg2RJW__hidden",item:"item-module__Hg2RJW__item",link:"item-module__Hg2RJW__link",notificationContent:"item-module__Hg2RJW__notificationContent",subAvatar:"item-module__Hg2RJW__subAvatar",subject:"item-module__Hg2RJW__subject"})},8698247,e=>{e.v({commentWrapper:"comment-item-module__JJqGUq__commentWrapper",selected:"comment-item-module__JJqGUq__selected"})},2977232,e=>{e.v({commentsDetailView:"notifications-module__J76_1G__commentsDetailView"})},6561189,e=>{"use strict";var t=e.i(1146226),i=e.i(5169864),s=e.i(4004502),n=e.i(8634363),a=e.i(119294),l=e.i(7917902);e.i(2957938),e.i(9357228);var r=e.i(4228477),o=e.i(5610834);let d={"mvp-stub-notifications":(e,t,i,s)=>!1,"deployment-failed"(e,t,i,s){let{teamSlug:n,project:a,id:l}=i;return!!(n&&a&&l&&e===`/${n}/${a}/${l}`||e.startsWith("/new/import/"))&&!![...t.getAll("id"),...t.getAll("deploymentIds")].find(e=>{if(e)return(s.data?.actionUrl||"").includes(e.replace("dpl_",""))})}};function c(e){let t=(0,r.useAuthenticatedKnockClient)("pk_cBlwgRRBkMc-3KKgA0J7W-q7LbxjyDuL1u3XXU164p4",e.userId,e.userToken),s=(0,r.useNotifications)(t,"6f1dd852-e25d-4cb7-b99c-6b0acc743109",{page_size:e.pageSize||10,tenant:e.tenant,archived:"archived"===e.tab?"only":"exclude"});if(!s)throw Error("expected feed");let[n,a]=(0,i.useState)(),l=(0,o.usePathname)(),c=(0,o.useSearchParams)(),u=(0,o.useParams)();(0,i.useEffect)(()=>{if("inbox"!==e.tab)return;let t=e=>{let t;l&&c&&u&&(t=e.items.filter(e=>!!(!e.seen_at&&1===e.total_activities&&e.source.key in d&&d[e.source.key](l,c,u,e)))).length&&s.markAsSeen(t)};return s.on("items.received.*",t),()=>s.off("items.received.*",t)},[s,u,l,e.tab,c]),(0,i.useEffect)(()=>{if(e.userId)try{let t=new BroadcastChannel(`__notifier_feed${e.userId}${e.tenant??""}`);t.addEventListener("message",t=>{let{data:i}=t;if("inbox"===e.tab&&(s.getState().setMetadata(i.state.metadata),s.store.setState({items:i.state.items})),"archived"===e.tab&&("markAsArchived"===i.method||"markAllAsArchived"===i.method)){let e=new Date().toISOString();i.changes.forEach(t=>{t.archived_at=e}),s.store.setState({items:i.changes.concat(s.store.getState().items)})}});let i=async e=>{let i=await s.markAsArchived(e),n=Array.isArray(e)?e:[e],{items:a,metadata:l}=s.getState();return t.postMessage({state:{items:a,metadata:l},method:"markAsArchived",changes:n}),i},n=async()=>{let{items:e,metadata:i}=s.store.getState(),n=s.markAllAsArchived();return t.postMessage({state:{items:e,metadata:i},method:"markAllAsArchived",changes:e}),n};return a({markAsArchived:i,markAllAsArchived:n}),()=>{a(void 0),t.close()}}catch(e){}},[s,e.tab,e.tenant,e.userId]);let{loading:m,items:h,metadata:f}=(0,r.useNotificationStore)(s),x=(0,i.useCallback)(async e=>{n?.markAsArchived?await n.markAsArchived(e):await s.markAsArchived(e)},[s,n]),_=(0,i.useCallback)(async()=>{n?.markAllAsArchived?await n.markAllAsArchived():await s.markAllAsArchived()},[s,n]);return{loading:m,items:h??[],metadata:f??{},feed:s,markAsArchived:x,markAllAsArchived:_}}var u=e.i(6352514),m=e.i(4810515),h=e.i(8097508),f=e.i(1581757),x=e.i(1080700);let _=(0,i.createContext)(null);_.displayName="NotificationContext";let v=/vtest314-[^@]+@zeit\.pub/;function b(){let{user:e,team:t,isLoading:i}=(0,l.useAccount)(),{isLoading:s,token:n}=(0,m.useKnockToken)({});if(!i&&!t)return{state:null,isLoading:!1};let a=!!(i||s);return i||(e?.limited!==!0||t)&&(!t||!0!==t.limited)?n?{state:"full",tenant:t?.id,isLoading:a}:e?{state:"placeholder",tenant:t?.id,isLoading:a}:{state:null,isLoading:a}:{state:"limited",tenant:t?.id,isLoading:a}}var g=e.i(9001495),p=e.i(5338940),j=e.i(3322724),k=e.i(4585051),w=e.i(6280036),y=e.i(287495);function A(){let{resolvedTheme:e}=(0,w.useTheme)(),i=(0,y.default)();return(0,t.jsxs)("svg",{fill:"none",height:"36",opacity:+!!e,viewBox:"0 0 36 36",width:"36",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("rect",{fill:i?"#F0FDF4":"#071D10",height:"35",rx:"17.5",width:"35",x:"0.5",y:"0.5"}),(0,t.jsx)("g",{clipPath:"url(#clip0_798_8657)",children:(0,t.jsx)("path",{d:"M14.6667 17.8809L16.75 19.9643L21.2143 15.5M26.3333 18C26.3333 22.6024 22.6024 26.3333 18 26.3333C13.3976 26.3333 9.66666 22.6024 9.66666 18C9.66666 13.3976 13.3976 9.66666 18 9.66666C22.6024 9.66666 26.3333 13.3976 26.3333 18Z",stroke:i?"#0D883B":"#86EFAC",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"})}),(0,t.jsx)("rect",{height:"35",rx:"17.5",stroke:i?"#DCFCE7":"#0D3B1E",width:"35",x:"0.5",y:"0.5"}),(0,t.jsx)("defs",{children:(0,t.jsx)("clipPath",{id:"clip0_798_8657",children:(0,t.jsx)("rect",{fill:"white",height:"20",transform:"translate(8 8)",width:"20"})})})]})}function C(){let{resolvedTheme:e}=(0,w.useTheme)(),i=(0,y.default)(),s=i?"#BD5200":"#FDE68A";return(0,t.jsxs)("svg",{fill:"none",height:"36",opacity:+!!e,viewBox:"0 0 36 36",width:"36",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("rect",{fill:i?"#FFFBEB":"#241005",height:"35",rx:"17.5",width:"35",x:"0.5",y:"0.5"}),(0,t.jsxs)("g",{clipPath:"url(#clip0_798_8667)",children:[(0,t.jsx)("path",{d:"M16.575 11.2167L9.51665 23C9.37113 23.252 9.29413 23.5377 9.29331 23.8288C9.2925 24.1198 9.3679 24.4059 9.51201 24.6588C9.65612 24.9116 9.86392 25.1223 10.1147 25.2699C10.3656 25.4174 10.6507 25.4968 10.9417 25.5H25.0583C25.3493 25.4968 25.6344 25.4174 25.8852 25.2699C26.136 25.1223 26.3439 24.9116 26.488 24.6588C26.6321 24.4059 26.7075 24.1198 26.7067 23.8288C26.7058 23.5377 26.6288 23.252 26.4833 23L19.425 11.2167C19.2764 10.9717 19.0673 10.7693 18.8176 10.6287C18.568 10.4882 18.2864 10.4144 18 10.4144C17.7135 10.4144 17.4319 10.4882 17.1823 10.6287C16.9327 10.7693 16.7235 10.9717 16.575 11.2167V11.2167Z",stroke:s,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,t.jsx)("path",{d:"M18 22.1667H18.0083",stroke:s,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,t.jsx)("path",{d:"M18 15.5V18.8333",stroke:s,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"})]}),(0,t.jsx)("rect",{height:"35",rx:"17.5",stroke:i?"#FEF3C7":"#411D06",width:"35",x:"0.5",y:"0.5"}),(0,t.jsx)("defs",{children:(0,t.jsx)("clipPath",{id:"clip0_798_8667",children:(0,t.jsx)("rect",{fill:"white",height:"20",transform:"translate(8 8)",width:"20"})})})]})}function N(){let{resolvedTheme:e}=(0,w.useTheme)(),i=(0,y.default)(),s=i?"#D00505":"#FCA5A5";return(0,t.jsxs)("svg",{fill:"none",height:"36",opacity:+!!e,viewBox:"0 0 36 36",width:"36",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("rect",{fill:i?"#FEF2F2":"#2A0909",height:"35",rx:"17.5",width:"35",x:"0.5",y:"0.5"}),(0,t.jsx)("path",{d:"M23.8333 10.5H12.1667C11.2462 10.5 10.5 11.2462 10.5 12.1667V23.8333C10.5 24.7538 11.2462 25.5 12.1667 25.5H23.8333C24.7538 25.5 25.5 24.7538 25.5 23.8333V12.1667C25.5 11.2462 24.7538 10.5 23.8333 10.5Z",stroke:s,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,t.jsx)("path",{d:"M15.5 15.5L20.5 20.5",stroke:s,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,t.jsx)("path",{d:"M20.5 15.5L15.5 20.5",stroke:s,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,t.jsx)("rect",{height:"35",rx:"17.5",stroke:i?"#FEE2E2":"#450C0C",width:"35",x:"0.5",y:"0.5"})]})}function E(){let{resolvedTheme:e}=(0,w.useTheme)(),i=(0,y.default)(),s=i?"#666666":"#888888";return(0,t.jsxs)("svg",{fill:"none",height:"36",opacity:+!!e,viewBox:"0 0 36 36",width:"36",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("rect",{fill:i?"#FAFAFA":"#111111",height:"35",rx:"17.5",width:"35",x:"0.5",y:"0.5"}),(0,t.jsxs)("g",{clipPath:"url(#clip0_1415_8585)",children:[(0,t.jsx)("path",{d:"M18 26.3333C22.6024 26.3333 26.3334 22.6024 26.3334 18C26.3334 13.3976 22.6024 9.66666 18 9.66666C13.3976 9.66666 9.66669 13.3976 9.66669 18C9.66669 22.6024 13.3976 26.3333 18 26.3333Z",stroke:s,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,t.jsx)("path",{d:"M18 21.3333V18",stroke:s,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),(0,t.jsx)("path",{d:"M18 14.6667H18.0083",stroke:s,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"})]}),(0,t.jsx)("rect",{height:"35",rx:"17.5",stroke:i?"#EAEAEA":"#333333",width:"35",x:"0.5",y:"0.5"}),(0,t.jsx)("defs",{children:(0,t.jsx)("clipPath",{id:"clip0_1415_8585",children:(0,t.jsx)("rect",{fill:"white",height:"20",transform:"translate(8 8)",width:"20"})})})]})}var M=e.i(6346477);function I(e){return!!e&&e.startsWith("team_")}var L=e.i(5213664),S=e.i(9220646),T=e.i(5223476),P=e.i(8356984),F=e.i(7565790),W=e.i(9670680),O=e.i(5993369),H=e.i(9722978),D=e.i(7171047),G=e.i(9358876),B=e.i(1288475),R=e.i(9031150),z=e.i(6357175),X=e.i(9482244);let J=(e,t)=>t.ts<e.ts||!["stable","shown"].includes(t.type)?e:{...e,[t.type]:t.value,ts:t.ts},V={ts:0,stable:0,shown:0},$=[.1,.3,.5,.6,.8,1].map(function(e){return 1-Math.pow(1-e,3)});var U=e.i(6269588);let q=(0,i.forwardRef)(function(e,n){let{unseen:a,disabled:l,disableMotion:r,children:d,onOpenChange:c,...u}=e,m=(0,o.usePathname)(),h=(0,i.useContext)(_),f=!!h?.hasOpened,{focusProps:x,isFocusVisible:v}=(0,P.useFocusRing)(),{hoverProps:b,isHovered:g}=(0,F.useHover)({isDisabled:l}),p=(0,O.useObjectRef)(n),{isPressed:k}=(0,T.useButton)(u,p),w=(0,j.useIsMobile)(),y=function(e,t){let s=(0,X.usePrefersReducedMotion)(),n=!(t.disableMotion||s),[{stable:a,shown:l},r]=(0,i.useReducer)(J,V);(0,i.useEffect)(()=>{if(n&&(!(a<l)||t.animateDown)){let e=a===l?[]:$.map((e,t)=>{let i=Math.round(l+(a-l)*e);if(i!==a||t===$.length-1)return setTimeout(()=>requestAnimationFrame(()=>r({value:i,type:"shown",ts:Date.now()})),50+100*t)});return()=>{for(let t of e)t&&clearTimeout(t)}}r({value:a,type:"shown",ts:Date.now()})},[a,n]);let o=(0,i.useCallback)(e=>r({type:"stable",ts:Date.now(),value:e}),[r]),d=(0,z.useDebouncedValue)(e,100);return(0,i.useEffect)(()=>{o(Number(d))},[d,o]),l}(a,{disableMotion:r}),A=(0,H.clsx)(U.default.btn,{[U.default.focus]:v,[U.default.hover]:g,[U.default.pressed]:k||f,[U.default.shadow]:!w});return(0,i.useEffect)(()=>{h?.setHasOpened(!1)},[m]),(0,t.jsxs)("div",{children:[h?.hasOpened?(0,t.jsx)("div",{"aria-hidden":!0}):null,(0,t.jsxs)(S.Root,{"aria-label":"Notifications","data-testid":(0,s.tid)("notifications","popover"),onOpenChange:e=>{(0,R.awaitPaint)().then(()=>{h?.setHasOpened(e),c(e)})},open:f,children:[(0,t.jsx)(S.Trigger,{"aria-label":a?`${a} unseen ${(0,G.pluralize)("notification",a)}`:"notifications",...(0,W.mergeProps)(x,b,u),className:A,"data-testid":(0,s.tid)("notifications","bell"),ref:p,children:(0,t.jsxs)("span",{className:U.default.buttonContent,children:[(0,t.jsx)("div",{className:U.default.icon,children:(0,t.jsx)(D.Bell,{className:U.default.svgNoPointerEvents,color:"gray-1000",size:16})}),y>0?(0,t.jsx)(B.Status,{className:U.default.statusIcon,color:"blue-900"}):null]})}),(0,t.jsx)(S.Portal,{children:(0,t.jsx)(S.Content,{align:"end",alignOffset:-10,"aria-label":a?`${a} unseen ${(0,G.pluralize)("notification",a)}`:"notifications",className:U.default.content,sideOffset:10,children:d})})]})]})});var K=e.i(3351853),Z=e.i(313754),Y=e.i(386648),Q=e.i(9138164),ee=e.i(6015702),et=e.i(2155064),ei=e.i(2504781),es=e.i(4237893),en=e.i(3306538),ea=e.i(1492947),el=e.i(57106),er=e.i(5601342),eo=e.i(6817372),ed=e.i(3423911),ec=e.i(7796990),eu=e.i(6036663),em=e.i(9696510),eh=e.i(9563590),ef=e.i(1889129);function ex(e){let{children:i}=e;return(0,t.jsx)(en.Badge,{className:ef.default.tabBadge,size:"sm",variant:"gray-subtle",children:i})}function e_(e){var n,a,r,o,d,c,u,m,h;let{tab:x,setTab:v,settingsLink:b,currentTabEmpty:p,onArchiveAll:k,onScrollEnd:w,children:y,commentsUnread:A=0,commentsIsLoading:C=!1,inboxUnread:N=0,hasNextThread:E,hasPreviousThread:M,clearSelectedThread:I,selectNextThread:L,selectPreviousThread:S,commentsIsStale:T,viewFreshComments:P}=e,{account:F,isLoading:W}=(0,l.useAccount)(),O=(0,er.usePreferences)(),[D,G]=(0,i.useState)(!1),B=(0,j.useIsMobile)(),R=(0,i.useContext)(_),z=(n={debounce:40,offset:7},r=(a=(0,i.useMemo)(function(){var e,t,i,s;return{offset:null!=(e=null==n?void 0:n.offset)?e:0,debounce:null!=(t=null==n?void 0:n.debounce)?t:200,debounceOptions:null!=(i=null==n?void 0:n.debounceOptions)?i:{leading:!0},triggerOnNoScroll:null!=(s=null==n?void 0:n.triggerOnNoScroll)&&s}},[null==n?void 0:n.offset,null==n?void 0:n.debounce,null==n?void 0:n.debounceOptions,null==n?void 0:n.triggerOnNoScroll])).offset,o=a.triggerOnNoScroll,d=a.debounce,c=a.debounceOptions,u=(0,i.useMemo)(function(){return d?(0,K.default)(w,d,c):w},[d,w]),m=(0,i.useRef)(null),h=(0,i.useCallback)(function(){if(null!=m.current){var e=m.current,t=Math.round(e.scrollTop+e.clientHeight);Math.round(e.scrollHeight-r)<=t&&u()}else{var i=document.scrollingElement||document.documentElement,s=Math.round(i.scrollTop+window.innerHeight);Math.round(i.scrollHeight-r)<=s&&u()}},[r,w,m.current]),(0,i.useEffect)(function(){var e=m.current;return null!=e?e.addEventListener("scroll",h):window.addEventListener("scroll",h),o&&h(),function(){null!=e?e.removeEventListener("scroll",h):window.removeEventListener("scroll",h)}},[h,d]),m),{filterValues:X,hasSelectedFilters:J}=(0,f.useCommentFilters)(),V=J(),$=X.q[0];(0,i.useEffect)(()=>{let e=O.isChannelEnabled("in_app_feed");e||D?e&&D&&G(!1):G(!0)},[O,D]);let U=(0,eo.useCommentsViewEnabled)("enable-comments-notifications-view"),q=(0,i.useMemo)(()=>[{title:(0,t.jsxs)(ep,{children:["Inbox ",N>0?(0,t.jsx)(ex,{children:N}):null]}),value:"inbox"},{title:(0,t.jsx)(ep,{children:"Archive"}),value:"archived"}],[N]),Z=(0,i.useMemo)(()=>U?[...q,{title:(0,t.jsxs)(ep,{children:["Comments"," ",A>0?(0,t.jsx)(ex,{children:A}):null]}),value:"comments"}]:q,[U,q,A]),Y=(0,i.useMemo)(()=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(es.Tabs,{border:!1,"data-testid":(0,s.tid)("notifications","tabs"),selected:x,setSelected:v,tabs:Z}),(0,t.jsx)(eg,{...b,onClick:()=>{R?.setHasOpened(!1)}})]}),[R,v,b,x,Z]),Q=null;if(D&&"inbox"===x)Q=(0,t.jsx)(eb,{onEnable:()=>{O.setChannel({channels:["in_app_feed"],enabled:!0})}});else if(p){let e;"comments"===x&&!C&&($?e=`No comments found for "${$}".`:V?e="No comments found with the selected filters.":W||F?.enablePreviewFeedback!=="off"||(e="Enable comments on your Preview Deployments to view them here.")),Q=(0,t.jsx)(ev,{label:e,tab:x})}let{thread:ee}=(0,g.useSelectedComment)(),et=(0,t.jsxs)("div",{className:ef.default.feed,"data-tab":x,children:[(0,t.jsx)("div",{className:ef.default.headerGrid,children:ee?(0,t.jsx)(eu.CommentDetailHeader,{clearSelectedThread:I,forceShowBackButton:!0,hasNext:E,hasPrevious:M,selectNextThread:L,selectPreviousThread:S,showContextMenu:!1,showLinearLink:!1,showPreviewLink:!1,thread:ee,className:"flex-1"}):Y}),(0,t.jsxs)("div",{className:ef.default.feedContent,"data-empty":Q?"":null,ref:z,children:[ee?y:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:["comments"===x?(0,t.jsxs)("div",{className:(0,H.clsx)("flex flex-col items-stretch justify-start gap-2 flex-initial pt-4",p?"absolute inset-x-0 top-0":void 0),children:[(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-3 flex-initial px-4",children:[(0,t.jsx)(em.CommentsSearch,{loading:C,size:"small"}),(0,t.jsx)(ed.FilterMenu,{buttonSize:"small"})]}),(0,t.jsx)(ec.ClearFilters,{buttonSize:"small",className:"px-4"})]}):null,(0,t.jsx)("ol",{className:(0,H.clsx)(ef.default.view,{[ef.default.commentsView]:"comments"===x}),"data-empty":Q?"":null,"data-tab":x,children:Q||y})]}),"comments"===x&&T?(0,t.jsx)(eh.CommentsStaleButton,{onClick:P}):null]}),"inbox"===x&&!Q&&(0,t.jsx)("div",{className:ef.default.archiveFooter,children:(0,t.jsx)(ei.Button,{"data-testid":(0,s.tid)("notifications","archive-all"),onClick:()=>k(),size:"small",type:"tertiary",children:"Archive All"})})]});return B?(0,t.jsx)(ea.Drawer,{onDismiss:()=>{R?.setHasOpened(!1)},show:R?.hasOpened,children:et}):et}function ev(e){let{tab:i,label:n}=e,a="No new notifications";"archived"===i?a="Nothing in the archive":"comments"===i&&(a="No new comments");let l=(0,t.jsx)(Z.Inbox,{"aria-label":"Empty inbox",color:"gray-700",size:20});return"archived"===i?l=(0,t.jsx)(et.Archive,{"aria-label":"Empty archive",color:"gray-700",size:20}):"comments"===i&&(l=(0,t.jsx)(ee.Message,{"aria-label":"Empty inbox",color:"gray-700",size:20})),(0,t.jsx)("li",{"data-testid":(0,s.tid)("notifications","inbox-zero"),className:"flex flex-col items-center justify-center flex-initial",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-start gap-3 flex-initial",children:[(0,t.jsx)("div",{className:ef.default.emptyIcon,children:l}),(0,t.jsx)("p",{className:`text-copy-14 text-gray-900 text-center ${ef.default.emptyLabel}`,children:n??a})]})})}function eb(e){let{onEnable:i}=e;return(0,t.jsx)("li",{"data-testid":(0,s.tid)("notifications","inbox-zero"),className:"flex flex-col items-center justify-center flex-initial",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-start gap-5 flex-initial",children:[(0,t.jsx)("div",{className:ef.default.emptyIcon,children:(0,t.jsx)(Y.BellOff,{color:"gray-700",size:20})}),(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"You currently have notifications turned off"}),(0,t.jsx)(ei.Button,{"data-testid":(0,s.tid)("notifications","turn-on"),onClick:i,size:"small",children:"Turn on notifications"})]})})}function eg(e){let{as:i,href:n,onClick:a}=e,{focusProps:l,isFocused:r,isFocusVisible:o}=(0,P.useFocusRing)(),{hoverProps:d,isHovered:c}=(0,F.useHover)({});return(0,t.jsx)(el.Link,{"aria-label":"Settings",as:i,className:ef.default.settingsLink,"data-focus-visible":o?"":null,"data-hover":c?"":null,"data-testid":(0,s.tid)("notifications","settings"),href:n,onClick:a,...l,...d,children:(0,t.jsx)("span",{"aria-hidden":!0,style:{height:16},children:(0,t.jsx)(Q.SettingsGear,{color:c||r?"gray-1000":"gray-700"})})})}function ep(e){let{children:i}=e;return(0,t.jsx)("p",{className:`text-copy-14 text-inherit ${ef.default.tabText}`,children:i})}var ej=e.i(7218483),ek=e.i(6241262);function ew(e){let{isMobile:n,notification:a,archiveNotification:l,readNotification:r}=e,[o,d]=(0,i.useState)(!1),{isHovered:c,hoverProps:u}=(0,F.useHover)({}),{isHovered:m,hoverProps:h}=(0,F.useHover)({}),{isFocusVisible:f,focusProps:x}=(0,P.useFocusRing)({within:!0}),_=c||o||n,{id:v,mainAvatar:b,subAvatar:g,actionUrl:p,ts:j,markup:k,isArchived:w,isSeen:y,workflow:A}=a,C=(0,t.jsxs)("li",{"data-testid":(0,s.tid)("notifications","item",v),...u,...x,className:(0,H.clsx)("flex flex-row items-stretch justify-between gap-4 flex-initial",ek.default.item,{[ek.default.focusVisible]:f}),children:[(0,t.jsxs)("span",{className:ek.default.subject,children:[(0,t.jsx)("span",{children:b}),g?(0,t.jsx)("span",{className:ek.default.subAvatar,children:g}):null]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-1",children:[k,(0,t.jsx)(ey,{ts:j})]}),(0,t.jsxs)("div",{"aria-hidden":w?"true":void 0,className:(0,H.clsx)({[ek.default.hidden]:w}),style:{position:"relative",width:32},children:[(0,t.jsx)("div",{className:(0,H.clsx)("flex flex-col items-center justify-center flex-initial",ek.default.dot,{[ek.default.hidden]:y}),style:{left:_?-24:0},children:(0,t.jsx)("div",{"aria-label":"Not seen yet",role:"note"})}),(0,t.jsx)("div",{className:ek.default.archive,style:{opacity:_||f?1:0},...h,children:(0,t.jsx)(ei.Button,{"aria-label":"Archive",className:ek.default.archiveButton,onBlur:()=>d(!1),onFocus:()=>d(!0),passthroughOnClick:e=>{e.preventDefault(),l(A)},shape:"circle",style:{width:32,height:32},svgOnly:!0,title:"Archive",type:"tertiary",children:(0,t.jsx)(et.Archive,{"aria-hidden":"true",color:m||f?"gray-1000":"gray-700"})})})]})]});return p?(0,t.jsx)(el.Link,{"aria-roledescription":`${w?"Archived":y?"Previously seen":"Unseen"} Notification`,className:ek.default.link,"data-inbox":!w,"data-uid":v,href:p,onClick:()=>{r(A)},children:C}):C}function ey(e){let{ts:i}=e,s=(0,ej.useAgo)(i);return(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",title:new Date(i).toLocaleString(),children:[(0,t.jsx)("span",{className:"geist-sr-only",children:", Created "}),s]})}var eA=e.i(4630293),eC=e.i(8719659),eN=e.i(8698247);function eE(e){let{thread:i}=e,{selectThread:s,thread:n}=(0,g.useSelectedComment)(),a=(0,eC.useUpdateComment)(),{team:l}=(0,p.useTeam)();return(0,t.jsx)("li",{children:(0,t.jsx)("button",{className:(0,H.clsx)(eN.default.commentWrapper,{[eN.default.selected]:n?.id===i.id}),onClick:()=>{s(i),i.read||a({threadId:i.id,roomId:i.roomId,read:!0,teamId:l?.id})},type:"button",children:(0,t.jsx)(eA.CommentsListItem,{showMetadata:!1,thread:i,className:"p-4"})})})}var eM=e.i(2977232),eI=e.i(7017723);function eL(e){let{activeFeed:s,inbox:n,comments:l,tab:r,setTab:o,hasOpened:d,setHasOpened:c,settingsLink:m}=e,{team:h}=(0,p.useTeam)(),f=(0,j.useIsMobile)(),x=(0,eI.useIsImpersonating)(),[_,v]=(0,i.useState)({}),b=(0,i.useCallback)(()=>{v(Object.fromEntries(s.items.map(e=>[e.id,function(e,i,s){var n,a;let l,r,o,d=(l=[],r=(a=e).actors,(o=a.data?.icon)&&l.push({level:"primary",icon:o}),a.actors.length&&null!==r[0]&&l.push({level:"primary",id:r[0].id,avatar:r[0].avatar}),a.data?.focus&&!l.find(e=>"primary"===e.level)&&l.push({level:"primary",id:a.data.focus.id,avatar:a.data.focus.avatar}),l),c=e.blocks.find(e=>"body"===e.name),u=e.blocks.find(e=>"action_url"===e.name),m=u?.rendered??"";try{let e=new URL(m);e.searchParams.set("utm_medium","web"),e.searchParams.set("utm_source","notifications"),m=e.href}catch(e){}return{id:e.id,workflow:e.source.key,mainAvatar:function(e,i){let s=e.find(e=>"primary"===e.level);if(!s)return i?(0,t.jsx)(k.Avatar,{hash:i.avatar,size:36,teamId:i.id}):null;let{id:n,icon:a,avatar:l}=s;if(a){switch(a){case"alert":return(0,t.jsx)(N,{});case"warn":return(0,t.jsx)(C,{});case"success":return(0,t.jsx)(A,{});case"info":return(0,t.jsx)(E,{})}return}return I(n)?(0,t.jsx)(k.Avatar,{hash:l,size:36,teamId:n}):(0,t.jsx)(k.Avatar,{hash:l,size:36,uid:n})}(d,s),subAvatar:function(e,i){let s=e.find(e=>"secondary"===e.level);if(!s||i.hasIcon)return null;let{id:n,avatar:a}=s;return I(n)?(0,t.jsx)(k.Avatar,{hash:a,size:20,teamId:n}):(0,t.jsx)(k.Avatar,{hash:a,size:20,uid:n})}(d,{hasIcon:!!e.data?.icon}),icon:e.data?.icon,isSeen:!!e.seen_at,isArchived:!!e.archived_at,markup:c?(0,t.jsx)("div",{className:i,dangerouslySetInnerHTML:{__html:(n=c.rendered,M.default.sanitize(n))}}):(0,t.jsx)("div",{className:i}),ts:new Date(e.inserted_at).getTime(),actionUrl:m}}(e,ek.default.notificationContent,h)])))},[s.items,h]);(0,i.useEffect)(()=>{d&&b()},[d,s.items]);let w=(0,i.useMemo)(()=>l.threads.map(e=>(0,t.jsx)(eE,{thread:e},e.id)),[l.threads]),{thread:y,clearSelectedThread:S,selectThread:T}=(0,g.useSelectedComment)(),P=(0,i.useCallback)(e=>{if(0===n.items.length?o("comments"):o("inbox"),e){var t;c(!0),a.analytics.track(u.AnalyticsEvent.NOTIFICATIONS_SHOWN,{shownCount:n.unseen,isCountShown:n.unseen>0,shownGroup:0===(t=n.unseen)?"g0":t<=+Number(16)?"g1":t<=2*Number(16)?"g2":t<=3*Number(16)?"g3":t<=4*Number(16)?"g4":"gx"})}else S(),x||n.markAllSeen()},[S,x,o,n,c]),F=(0,i.useCallback)(()=>{x||n.markAllArchived()},[n,x]),W=(0,i.useMemo)(()=>"comments"===r?l.isEmpty:0===s.items.length,[r,s.items,l.isEmpty]),O=(0,i.useCallback)(()=>{if(!y)return;let e=l.threads.findIndex(e=>e.id===y.id);-1===e||e===l.threads.length-1||T(l.threads[e+1])},[l.threads,T,y]),H=(0,i.useCallback)(()=>{if(!y)return;let e=l.threads.findIndex(e=>e.id===y.id);-1===e||0===e||T(l.threads[e-1])},[l.threads,T,y]),D=(0,i.useMemo)(()=>{if(!y)return!1;let e=l.threads.findIndex(e=>e.id===y.id);return -1!==e&&e!==l.threads.length-1},[l.threads,y]),G=(0,i.useMemo)(()=>{if(!y)return!1;let e=l.threads.findIndex(e=>e.id===y.id);return -1!==e&&0!==e},[l.threads,y]);return(0,t.jsx)(q,{onOpenChange:P,unseen:n.unseen+l.unreadCount,children:(0,t.jsx)(er.PreferencesProvider,{defaultLoaded:!0,children:(0,t.jsx)(e_,{clearSelectedThread:S,commentsIsLoading:l.isLoading,commentsIsStale:l.isStale,commentsUnread:l.unreadCount,currentTabEmpty:W,hasNextThread:D,hasPreviousThread:G,inboxUnread:n.unseen,onArchiveAll:F,onScrollEnd:s.fetchNextPage,selectNextThread:O,selectPreviousThread:H,setTab:o,settingsLink:m,tab:r,viewFreshComments:l.viewFreshData,children:"comments"===r?(0,t.jsx)(t.Fragment,{children:y?(0,t.jsx)(L.Comments,{className:eM.default.commentsDetailView,source:"dashboard-notifications-center",thread:y}):w}):s.items.map(e=>_[e.id]?(0,t.jsx)(eS,{archiveItem:n.archiveItem,impersonationMode:x,isMobile:f,item:e,presentation:_[e.id],readItem:n.readItem},`${r}-${e.id}`):null)})})})}function eS(e){let{item:s,presentation:n,readItem:a,archiveItem:l,isMobile:r,impersonationMode:o}=e,d=(0,i.useCallback)(e=>{o||l(s,e)},[l,o,s]),c=(0,i.useCallback)(e=>{o||a(s,e)},[o,a,s]);return(0,t.jsx)(ew,{archiveNotification:d,isMobile:r,notification:n,readNotification:c})}var eT=e.i(1110704);function eP(e){let{children:i}=e,s=b();return"full"!==s.state?i:(0,t.jsx)(f.CommentFilterContextProvider,{type:"modal",children:(0,t.jsx)(g.SelectedCommentContextProvider,{children:(0,t.jsx)(eF,{tenant:s.tenant,children:i})})})}function eF(e){let{children:s,tenant:r}=e,o=function(e){let{tenant:t}=e,s=(0,i.useRef)(0),r=b(),{account:o,user:d,team:_}=(0,l.useAccount)(),{token:g}=(0,m.useKnockToken)({}),[p,j]=(0,i.useState)(!1),[k,w]=(0,i.useState)("inbox");if(!d)throw Error("User not available");let y=v.exec(d.email)?"vtest314":d.uid,A=function(e){let{feed:t,items:s,metadata:n,loading:l,onArchiveAll:r,markAsArchived:o,markAllAsArchived:d}=e,c=(0,i.useRef)(!1);(0,i.useEffect)(()=>{c.current||(c.current=!0,t.fetch())},[t]);let m=(0,i.useCallback)(()=>{let e=s.filter(e=>null===e.seen_at);if(0!==e.length)return t.markAsSeen(e)},[t,s]),h=(0,i.useCallback)(()=>{d(),r()},[r,d]),f=(0,i.useCallback)(async(e,t)=>{let i=Date.now(),s=new Date(e.inserted_at).getTime();a.analytics.track(u.AnalyticsEvent.NOTIFICATIONS_ENGAGEMENT,{uid:e.id,workflow:t??"none",action:"archive",messageTs:s,actionTs:i,timeToAction:i-s}),await o(e)},[o]),x=(0,i.useCallback)(async(e,i)=>{let s=Date.now(),n=new Date(e.inserted_at).getTime();a.analytics.track(u.AnalyticsEvent.NOTIFICATIONS_ENGAGEMENT,{uid:e.id,workflow:i??"none",action:"read",messageTs:n,actionTs:s,timeToAction:s-n}),await t.markAsSeen(e).then(()=>t.markAsRead(e))},[t]),_=(0,i.useCallback)(()=>{s.length<n.total_count&&t.fetchNextPage()},[s.length,n.total_count,t]);return{items:s,loading:l,unseen:n.unseen_count,archiveItem:f,readItem:x,markAllSeen:m,markAllArchived:h,fetchNextPage:_}}({onArchiveAll:()=>{s.current=Date.now()},...c({tab:"inbox",userToken:g,userId:y,tenant:t})}),C=function(e){let{fetchEnabled:t,feed:s,items:n,metadata:a,loading:l}=e,[r,o]=(0,i.useState)(!1);(0,i.useEffect)(()=>{t&&!r&&(s.fetch(),o(!0))},[t,s,n,r]);let d=(0,i.useCallback)(()=>{n.length<a.total_count&&s.fetchNextPage()},[n.length,a.total_count,s]);return{loading:l,items:n,fetchNextPage:d,feed:s}}({fetchEnabled:p,...c({tab:"archived",userToken:g,userId:y,tenant:t})}),{filterValues:N}=(0,f.useCommentFilters)(),E="resolved"===N.status[0]||"unresolved"===N.status[0]?N.status[0]:void 0,M=(0,x.getIfNotEmpty)(N.q),I=(0,x.getIfNotEmpty)(N.project),L=(0,x.getIfNotEmpty)(N.author),S=(0,x.getIfNotEmpty)(N.page),T=(0,x.getIfNotEmpty)(N.pageRegex),P=(0,x.getIfNotEmpty)(N.branch),F=(0,h.useToolbarComments)({type:"inbox",q:M&&M[0].length>0?M[0]:void 0,teamId:_?.id,status:E,projectId:I,author:L,page:S,pageGlob:T,branch:P,limit:20,searchHeaderOnly:1}),W=(0,i.useCallback)(()=>C.feed.fetch(),[C.feed]);(0,i.useEffect)(()=>{"archived"===k&&Date.now()-s.current<3e4&&W()},[k,W]);let O={as:_?.slug?`/${_.slug}/~/settings/notifications`:"/account/notifications",href:_?.slug?"/teams/[teamSlug]/settings/notifications":"/account/notifications"},H="inbox"===k?A:C,D=(0,i.useCallback)(e=>{w(e),a.analytics.track(n.VercelSpecificAnalyticsEvent.NOTIFICATIONS_TAB_CHANGE,{tab:k,teamId:_?.id,commentsEnabled:o?.enablePreviewFeedback!=="off"})},[k,_?.id,o?.enablePreviewFeedback]);return{visibility:r,hasOpened:p,setHasOpened:j,tab:k,setTab:D,inbox:A,archive:C,comments:F,settingsLink:O,activeFeed:H}}({tenant:r});return(0,t.jsx)(_.Provider,{value:o,children:s})}function eW(){let e=b(),s=(0,i.useContext)(_);return e.isLoading?(0,t.jsx)(eT.PlaceholderBell,{visibility:e.state}):null===e.state?null:s?(0,t.jsx)(eL,{...s}):(0,t.jsx)(eT.PlaceholderBell,{visibility:e.state})}function eO(){return(0,t.jsx)(eP,{children:(0,t.jsx)(eW,{})})}(0,s.markLoadedForTest)("notifications"),e.s(["NotificationsProviderAndPopover",()=>eO],6561189)},4100285,e=>{e.n(e.i(6561189))}]);

//# debugId=eee4cdb3-83f2-d851-dc0f-00bb80c83f9f
//# sourceMappingURL=0dab241955bbbfb9.js.map