;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="0189be03-d1f6-5e4b-87bc-ba861c7a89c6")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,5714908,e=>{e.v({header:"leave-modal-module__I3nMuG__header"})},9981323,e=>{e.v({accessGroupEntity:"project-members-table-module__O6bDqq__accessGroupEntity",memberEntity:"project-members-table-module__O6bDqq__memberEntity",summaryEntity:"project-members-table-module__O6bDqq__summaryEntity"})},7686828,e=>{e.v({empty:"access-module__63i2AW__empty"})},3070180,e=>{"use strict";var s=e.i(1146226),t=e.i(1991452),i=e.i(9318197),a=e.i(57106),l=e.i(1000921),r=e.i(5338940),n=e.i(7750276),o=e.i(8994597),c=e.i(5169864),d=e.i(8249095),m=e.i(5585544),u=e.i(4585051),x=e.i(7609806),h=e.i(2504781),j=e.i(3869281),p=e.i(6870754),f=e.i(8459493),b=e.i(5323212),y=e.i(5255926),g=e.i(5468328),v=e.i(455575),M=e.i(8248823),C=e.i(9358876),E=e.i(8042625),w=e.i(277234),A=e.i(4244280),N=e.i(1717203),P=e.i(7557283),R=e.i(9771394),T=e.i(8970683),S=e.i(2530776),I=e.i(8835183),k=e.i(5819220),L=e.i(979715),O=e.i(4712634),_=e.i(9338892),z=e.i(951125),G=e.i(681883),D=e.i(6060673),B=e.i(4844919),$=e.i(2699603),U=e.i(8587921),V=e.i(8786464),F=e.i(3069824);let H=(0,e.i(9334638).withNewIcon)('<path fill-rule="evenodd" clip-rule="evenodd" d="M5.75 0C3.95507 0 2.5 1.45507 2.5 3.25V3.75C2.5 5.54493 3.95507 7 5.75 7H6.25C8.04493 7 9.5 5.54493 9.5 3.75V3.25C9.5 1.45507 8.04493 0 6.25 0H5.75ZM4 3.25C4 2.2835 4.7835 1.5 5.75 1.5H6.25C7.2165 1.5 8 2.2835 8 3.25V3.75C8 4.7165 7.2165 5.5 6.25 5.5H5.75C4.7835 5.5 4 4.7165 4 3.75V3.25ZM10.5 5.75H15.5V7.25H10.5V5.75ZM1.5 13.1709V14.5H10.5V13.1709C9.68042 11.5377 8.00692 10.5 6.17055 10.5H5.82945C3.99308 10.5 2.31958 11.5377 1.5 13.1709ZM0.0690305 12.6857C1.10604 10.4388 3.35483 9 5.82945 9H6.17055C8.64517 9 10.894 10.4388 11.931 12.6857L12 12.8353V13V15.25V16H11.25H0.75H0V15.25V13V12.8353L0.0690305 12.6857Z" fill="currentColor"/>');var q=e.i(2988836),J=e.i(5140444),Z=e.i(2720056),W=e.i(1521964);function Y(){return(0,s.jsxs)(s.Fragment,{children:["Additional permissions are required to manage Project Members."," ",(0,s.jsx)(a.Link,{href:"/docs/accounts/team-members-and-roles",variant:"highlight",children:"Learn More →"})]})}var K=e.i(4030453),Q=e.i(6891161),X=e.i(5714908);function ee(e){let{active:a,setActive:l}=e,n=(0,t.useRouter)(),{user:o}=(0,J.useUser)(),{team:d}=(0,r.useTeam)(),m=(0,v.useToasts)(),[u,x]=(0,c.useState)(!1),[h,j]=(0,c.useState)(null),{project:p}=n.query,{data:f}=(0,D.useProject)(p),[{mutate:b}]=(0,G.useProjectMembersInfinite)(),y=()=>{l(!1)};return(0,s.jsxs)(Q.Modal.Modal,{active:a,onAnimationDone:()=>{j(null)},onClickOutside:y,width:"500px",children:[(0,s.jsxs)(Q.Modal.Body,{children:[(0,s.jsxs)("header",{className:X.default.header,children:[(0,s.jsx)("h2",{className:"text-copy-16",children:"Remove Project Member"}),(0,s.jsxs)("p",{className:"text-copy-14",children:["You are about to remove yourself from the project"," ",(0,s.jsx)("b",{children:f?.name}),"."]}),(0,s.jsx)("p",{className:"text-copy-14",children:"Are you sure you want to continue?"})]}),h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Spacer,{y:.5}),(0,s.jsx)(K.Error,{error:h})]}):null]}),(0,s.jsxs)(Q.Modal.Actions,{children:[(0,s.jsx)(Q.Modal.Action,{onClick:y,type:"secondary",children:"Cancel"}),(0,s.jsx)(Q.Modal.Action,{loading:u,onClick:async()=>{if(d&&o&&f){x(!0);try{await (0,w.fetchAPI)(`${(0,A.API_PROJECTS_MEMBERS)(f.id)}/${o.uid}${(0,E.encode)({teamId:d.id})}`,{throwOnHTTPError:!0,method:"DELETE"}),await b(),m.success("You have successfully removed yourself from the Project."),x(!1),l(!1),n.push(`/${d.slug}`)}catch(e){j((0,M.normalizeError)(e)),x(!1)}}},children:"Confirm"})]})]})}var es=e.i(9981323);function et(e){let{projectMember:t,teamMember:i,selected:a,setSelected:l,remove:r,onManageTeamAccess:n,onManageProjectAccess:o,canUpdateProjectMember:d,canDeleteProjectMember:m,project:x}=e,{user:p}=(0,J.useUser)(),b=(0,R.usePlaceholder)(),y=t.uid===p?.uid,v=t.name||t.username||"",[M,C]=(0,c.useState)(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(k.Entity,{checkbox:(0,s.jsx)(g.Tooltip,{delayTime:300,disableTriggers:m,position:"bottom",text:(0,s.jsx)(Y,{}),children:(0,s.jsx)(j.Checkbox,{checked:!!a[t.uid||""],disabled:!m,onChange:()=>l(e=>{if(!t.uid)return e;let s={...e};return s[t.uid]?delete s[t.uid]:s[t.uid]=!0,s})})}),className:es.default.memberEntity,disabledDotMenuTooltip:(0,s.jsx)(Y,{}),isDotMenuDisabled:!m,menuItems:(0,s.jsxs)(s.Fragment,{children:[y?null:(0,s.jsx)(g.Tooltip,{disableTriggers:m,position:"bottom",style:{display:"inline-flex"},text:(0,s.jsx)(Y,{}),children:(0,s.jsx)(f.MenuItem,{disabled:!d,onClick:()=>n(),children:(0,s.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial px-1",children:[(0,s.jsx)(F.UserSettings,{}),"Manage Team Member"]})})}),(0,s.jsx)(g.Tooltip,{disableTriggers:m,position:"bottom",style:{display:"inline-flex"},text:(0,s.jsx)(Y,{}),children:y?(0,s.jsx)(f.MenuItem,{disabled:!m,onClick:()=>C(!0),type:"error",children:(0,s.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial px-1",children:[(0,s.jsx)(H,{}),"Remove Project Access"]})}):(0,s.jsx)(f.MenuItem,{disabled:!m,onClick:()=>r([t]),type:"error",children:(0,s.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial px-1",children:[(0,s.jsx)(H,{}),"Remove Project Access"]})})})]}),placeholder:b,thumbnail:(0,s.jsx)(O.EntityThumbnail,{size:32,children:(0,s.jsx)(u.Avatar,{size:32,username:t.username})}),children:[(0,s.jsx)(L.EntityField,{description:t.email,title:(0,s.jsx)("span",{className:"geist-inline-center",children:(0,s.jsx)("span",{className:"geist-ellipsis",children:v})})}),(0,s.jsxs)("div",{className:"flex flex-col items-start gap-4 pt-4 md:flex-row md:items-center md:pt-0",children:[(0,s.jsxs)("div",{className:"flex flex-1 items-center gap-1",children:[i?(0,s.jsx)(W.ProjectAccessBadges,{config:{expanded:!0},projectAccess:{accessGroups:i.accessGroups}}):null,(0,s.jsxs)(g.Tooltip,{text:(0,s.jsx)("div",{className:"tailwind-preflight",children:(0,s.jsxs)("div",{className:"flex flex-col gap-1 text-left",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-heading-14",children:"Role"}),ei[t.computedProjectRole]]}),t.computedProjectRole!==t.role&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-heading-14",children:"Directly Assigned"}),(0,s.jsx)("p",{className:"text-copy-14",children:ei[t.role]})]})]})}),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(Z.ProjectAvatar,{project:x,size:16}),(0,s.jsx)("p",{className:"text-copy-14 text-gray-900",children:ei[t.computedProjectRole]})]}),(0,s.jsx)(q.InformationFillSmall,{color:"gray-900",size:16})]})]}),(0,s.jsx)(h.Button,{onClick:o,size:"small",type:"secondary",children:"Manage Access"})]})]}),(0,s.jsx)(ee,{active:M,setActive:C})]})}let ei={PROJECT_VIEWER:"Viewer",PROJECT_DEVELOPER:"Developer",ADMIN:"Admin"};var ea=e.i(2064047),el=e.i(8615377);function er(e){let{active:a,setActive:l,members:n,onRemoved:o}=e,[d,m]=(0,c.useState)(null),[x,h]=(0,c.useState)(!1),j=(0,v.useToasts)(),{project:p}=(0,t.useRouter)().query,{data:f}=(0,D.useProject)(p),[{mutate:b}]=(0,G.useProjectMembersInfinite)(),{team:y}=(0,r.useTeam)();async function g(){if(f){h(!0);try{await (0,w.fetchAPI)(`${(0,A.API_PROJECTS_MEMBERS)(f.id)}/batch${(0,E.encode)({teamId:y?.id})}`,{method:"DELETE",body:{members:n.map(e=>e.uid)},throwOnHTTPError:!0}),await b(),j.success(`Removed ${(0,C.pluralize)("user",n.length)} from the Project successfully.`),l(!1),o?.()}catch(e){m((0,M.normalizeError)(e))}h(!1)}}return(0,s.jsxs)(Q.Modal.Modal,{active:a,onAnimationDone:()=>{h(!1),m(null)},onClickOutside:()=>l(!1),children:[(0,s.jsxs)(Q.Modal.Body,{children:[(0,s.jsxs)(Q.Modal.Title,{children:["Remove Project Member",n.length>1?"s":""]}),(0,s.jsx)(i.Spacer,{y:.5}),(0,s.jsxs)(Q.Modal.Subtitle,{children:["You are about to remove the following Project Member",n.length>1?"s":"",".",(0,s.jsx)(i.Spacer,{y:.5}),"Are you sure you want to continue?"]}),(0,s.jsx)(i.Spacer,{}),(0,s.jsx)(ea.Entity.List,{children:n.map(e=>(0,s.jsx)(ea.Entity,{left:(0,s.jsx)(u.Avatar,{size:32,username:e.username}),right:(0,s.jsx)(ea.Entity.Content,{description:el.projectRoles.find(s=>s.role===e.role)?.label}),children:(0,s.jsx)(ea.Entity.Content,{description:e.email||"",title:e.name||e.username})},e.username))}),d?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Spacer,{}),(0,s.jsx)(K.Error,{error:d})]}):null]}),(0,s.jsxs)(Q.Modal.Actions,{children:[(0,s.jsx)(Q.Modal.Action,{onClick:()=>l(!1),type:"secondary",children:"Cancel"}),(0,s.jsx)(Q.Modal.Action,{loading:x,onClick:g,children:"Confirm"})]})]})}var en=e.i(7686828),eo=e.i(9722978);function ec(e){let{search:t}=e;return(0,s.jsxs)("div",{className:(0,eo.default)("flex flex-col items-center justify-center gap-2 flex-initial",en.default.empty),children:[(0,s.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:"No Results Found"}),(0,s.jsxs)("p",{className:"text-copy-14 text-gray-900 text-center",children:['Your search for "',t,'" did not return any results.']}),(0,s.jsx)(i.Spacer,{})]})}var ed=e.i(5883567),em=e.i(3671642),eu=e.i(8432052),ex=e.i(8129674),eh=e.i(8384463),ej=e.i(6734680);function ep(e){let{active:a,setActive:l,members:n,onAdded:o,revalidateData:d}=e,[x,h]=(0,c.useState)(null),[j,p]=(0,c.useState)(!1),{project:f}=(0,t.useRouter)().query,{data:b}=(0,D.useProject)(f),{team:y}=(0,r.useTeam)(),g=n.filter(e=>!!e.id);async function v(){if(b&&y){try{h(null),p(!0);let e=(0,w.fetchAPI)(`${(0,A.API_PROJECTS_MEMBERS)(b.id)}/batch${(0,E.encode)({teamId:y.id})}`,{method:"POST",body:{members:g.filter(e=>"email"!==e.type).map(e=>({..."member"===e.type?{uid:e.id}:{accessGroupId:e.id},role:e.role}))},throwOnHTTPError:!0}),s=await Promise.allSettled([e,...g.filter(e=>"email"===e.type&&(0,ej.default)(e.id)).map(async e=>(0,w.fetchAPI)(`${A.API_TEAMS_MEMBERS}/${y.id}/members`,{method:"POST",body:JSON.stringify({email:e.email,role:e.teamRole,projects:[{projectId:b.id,role:e.role}]}),throwOnHTTPError:!0}))]);await d(),s.forEach(e=>{if("rejected"===e.status)throw e.reason}),l(!1),o?.()}catch(e){h((0,M.normalizeError)(e))}p(!1)}}return(0,s.jsxs)(Q.Modal.Modal,{active:a,onAnimationDone:()=>{p(!1),h(null)},onClickOutside:()=>l(!1),children:[(0,s.jsxs)(Q.Modal.Body,{children:[(0,s.jsx)(Q.Modal.Title,{children:"Assign Project Role"}),(0,s.jsx)(i.Spacer,{y:.5}),(0,s.jsxs)(Q.Modal.Subtitle,{children:["You are about to add the following team members, access groups or emails to the ",(0,s.jsx)("b",{children:b?.name})," Project.",(0,s.jsx)(i.Spacer,{y:.5}),"Invited users will be assigned the Contributor role once they join the team. Invites can be managed from the team settings page.",(0,s.jsx)(i.Spacer,{y:.5}),"Are you sure you want to continue?"]}),(0,s.jsx)(i.Spacer,{}),(0,s.jsx)(ea.Entity.List,{className:"tailwind-preflight",children:g.map(e=>(0,s.jsx)(ea.Entity,{left:(0,s.jsx)("div",{className:"flex flex-row items-stretch justify-center gap-2 flex-initial truncate",children:(0,s.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:["member"===e.type?(0,s.jsx)(u.Avatar,{hash:e.avatar,size:24}):(0,s.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial pl-1 w-6",children:"email"===e.type?(0,s.jsx)(eh.UserPlus,{size:"16"}):(0,s.jsx)(m.Users,{size:"16"})}),e.name]})}),right:el.projectRoles.find(s=>s.role===e.role)?.label},e.id))}),x?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Spacer,{}),(0,s.jsx)(K.Error,{error:x})]}):null]}),(0,s.jsxs)(Q.Modal.Actions,{children:[(0,s.jsx)(Q.Modal.Action,{onClick:()=>l(!1),type:"secondary",children:"Cancel"}),(0,s.jsx)(Q.Modal.Action,{loading:j,onClick:v,children:"Add"})]})]})}var ef=e.i(3306538),eb=e.i(6881349),ey=e.i(8735244),eg=e.i(1235157),ev=e.i(162825);function eM(e){let{alreadySelected:t,project:i,onClear:a,onMemberChange:l}=e,r=(0,c.useRef)(new Map),[n,o]=(0,c.useState)(void 0),[d,x]=(0,c.useState)(""),[h,j]=(0,U.useMembersInfinite)({},{search:d||void 0,limit:10,eligibleMembersForProjectId:d?void 0:i?.id,sort:"name_asc"}),{accessGroups:p,isLoading:f}=(0,$.useAccessGroups)({limit:100}),{isLoading:b,can:y}=(0,N.default)(),g=y(P.Action.Update,P.Resource.AccessGroup),v=!b&&g,M=j.members.filter(e=>e.confirmed).map(e=>{let s={id:e.uid,type:"member",name:e.name||e.username,email:e.email,avatar:e.avatar,role:e.role,hasAccess:t.includes(e.uid)||"CONTRIBUTOR"!==e.role&&"DEVELOPER"!==e.role,badge:eg.rolesMeta[e.role].label};return r.current.set(s.id,s),s}),C=v&&p?p.filter(e=>!t.includes(e.accessGroupId)).filter(e=>!h.isLoading&&(j.isReachingEnd||j.isEmpty)||(M.at(-1)?.name.toLowerCase()??"")>e.name.toLowerCase()).map(e=>{let s={id:e.accessGroupId,type:"access-group",name:e.name,role:"CONTRIBUTOR",badge:`${e.membersCount} members`};return r.current.set(s.id,s),s}):[],E=[...M,...C].sort((e,s)=>e.name.toLowerCase()>s.name.toLowerCase()?1:-1);if(n&&!E.some(e=>e.id===n)){let e=r.current.get(n);e&&E.push(e)}let w=(0,ev.useIntersectionObserverRef)(()=>{j.isLoadingMore||j.loadMore()},{rootMargin:"100px 0px"}),A=E.some(e=>"email"in e&&e.email===d);return(0,s.jsxs)(eb.Combobox,{className:"w-full",onChange:e=>{x("");let s=E.find(s=>s.id===e);if(s){if(s.hasAccess){o(""),x(""),a();return}l(s),o(s.id);return}if(v){let s=j.members.find(s=>s.email.toLowerCase()===e?.toLowerCase());if(s){let e=E.find(e=>e.id===s.uid);e&&(l(e),o(e.id));return}e&&(0,ej.default)(e)&&(l({id:e,type:"email",name:e,email:e,role:"CONTRIBUTOR",badge:""}),o(e))}},onClear:()=>{x(""),a()},placeholder:v?"Add member, access group or email…":"Select member…",value:n,children:[(0,s.jsx)(eb.Combobox.Input,{loading:h.isLoading||f,onChange:e=>{x(e.target.value)}}),(0,s.jsx)(eb.Combobox.List,{className:"tailwind-preflight",hideOnEmpty:!0,children:(0,s.jsxs)(s.Fragment,{children:[E.map(e=>(0,s.jsxs)(eb.Combobox.Option,{disabled:e.hasAccess,label:`${e.name}${"email"in e?` (${e.email})`:""}`,prefix:"avatar"in e?(0,s.jsx)(u.Avatar,{hash:e.avatar,size:24}):(0,s.jsx)("div",{className:"flex flex-col items-center justify-start flex-initial w-6",children:(0,s.jsx)(m.Users,{size:"16"})}),suffix:e.hasAccess?null:(0,s.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial pl-4",children:(0,s.jsx)(ef.Badge,{size:"sm",children:e.badge})}),value:e.id,children:[(0,s.jsxs)("span",{className:(0,eo.default)("text-copy-14 truncate","email"in e?"text-gray-900":"text-gray-1000"),children:[(0,s.jsx)("span",{className:"text-copy-14 text-gray-1000",children:e.name}),"email"in e?(0,s.jsxs)("span",{className:"text-copy-14 text-gray-900",children:[" ",e.email]}):""]}),e.hasAccess?(0,s.jsx)("span",{className:"text-copy-14 text-gray-900 whitespace-nowrap",children:" already has access"}):null]},e.id)),j.isEmpty||j.isReachingEnd||h.isLoading?null:(0,s.jsx)(eb.Combobox.Option,{className:"tailwind-preflight",disabled:!0,displayLast:!0,label:"Load more",value:"load-more",children:(0,s.jsx)("div",{ref:j.isLoadingMore?void 0:w,className:"flex flex-col items-center justify-start flex-initial w-full",children:(0,s.jsx)(ey.Spinner,{})})},"load-more"),v&&n&&(0,ej.default)(n)?(0,s.jsx)(eb.Combobox.Option,{displayLast:!0,label:n,prefix:(0,s.jsx)("div",{className:"flex flex-col items-center justify-start flex-initial w-6",children:(0,s.jsx)(eh.UserPlus,{size:"16"})}),value:n,children:n},"invite-selected-email"):null,v&&d&&d!==n&&!A?(0,s.jsx)(eb.Combobox.Option,{disabled:!(0,ej.default)(d),displayLast:!0,label:d,prefix:(0,s.jsx)("div",{className:"flex flex-col items-center justify-start flex-initial w-6",children:(0,s.jsx)(eh.UserPlus,{size:"16"})}),value:d,children:d&&(0,ej.default)(d)?d:"Continue typing email to invite…"},"invite-new-member"):null]})})]})}function eC(e){let{disabled:l=!1,members:n,accessGroups:o,revalidateData:d}=e,{team:m}=(0,r.useTeam)(),u=m?.id,x=(0,v.useToasts)(),{project:j}=(0,t.useRouter)().query,{data:p}=(0,D.useProject)(j),{isLoading:f,can:b}=(0,N.default)(),g=void 0===p||f,M=l||g||!b(P.Action.Create,P.Resource.ProjectMember),E=b(P.Action.List,P.Resource.TeamFellowMembership),{isValidRoleCombination:w,getDefaultProjectRole:A}=(0,ex.useRoleUtils)(),[R,T]=(0,c.useState)([S()]);function S(){return{key:Date.now(),id:"",type:"member",name:"",email:"",avatar:"",role:"PROJECT_VIEWER",teamRole:"CONTRIBUTOR"}}let[I,k]=(0,c.useState)(null),[L,O]=(0,c.useState)(!1),_=(0,c.useRef)(null);function z(){if(!m||!_.current)return;k(null);let e=!1;for(let s of R.filter(e=>!!e.id))"member"!==s.type||w(s.teamRole,s.role)||k(`Please enter a valid role combination for "${s.name}".`),e=!0;e?O(!0):k("Please complete the fields above.")}let G=[...o.map(e=>e.accessGroupId),...n.map(e=>e.uid)];return(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),z()},ref:_,children:[(0,s.jsxs)(eu.EntityForm,{className:"tailwind-preflight",disabled:g||!E,footerNote:l?(0,s.jsxs)("span",{children:["This feature is available on the"," ",(0,s.jsx)(a.Link,{external:!0,href:"/pricing",tab:!0,type:"highlight",children:"Enterprise plan"}),"."]}):(0,s.jsx)(y.Skeleton,{show:g,children:g||E?(0,s.jsxs)("span",{className:"text-copy-14 text-gray-900",children:["Learn more about"," ",(0,s.jsx)(a.Link,{external:!0,href:"/docs/accounts/team-members-and-roles",variant:"highlight",children:"Project Roles"})]}):(0,s.jsxs)("span",{className:"text-copy-14 text-gray-900 geist-disabled-skip",children:["Additional permissions are required to manage ",(0,s.jsx)(a.Link,{external:!0,href:"/docs/accounts/team-members-and-roles",variant:"highlight",children:"Project Members"})]})}),footerSeparator:!0,primaryAction:l?(0,s.jsx)(a.ButtonLink,{href:"/pricing",size:"small",target:"_blank",children:"Upgrade"}):E?(0,s.jsx)(h.Button,{disabled:M,onClick:z,size:"small",typeName:"submit",children:"Assign Role"}):null,title:"Assign project role",children:[(0,s.jsxs)("p",{className:"text-copy-14 text-gray-900",children:["Team members with the ",(0,s.jsx)("strong",{children:"Developer"})," or"," ",(0,s.jsx)("strong",{children:"Contributor"})," role can have Project Roles assigned. You can also map Access Groups to this project and invite new team members with access to only this project as Contributors."]}),(0,s.jsx)(i.Spacer,{}),(0,s.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:(0,s.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial tailwind-preflight",children:[(0,s.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-4 flex-initial geist-hide-on-mobile",children:[(0,s.jsx)(em.Label,{bypassCasing:!0,value:"Team Member, Access Group or Email",wrapperClassName:"w-1/2"}),(0,s.jsx)(em.Label,{value:"Project Role",wrapperClassName:"w-1/2"})]}),(0,s.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:R.map(e=>(0,s.jsxs)("div",{className:"flex flex-col md:flex-row items-stretch justify-start gap-4 flex-initial",children:[u&&p?(0,s.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial md:row md:w-1/2",children:[(0,s.jsx)(em.Label,{bypassCasing:!0,value:"Team Member, Access Group or Email",wrapperClassName:"md:hidden"}),(0,s.jsx)(eM,{alreadySelected:[...G,...R.filter(s=>s.id!==e.id).map(e=>e.id)],onClear:()=>{T(R.map(s=>s.key===e.key?{...S(),role:e.role}:s))},onMemberChange:s=>{T(R.map(t=>t.key===e.key?{...t,id:s.id,teamRole:s.role,type:s.type,role:w(s.role,t.role)?t.role:A(s.role)??"PROJECT_VIEWER",email:"email"in s?s.email:"",name:s.name,avatar:"avatar"in s?s.avatar:""}:t))},project:p})]}):(0,s.jsx)(y.Skeleton,{height:40,width:"100%"}),(0,s.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial md:row md:w-1/2",children:[(0,s.jsx)(em.Label,{value:"Project Role",wrapperClassName:"md:hidden"}),(0,s.jsx)(el.ProjectRoleSelector,{disabled:M,menuButtonWidth:"100%",menuWidth:"100%",onChange:s=>{T(R.map(t=>t.key===e.key?{...t,role:s}:t))},teamRole:e.teamRole,value:e.role})]}),(0,s.jsx)("hr",{className:"geist-hr-reset md:hidden"})]},e.key))})]})}),(0,s.jsx)(i.Spacer,{y:2/3}),(0,s.jsx)(h.Button,{disabled:M,onClick:()=>{T([...R,S()])},prefix:(0,s.jsx)(ed.PlusCircle,{}),size:"small",type:"secondary",typeName:"button",children:"Add another"}),I?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Spacer,{}),(0,s.jsx)(K.Error,{error:I})]}):null]}),(0,s.jsx)(ep,{active:L,members:R,onAdded:()=>{x.success(`Successfully added ${(0,C.pluralize)("Project Member",R.length)}`),T([S()])},revalidateData:d,setActive:O})]})}let eE=[,,,,,].fill({});function ew(e){let{disabled:a}=e,[l,n]=(0,c.useState)(""),o=(0,t.useRouter)(),m=(0,v.useToasts)(),{isReady:u,team:x}=(0,r.useTeam)(),{project:h}=o.query,{data:C}=(0,D.useProject)(h),{data:k}=(0,G.useProjectMembersSummary)(h),{accessGroupsWithRole:L,isLoading:O,mutate:B}=(0,$.useAccessGroups)({membersLimit:2,projectId:C?.id??null}),[F,H]=(0,c.useState)(null),[q,J]=(0,c.useState)(null),{data:Z}=(0,G.default)({limit:G.PROJECT_MEMBERS_LIMIT}),{isLoading:W,can:K}=(0,N.default)(),Q=K(P.Action.Delete,P.Resource.ProjectMember),X=K(P.Action.Update,P.Resource.ProjectMember),ee=K(P.Action.Update,P.Resource.TeamFellowMembership),es=K(P.Action.List,P.Resource.TeamFellowMembership),ei=K(P.Action.Update,P.Resource.AccessGroup),[ea,el]=(0,U.useMembersInfinite)({},{filterByUserIds:Z?.members.map(e=>e.uid)}),[{mutate:en},{members:eo,initialDataLoaded:ed,loadMore:em,isLoadingMore:eu,isReachingEnd:ex,isLagging:eh}]=(0,G.useProjectMembersInfinite)({search:Z?.pagination.hasNext&&l||void 0},{},!0,!1),ej=!ed||O,ep=W||void 0===C||!u,ef=a||ep||!Q,[eb,ey]=(0,c.useState)({}),eg=Object.keys(eb).length,[ev]=(0,c.useState)(()=>new Set),[eM,ew]=(0,c.useState)(""),eP=(0,c.useRef)(null),[eR,eT]=(0,c.useState)("date"),eS=(0,c.useMemo)(()=>{let e=[...eo];switch(!Z?.pagination.hasNext&&(e=(0,_.matchSorter)([...eo],eM,{keys:["name","username","email"]})),eR){case"name-a":e=e.sort((e,s)=>e.name&&s.name?e.name.localeCompare(s.name):e.username&&s.username&&s.name?e.username.localeCompare(s.name):0);break;case"name-z":e=e.sort((e,s)=>e.name&&s.name?e.name.localeCompare(s.name):e.username&&s.username&&s.name?e.username.localeCompare(s.name):0).reverse()}return[...e].sort()},[eo,eM,eR,Z]),eI=(0,c.useMemo)(()=>!!eS.length&&eS.every(e=>eb[e.uid]),[eS,eb]),[ek,eL]=(0,c.useState)([]),[eO,e_]=(0,c.useState)(!1);function ez(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.length||(e=eS.filter(e=>!!eb[e.uid])),eL(e),e_(!0)}async function eG(e,s){try{let t=await (0,w.fetchAPI)(`${(0,A.API_PROJECTS_MEMBERS)(C?.id??"")}${(0,E.encode)({teamId:x?.id})}`,{method:"PATCH",body:{members:e.map(e=>({uid:e,role:s}))}});if(t?.error)throw Error(t.error.message);await en(),m.success("Changed Project role successfully.")}catch(e){m.error((0,M.errorToString)(e))}}return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eC,{accessGroups:L||[],disabled:a,members:eS,revalidateData:async()=>{await Promise.all([en(),B()])}}),a?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Spacer,{}),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row items-stretch justify-start gap-4 md:gap-2 flex-initial",children:[(0,s.jsx)("div",{className:"flex flex-col items-stretch justify-start",style:{flex:"75%"},children:(0,s.jsx)(y.Skeleton,{show:!ed,children:(0,s.jsx)(I.SearchInput,{disabled:ep||0===eS.length&&!eM,loading:eh&&eM.length>0,onChange:e=>{let{value:s}=e.target;ev.add(""),ew(s),eP.current&&clearTimeout(eP.current),ev.has(s)?(n(s),ev.add(s)):eP.current=setTimeout(()=>{n(s),ev.add(s)},100)},placeholder:"Filter…",value:eM,width:"100%"})})}),(0,s.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:(0,s.jsx)(y.Skeleton,{show:!ed,children:(0,s.jsxs)(b.Select,{disabled:ep||0===eS.length&&!eM,onChange:e=>eT(e.target.value),prefix:(0,s.jsx)(d.SortDescending,{}),value:eR,children:[(0,s.jsx)("option",{value:"default",children:"Default"}),(0,s.jsx)("option",{value:"name-a",children:"Name (A-Z)"}),(0,s.jsx)("option",{value:"name-z",children:"Name (Z-A)"})]})})})]}),(0,s.jsx)(i.Spacer,{y:.5}),!(ed&&0===eS.length)&&(0,s.jsx)(T.EntityHeader,{children:(0,s.jsxs)("div",{className:"flex flex-row items-center justify-between flex-1",children:[(0,s.jsx)(y.Skeleton,{show:!ed,children:(0,s.jsx)(g.Tooltip,{delayTime:300,disableTriggers:!ef,position:"bottom",text:(0,s.jsx)(Y,{}),children:(0,s.jsx)(j.Checkbox,{"aria-label":"Select all",checked:eI,className:"flex gap-1 text-sm text-gray-900",disabled:ef||!ej&&0===eS.length,onChange:()=>{eI?ey({}):ey(e=>{let s={...e};return eS.forEach(e=>{s[e.uid]=!0}),s})},children:0===eg?"Select all":`${eg} selected`})})}),(0,s.jsx)(y.Skeleton,{show:!ed,children:(0,s.jsx)(S.EntityMenu,{disabledDotMenuTooltip:(0,s.jsx)(Y,{}),isDotMenuDisabled:ef,children:(0,s.jsxs)(f.MenuItem,{disabled:0===eg,onClick:()=>ez(),type:"error",children:["Remove Project-level Role (",eg,")"]})})})]})}),(0,s.jsxs)(R.PlaceholderContext.Provider,{value:ej,children:[k?(0,s.jsx)(eA,{canListMembers:es,canManageMembers:ee,roles:k}):null,L?.map(e=>(0,s.jsx)(eN,{accessGroup:e,canUpdateAccessGroup:ei,onPromptEdit:()=>H(e)},e.accessGroupId)),(ej?eE:eS).map(e=>{let t="uid"in e?e:void 0,i=t&&el.members.find(e=>e.uid===t.uid);return t?(0,s.jsx)(et,{canDeleteProjectMember:Q,canUpdateProjectMember:X,onManageProjectAccess:()=>{i&&C&&J({member:i,project:C})},onManageTeamAccess:()=>{i&&J({member:i})},onUpdateProjectRole:eG,project:C,projectMember:t,remove:ez,selected:eb,setSelected:ey,teamMember:i},t.uid):null}),0===eS.length&&ed&&eM?(0,s.jsx)(ec,{search:eM}):null,!ej&&!ex&&(0,s.jsx)(p.LoadMoreButton,{disabled:ej,loading:eu,onClick:em})]}),(0,s.jsx)(er,{active:eO,members:ek,onRemoved:()=>{ey({})},setActive:e_}),q?(0,s.jsx)(V.ManageRoleModal,{accessGroupsData:L,member:q.member,onClearProject:()=>{J({member:q.member})},onClose:()=>{J(null)},project:q.project,revalidateAccessGroups:async()=>{await B(),await en()},revalidateSearch:ea.mutate}):null,F?(0,s.jsx)(z.EditAccessGroupModal,{accessGroup:F,canUpdateAccessGroup:ei,mutate:B,onClose:()=>H(null)}):null]})]})}function eA(e){let{canManageMembers:i,canListMembers:a,roles:l}=e,{team:n}=(0,r.useTeam)(),o=(0,t.useRouter)(),c=Object.values(l).reduce((e,s)=>e+s,0),d=Object.entries(l).map(e=>{let[s,t]=e;return 0!==t?`${t} ${(0,B.default)((0,C.pluralize)(s.toLowerCase(),t))}`:""}).filter(Boolean).join(", ");return(0,s.jsxs)(k.Entity,{className:es.default.summaryEntity,menuItems:a?(0,s.jsx)(f.MenuItem,{onClick:()=>n?o.push(`/${n.slug}/~/settings/members`):null,children:i?"Manage Team Members":"View Team Members"}):null,thumbnail:(0,s.jsx)(O.EntityThumbnail,{size:32,children:(0,s.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial pl-8",children:(0,s.jsx)(u.Avatar,{size:32,teamId:n?.id})})}),children:[(0,s.jsx)(L.EntityField,{description:d,title:(0,s.jsxs)("span",{className:"geist-inline-center",children:[(0,s.jsxs)("span",{className:"geist-ellipsis geist-hide-on-mobile",children:[c," ",n?.name," team members have access to this project"]}),(0,s.jsxs)("span",{className:"geist-ellipsis geist-hide-on-desktop",children:[c," team members have access"]})]})}),a?(0,s.jsx)("div",{className:"flex flex-col items-stretch justify-center flex-initial geist-hide-on-mobile",children:(0,s.jsx)(h.Button,{onClick:()=>n?o.push(`/${n.slug}/~/settings/members`):null,size:"small",type:"secondary",children:i?"Manage Team Members":"View Team Members"})}):null]})}function eN(e){let{accessGroup:t,canUpdateAccessGroup:i,onPromptEdit:a}=e,l=(0,R.usePlaceholder)();return(0,s.jsxs)(k.Entity,{className:es.default.accessGroupEntity,menuItems:(0,s.jsx)(f.MenuItem,{onClick:a,children:i?"Edit Access Group":"View Access Group"}),placeholder:l,thumbnail:t.members?.length?(0,s.jsx)(O.EntityThumbnail,{size:32,children:(0,s.jsx)("div",{className:"flex flex-col items-end justify-start flex-initial w-16",children:(0,s.jsx)(x.AvatarGroup,{members:t.members.map(e=>({uid:e})),size:32})})}):(0,s.jsx)("div",{className:"flex flex-col items-end justify-start flex-initial w-16 h-8",children:(0,s.jsx)(O.EntityThumbnail,{circular:!0,size:32,children:(0,s.jsx)(m.Users,{})})}),children:[(0,s.jsx)(L.EntityField,{description:`${t.membersCount} Contributors`,title:(0,s.jsx)("span",{className:"geist-inline-center",children:(0,s.jsx)("span",{className:"geist-ellipsis",children:t.name})})}),(0,s.jsx)("div",{className:"flex flex-col items-stretch justify-center flex-initial geist-hide-on-mobile",children:(0,s.jsx)(h.Button,{onClick:a,size:"small",type:"secondary",children:i?"Edit Access Group":"View Access Group"})})]})}function eP(){let{teamSlug:e}=(0,r.useTeam)();return(0,s.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,s.jsx)("h1",{className:"text-heading-24",children:"Project Members"}),(0,s.jsxs)("p",{className:"text-copy-14 text-gray-1000",children:["Manage and assign roles on this project. Team members can be managed from"," ",(0,s.jsxs)(a.Link,{className:"inline-flex items-center gap-1",href:`/${String(e)}/~/settings/members`,variant:"highlight",children:["Team Settings",(0,s.jsx)(l.ArrowCircleRight,{align:"middle"})]})]})]})}e.s(["default",0,function(){let e=(0,t.useRouter)(),{teamSlug:a,isReady:l}=(0,r.useTeam)(),{value:c,isReady:d}=(0,n.useEntitlement)("project-rbac-access-groups"),{project:m}=e.query,u=!!(e.isReady&&l&&d&&!c&&a&&e.query.project);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.HeadTitle,{title:`${m||""} – Project Members`,titlePostfix:!0}),(0,s.jsx)(eP,{}),(0,s.jsx)(i.Spacer,{}),(0,s.jsx)(ew,{disabled:u})]})}],3070180)}]);

//# debugId=0189be03-d1f6-5e4b-87bc-ba861c7a89c6
//# sourceMappingURL=0b0a9ecf433f9384.js.map