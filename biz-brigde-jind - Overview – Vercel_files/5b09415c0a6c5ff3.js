;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="1eea834d-3794-6557-a7c7-27519d151102")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,2102048,e=>{"use strict";var l=e.i(1146226),t=e.i(1397323),a=e.i(5610834),i=e.i(5169864),s=e.i(57106),r=e.i(7420728),n=e.i(9367781),o=e.i(9106354),c=e.i(4004502),d=e.i(6143247),u=e.i(9317241),x=e.i(5255926);function f(e){let{width:t}=e;return(0,l.jsx)(x.Skeleton,{className:"w-full @lg-page:h-[388px]",height:200,width:t??300})}var h=e.i(5579912),m=e.i(3992079),g=e.i(5149014);function p(e){let{size:t=16,fill:a="currentColor",className:i=""}=e;return(0,l.jsx)("svg",{className:i,fill:a,height:t,viewBox:"0 0 56 56",width:t,xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{d:"M40.25 24.5C48.949 24.5 56 31.552 56 40.25 56 48.949 48.949 56 40.25 56c-8.698 0-15.75-7.051-15.75-15.75 0-8.698 7.052-15.75 15.75-15.75ZM37.696 42c.138 3.376.675 6.74 1.612 10.02l-1.091.31a12.33 12.33 0 0 0 4.065 0l-1.09-.31A42.838 42.838 0 0 0 42.804 42h-5.108ZM23 0c0 1.785.56 3.083 1.453 4.122.933 1.085 2.307 1.976 4.045 2.74 1.733.76 3.698 1.34 5.718 1.881 1.958.524 4.053 1.03 5.792 1.61l1.367.456v6.066h-4v-3.148c-1.26-.361-2.662-.71-4.193-1.12-2.05-.548-4.263-1.192-6.292-2.084-2.025-.889-3.997-2.079-5.471-3.794-.146-.17-.284-.346-.419-.525-.135.179-.273.355-.419.525-1.474 1.715-3.446 2.905-5.47 3.794-2.03.892-4.244 1.536-6.293 2.084-1.531.41-2.933.759-4.193 1.12v19.618c0 5.114 2.84 9.807 7.37 12.18l4.683 2.453 1.771.928-1.855 3.543-1.772-.927-4.683-2.454A17.75 17.75 0 0 1 .625 33.345V10.809l1.367-.457c1.739-.579 3.834-1.085 5.792-1.609 2.02-.54 3.985-1.12 5.718-1.882 1.738-.763 3.112-1.654 4.045-2.739C18.44 3.083 19 1.785 19 0h4Zm23.307 42a46.327 46.327 0 0 1-1.372 9.57c3.924-1.627 6.82-5.23 7.44-9.57h-6.068Zm-18.182 0c.62 4.34 3.515 7.943 7.438 9.57a46.332 46.332 0 0 1-1.37-9.57h-6.068Zm7.438-13.07c-3.923 1.626-6.817 5.23-7.438 9.57h6.068a46.328 46.328 0 0 1 1.37-9.57Zm9.372 0a46.33 46.33 0 0 1 1.372 9.57h6.068c-.62-4.34-3.516-7.945-7.44-9.57ZM40.25 28c-.693 0-1.372.058-2.033.169l1.09.311a42.838 42.838 0 0 0-1.61 10.02h5.107a42.838 42.838 0 0 0-1.612-10.02l1.09-.311c-.66-.11-1.34-.169-2.032-.169Z"})})}function j(e){let{size:t=16,fill:a="currentColor",className:i=""}=e;return(0,l.jsx)("svg",{className:i,fill:a,height:t,viewBox:"0 0 42 55",width:t,xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{d:"M23 0c0 1.785.56 3.083 1.453 4.122.933 1.085 2.307 1.976 4.045 2.74 1.733.76 3.698 1.34 5.718 1.881 1.958.524 4.053 1.03 5.792 1.61l1.367.456v22.536a17.75 17.75 0 0 1-9.514 15.723l-9.933 5.204-.928.486-.928-.486-9.933-5.204A17.75 17.75 0 0 1 .625 33.345V10.809l1.367-.457c1.739-.579 3.834-1.085 5.792-1.609 2.02-.54 3.985-1.12 5.718-1.882 1.738-.763 3.112-1.654 4.045-2.739C18.44 3.083 19 1.785 19 0h4Zm-2 6.204c-.135.179-.273.355-.419.525-1.474 1.715-3.446 2.905-5.47 3.794-2.03.892-4.244 1.536-6.293 2.084-1.531.41-2.933.759-4.193 1.12v19.618c0 5.114 2.84 9.807 7.37 12.18L21 50.242l9.005-4.717a13.751 13.751 0 0 0 7.37-12.18V13.728c-1.26-.362-2.662-.71-4.193-1.12-2.05-.549-4.263-1.193-6.292-2.085-2.025-.889-3.997-2.079-5.471-3.794-.146-.17-.284-.346-.419-.525ZM30.828 24.5 18.914 36.414a2 2 0 0 1-2.828 0L11.172 31.5 14 28.672l3.5 3.5 10.5-10.5 2.828 2.828Z"})})}function w(e){let{size:t=16,fill:a="currentColor",className:i=""}=e;return(0,l.jsx)("svg",{className:i,fill:a,height:t,viewBox:"0 0 55 54",width:t,xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{d:"M11.625 33.345c0 5.114 2.84 9.807 7.37 12.18L28 50.242l3.135-1.641 1.771-.93 1.856 3.545-1.772.928-4.062 2.128-.928.486-.928-.486-9.933-5.204a17.75 17.75 0 0 1-9.514-15.723v-9.97h4v9.97ZM30 0c0 1.785.56 3.083 1.453 4.122.933 1.085 2.307 1.976 4.045 2.74 1.733.76 3.699 1.34 5.718 1.881 1.958.524 4.053 1.03 5.792 1.61l1.367.456v22.536c0 3.414-.983 6.681-2.737 9.465l8.815 8.815-2.828 2.828L1.547 4.375l2.828-2.828 7.864 7.864.44-.115c3.388-.888 6.79-1.734 9.39-3.217C24.541 4.67 26 2.861 26 0h4Zm-2 6.204c-1.05 1.39-2.432 2.484-3.95 3.35-2.583 1.473-5.73 2.388-8.536 3.131L42.717 39.89a13.736 13.736 0 0 0 1.658-6.544V13.728c-1.26-.362-2.662-.71-4.193-1.12-2.05-.549-4.263-1.193-6.292-2.085-2.025-.889-3.997-2.079-5.471-3.794-.146-.17-.284-.346-.419-.525Z"})})}function v(e){let{hasAnomaly:t,isLoading:a}=(0,g.useActiveAnomaly)(e),s=(0,h.useProxyModal)(),[r,n,o]=(0,g.useReverseProxyBadge)({...e,onProxyClick:s.open}),[c,x,v,b]=(0,g.useACMBadge)(e),[y,k,S]=(0,g.useGlobalBypass)(e),N=(0,i.useCallback)(()=>r||c||y?null:(0,l.jsx)("span",{className:"text-label-12 text-gray-alpha-900",children:"All systems normal"}),[c,r,y]),M=(0,i.useCallback)(()=>y?(0,l.jsx)(w,{fill:"var(--ds-red-800)",size:56}):t?(0,l.jsx)(p,{fill:"var(--ds-amber-800)",size:56,className:"ml-2"}):(0,l.jsx)(j,{fill:"var(--ds-blue-700)",size:56}),[y,t]),C=(0,i.useMemo)(()=>y?"System Mitigations Paused":t?"DDoS attacks are being mitigated":"Firewall is active",[t,y]),A=a||o||b||S,R=(0,i.useRef)(!1);return((0,i.useEffect)(()=>{A||R.current||(R.current=!0)},[A]),A&&!R.current)?(0,l.jsx)(f,{width:278}):(0,l.jsxs)(u.GradientPostureCard,{hasAnomaly:t,hasChallengeMode:c,hasGlobalBypass:y,children:[(0,l.jsxs)("figure",{className:"flex flex-col items-center gap-3 lg:gap-5 grow justify-center",children:[(0,l.jsx)(M,{}),(0,l.jsxs)("figcaption",{className:(0,d.cn)("flex flex-col items-center",{"gap-1":c||r}),children:[(0,l.jsx)("p",{children:(0,l.jsx)("strong",{className:"text-label-14 font-medium",children:C})}),(0,l.jsxs)("div",{className:"flex flex-col gap-1 items-center",children:[(0,l.jsx)(k,{}),(0,l.jsx)(x,{}),(0,l.jsx)(n,{}),(0,l.jsx)(N,{})]})]})]}),(0,l.jsxs)("div",{className:"group flex flex-col gap-1",children:[(0,l.jsx)(u.BotProtectionRow,{hasReverseProxy:r,...e}),(0,l.jsx)(u.CustomRulesRow,{...e}),(0,l.jsx)(u.AttackChallengeRow,{challengeData:v,isAlerting:c})]}),s.isOpen&&(0,l.jsx)(m.ProxyImpactModal,{onClose:s.close,...e})]})}var b=e.i(8708663),y=e.i(5963711),k=e.i(5182595),S=e.i(8690335),N=e.i(9722978);function M(){return(0,l.jsxs)("div",{className:"flex flex-col gap-4 @lg-page:flex-row @lg-page:gap-[unset] @lg-page:divide-x @lg-page:[&>*:not(:first-child)]:pl-3 @lg-page:[&>*:not(:last-child)]:pr-3",children:[(0,l.jsx)("div",{className:"flex w-full flex-col gap-4 @lg-page:flex-row @lg-page:gap-3",children:(0,l.jsx)("div",{className:"w-full @lg-page:w-[226px]",children:(0,l.jsx)(x.Skeleton,{height:40,width:"100%"})})}),(0,l.jsxs)("div",{className:"flex w-full flex-col gap-4 @lg-page:flex-row @lg-page:gap-3",children:[(0,l.jsx)("div",{className:"w-full @lg-page:w-[176px]",children:(0,l.jsx)(x.Skeleton,{height:40,width:"100%"})}),(0,l.jsx)("div",{className:"w-full @lg-page:w-[146px]",children:(0,l.jsx)(x.Skeleton,{height:40,width:"100%"})})]})]})}function C(e){let{height:t}=e;return(0,l.jsxs)("div",{className:"flex w-full flex-col",style:{height:t},children:[(0,l.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,l.jsx)(x.Skeleton,{height:16,width:28}),(0,l.jsx)("hr",{className:"w-full"})]}),(0,l.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,l.jsx)(x.Skeleton,{height:16,width:28}),(0,l.jsx)("hr",{className:"w-full"})]}),(0,l.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,l.jsx)(x.Skeleton,{height:16,width:28}),(0,l.jsx)("hr",{className:"w-full"})]}),(0,l.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,l.jsx)(x.Skeleton,{height:16,width:28}),(0,l.jsx)("hr",{className:"w-full"})]}),(0,l.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,l.jsx)(x.Skeleton,{height:16,width:28}),(0,l.jsx)("hr",{className:"w-full"})]}),(0,l.jsxs)("div",{className:"flex h-36 flex-row items-center gap-5",children:[(0,l.jsx)(x.Skeleton,{height:16,width:28}),(0,l.jsx)("hr",{className:"w-full"})]}),(0,l.jsxs)("div",{className:"flex flex-row justify-around",children:[(0,l.jsx)(x.Skeleton,{height:16,width:48}),(0,l.jsx)(x.Skeleton,{height:16,width:48}),(0,l.jsx)(x.Skeleton,{className:"xs:block hidden",height:16,width:48}),(0,l.jsx)(x.Skeleton,{className:"hidden sm:block",height:16,width:48}),(0,l.jsx)(x.Skeleton,{className:"hidden md:block",height:16,width:48}),(0,l.jsx)(x.Skeleton,{className:"hidden @lg-page:block",height:16,width:48})]})]})}var A=e.i(3538015);function R(e){let{height:t,data:a,query:s,error:r,isLoading:n,onZoomIn:o}=e,{allData:d,allKeys:u,colorScale:x,formatter:f}=(0,b.useVisualizationContext)(),h=(0,i.useMemo)(()=>{var e,l;let t;return e=d.filter(e=>!(0,y.isOthersAggregate)(e.key)),l=u,t=new Map(e.map(e=>{let{date:t}=e;return[t.toISOString(),{time:t.toISOString(),name:t.toISOString(),date:t,...Object.fromEntries(l.map(e=>[e,0]))}]})),e.forEach(e=>{let{date:l,key:a,value:i}=e,s=t.get(l.toISOString());s&&(s[a]=i)}),[...t.values()].sort((e,l)=>e.date.getTime()-l.date.getTime())},[d,u]),m=(0,i.useMemo)(()=>{let e=new Map;return u.forEach(l=>{e.set(l,function(e){if(e.includes("$$")){let[l,t]=e.split("$$"),a=A.ruleToMappings[l]?.label||l.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),i=(0,y.formatFirewallActionForDisplay)(t);return`${a} (${i})`}return A.ruleToMappings[e]?A.ruleToMappings[e].label:e}(l))}),e},[u]),g=(0,i.useMemo)(()=>h.map(e=>{let l={name:e.name,time:e.time};return Object.entries(e).forEach(e=>{let[t,a]=e;"name"!==t&&"time"!==t&&"date"!==t&&(l[m.get(t)||t]=a)}),l}),[h,m]),p=(0,i.useMemo)(()=>u.map(e=>m.get(e)||e),[u,m]),j=(0,i.useMemo)(()=>e=>{let l=Array.from(m.entries()).find(l=>{let[t,a]=l;return a===e})?.[0];return l?x(l):x(e)},[x,m]);return r?(0,l.jsxs)("div",{"data-testid":(0,c.tid)("firewall","graph","error"),className:"border-border flex flex-col items-center justify-center gap-2 rounded-md border border-gray-400 bg-[var(--accents-1)]",style:{height:t},children:[(0,l.jsx)("p",{className:"text-[14px] leading-[20px] font-medium capitalize",children:r.code}),(0,l.jsx)("p",{className:"text-copy-14 max-w-[400px] text-gray-800",children:r.message})]}):n&&(!a||0===a.size)||null===a?(0,l.jsx)(C,{height:t}):0===a.size?(0,l.jsxs)("div",{"data-testid":(0,c.tid)("firewall","graph","empty"),className:"border-border flex flex-col items-center justify-center gap-2 rounded-md border border-gray-400 bg-[var(--accents-1)]",style:{height:t},children:[(0,l.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:"No Data"}),(0,l.jsx)("p",{className:"text-copy-14 max-w-[400px] text-gray-800",children:"There's no data available for your selection."})]}):(0,l.jsx)("div",{style:{height:t},children:(0,l.jsx)(k.LineChart,{agentWorkflow:"firewall-investigation",data:g,categories:p,getColor:j,isLoading:n,syncId:"firewall",disableLegend:!0,formatValue:e=>f(e),formatXAxisValue:L,xTickCount:5,yTickCount:5,builderQuery:(0,S.fromSonarQuery)(s),tooltipStyle:"value-list",onZoomIn:o,hideZeroValuesInTooltip:!0})})}let B={hour:"numeric",minute:"2-digit",second:"numeric"};function L(e){return e.toLocaleTimeString(void 0,B)}var $=e.i(3228096);function T(e){let{totalRequests:t}=e;return(0,l.jsx)("div",{className:"relative overflow-hidden rounded-t-md @container before:pointer-events-none before:absolute before:inset-0 before:shadow-[inset_-30px_0_20px_-20px_var(--ds-background-200)] before:content-[''] @[966px]:before:shadow-none",children:(0,l.jsx)("div",{className:"flex flex-1 flex-row divide-x [-ms-overflow-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:(0,l.jsx)(I,{icon:(0,l.jsx)($.Globe,{}),label:"All Traffic",children:t})})})}function I(e){let{children:t,icon:a,label:i}=e;return(0,l.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-1 flex-1 p-5 min-w-[166px] border-b-2 border-b-gray-1000 bg-background-100",children:[(0,l.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial text-gray-1000",children:[a,(0,l.jsx)("p",{className:"text-label-14 font-medium whitespace-nowrap",children:i})]}),(0,l.jsx)("p",{className:"text-heading-24 font-medium text-left",children:0===t?"-":(0,y.formatShortPrecision)(t)})]})}var P=e.i(4738733),F=e.i(9658738),O=e.i(2375916),z=e.i(8724159),_=e.i(3814652),D=e.i(9475671),Z=e.i(7807066),E=e.i(1717203),U=e.i(7557283),V=e.i(5481907),q=e.i(3207036);function G(e){let{onActionClick:t,query:a,state:s}=e,{can:r}=(0,E.default)(),n=(0,y.wafRuleId)(s.filter),o=(0,i.useRef)(null),[c,u]=(0,i.useState)(!1),[x,f]=(0,i.useState)(!1),h=(0,i.useRef)(null),m=(0,q.useReducedMotion)(),{currentData:g}=(0,V.useSonarLiveQuery)({...a,filter:"all_rules"===s.filter?void 0:`wafRuleId eq '${n}'`,groupBy:["wafAction"],summaryOnly:!0},"live"===s.range&&(r(U.Action.Read,U.Resource.SeawallConfig)||r(U.Action.List,U.Resource.SeawallConfig))),p=(g?.summary??[]).reduce((e,l)=>{let t="allow"===l.wafAction?"allow":(0,y.normalizeFirewallAction)(l.wafAction);return t in e&&(e[t]+=l.value??0),e.all+=l.value??0,e},{all:0,allow:0,challenge:0,deny:0,log:0,rate_limit:0});(0,i.useEffect)(()=>{let e=o.current;if(!e)return;let{firstElementChild:l,lastElementChild:t}=e,a=new IntersectionObserver(e=>{e.forEach(e=>{l?.isSameNode(e.target)&&u(1!==e.intersectionRatio),t?.isSameNode(e.target)&&f(1!==e.intersectionRatio)})},{root:e,threshold:1});return l&&a.observe(l),t&&a.observe(t),()=>a.disconnect()},[]),(0,i.useEffect)(()=>{let e=h.current,l=o.current;if(e&&l){let t=e.getBoundingClientRect(),a=l.getBoundingClientRect();t.left>=a.left&&t.right<=a.right||e.scrollIntoView({behavior:m?"instant":"smooth",block:"nearest",inline:"center"})}},[s.action,m]);let j=e=>{let l=o.current;l&&l.scrollBy({left:"left"===e?-200:200,behavior:m?"instant":"smooth"})};return(0,l.jsxs)("div",{className:"relative overflow-hidden rounded-t-md @container before:pointer-events-none before:absolute before:inset-0 before:shadow-[inset_-30px_0_20px_-20px_var(--ds-background-200)] before:content-[''] @[840px]:before:shadow-none group",children:[(0,l.jsx)("button",{type:"button",disabled:!c,onClick:()=>j("left"),className:(0,d.cn)("absolute left-2 top-1/2 -translate-y-1/2 z-20 bg-background-100 border border-gray-alpha-400 rounded-md p-2 shadow-md opacity-0  transition-opacity hover:bg-background-200 pointer-events-none",{"group-hover:opacity-100 pointer-events-auto":c}),"aria-label":"Scroll left",children:(0,l.jsx)(D.ChevronLeft,{})}),(0,l.jsx)("button",{type:"button",disabled:!x,onClick:()=>j("right"),className:(0,d.cn)("absolute right-2 top-1/2 -translate-y-1/2 z-20 bg-background-100 border border-gray-alpha-400 rounded-md p-2 shadow-md opacity-0 transition-opacity hover:bg-background-200 pointer-events-none",{"group-hover:opacity-100 pointer-events-auto":x}),"aria-label":"Scroll right",children:(0,l.jsx)(Z.ChevronRight,{})}),(0,l.jsxs)("div",{ref:o,className:"flex flex-1 flex-row overflow-x-scroll divide-x [-ms-overflow-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:[(0,l.jsx)(H,{active:"all"===s.action,icon:(0,l.jsx)($.Globe,{}),label:"All Traffic",onClick:()=>t("all"),ref:"all"===s.action?h:void 0,children:p.all}),(0,l.jsx)(H,{active:"allow"===s.action,icon:(0,l.jsx)(z.ShieldCheck,{}),label:"Allowed",onClick:()=>t("allow"),ref:"allow"===s.action?h:void 0,children:p.allow}),(0,l.jsx)(H,{active:"deny"===s.action,icon:(0,l.jsx)(_.ShieldOff,{}),label:"Denied",onClick:()=>t("deny"),ref:"deny"===s.action?h:void 0,children:p.deny}),(0,l.jsx)(H,{active:"challenge"===s.action,icon:(0,l.jsx)(O.Shield,{}),label:"Challenged",onClick:()=>t("challenge"),ref:"challenge"===s.action?h:void 0,children:p.challenge}),(0,l.jsx)(H,{active:"log"===s.action,icon:(0,l.jsx)(P.CodeWrap,{}),label:"Logged",onClick:()=>t("log"),ref:"log"===s.action?h:void 0,children:p.log}),(0,l.jsx)(H,{active:"rate_limit"===s.action,icon:(0,l.jsx)(F.Gauge,{}),label:"Rate Limited",onClick:()=>t("rate_limit"),ref:"rate_limit"===s.action?h:void 0,children:p.rate_limit})]})]})}let H=(0,i.forwardRef)(function(e,t){let{active:a,children:i,icon:s,label:r,onClick:n}=e;return(0,l.jsxs)("button",{type:"button",ref:t,onClick:n,className:(0,N.clsx)("flex flex-col items-stretch justify-start gap-1 flex-1 p-5 min-w-[166px] cursor-pointer",a?"bg-background-100 border-b-2 border-b-gray-1000":"bg-background-200 border-b border-b-gray-200"),children:[(0,l.jsxs)("div",{className:(0,N.clsx)("flex flex-row items-center justify-start gap-2 flex-initial",a?"text-gray-1000":"text-gray-800"),children:[s,(0,l.jsx)("p",{className:"text-label-14 font-medium whitespace-nowrap",children:r})]}),(0,l.jsx)("p",{className:"text-heading-24 font-medium text-left",children:0===i?"-":(0,y.formatShortPrecision)(i)})]})});function W(e){let{toolbarState:t,setToolbarState:s,query:r,lineSeries:n,error:o,isGraphDataLoading:d,isFirewallStatusLoading:u,totalBotRequests:x}=e,h=(0,a.useParams)(),m=(0,a.usePathname)(),g=(0,i.useMemo)(()=>m?.endsWith("/firewall/traffic")||m?.endsWith("/firewall/bot-management"),[m]),p=(0,i.useMemo)(()=>e=>{s({type:"range",value:e})},[s]),j=(0,i.useMemo)(()=>e=>{s({type:"action",value:e})},[s]);return(0,l.jsxs)("div",{className:"flex flex-col gap-3 mb-4 @lg-page:flex-row",children:[!g&&(!h||u?(0,l.jsx)("div",{className:"w-full @lg-page:h-[388px] @lg-page:w-[278px]",children:(0,l.jsx)(f,{width:278})}):(0,l.jsx)("div",{className:"w-full @lg-page:h-[388px] @lg-page:w-[278px]",children:(0,l.jsx)(v,{projectId:h.project,teamId:h.teamSlug})})),(0,l.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col rounded-md border border-gray-alpha-400 bg-background-100",children:["BotID"===t.filter||"bot-management"===t.filter?(0,l.jsx)(T,{totalRequests:x}):(0,l.jsx)(G,{onActionClick:j,query:r,state:t}),(0,l.jsx)("div",{"data-testid":(0,c.tid)("firewall","graph","container"),className:"flex-1 px-4 pb-4 pt-8",style:{position:"relative"},children:(0,l.jsx)(R,{data:n,error:o,height:240,isLoading:d,query:r,onZoomIn:p})})]})]})}var Q=e.i(5467025),K=e.i(2329363),X=e.i(7288962),J=e.i(5338940),Y=e.i(6060673),ee=e.i(4597921),el=e.i(60582);let et=["alert","eventIp","eventHost","eventAction","eventStart","eventEnd"];function ea(e){let{children:c,headerActions:d,showTabs:u=!0}=e,x=(0,o.useFirewallState)(),{timeRangeSelector:f}=x,{team:h}=(0,J.useTeam)(),m=(0,a.useParams)(),{data:g}=(0,Y.useProject)(m?.project),p=(0,ee.useServerFlag)("firewall-overview-refresh",!1),j=(0,ee.useServerFlag)("show-security-plus",!1),w=(0,i.useRef)(null),v=(g?.security?.attackModeEnabled&&(!g?.security?.attackModeActiveUntil||g.security.attackModeActiveUntil>Date.now()))??!1,k=[{label:"Overview",route:"/[teamSlug]/[project]/firewall",computeSearch:e=>(e.delete("filter"),e.delete("action"),e)},"/[teamSlug]/[project]/firewall/traffic","/[teamSlug]/[project]/firewall/rules","/[teamSlug]/[project]/firewall/audit-log"];j&&k.push("/[teamSlug]/[project]/firewall/bot-management");let S=(0,a.usePathname)(),N=(0,i.useMemo)(()=>d?"bot-management"===S?.split("/").at(-1)?d["bot-management"]:d.default:null,[S,d]),{title:C}=(0,i.useMemo)(()=>{let e=Object.entries(r.Routes).find(e=>{let[l]=e,t=l.replace(/^.*(?=firewall)/,"");return S?.endsWith(t)});if(e&&S){let[,l]=e;if("Firewall"===l.group)return{title:l.label}}return{title:"Overview"}},[S]);return(0,l.jsxs)("div",{className:"flex flex-1 flex-col relative",children:[(0,l.jsx)("div",{className:`w-full md:py-6 ${!u?"border-b":""}`,children:(0,l.jsxs)("div",{className:"container flex flex-row flex-wrap md:min-h-14 items-top gap-2 py-6 md:py-0",children:[el.IS_DASH?null:(0,l.jsxs)("div",{className:`flex flex-col -mb-2 ${u?"w-[209px]":""}`,children:[(0,l.jsx)(s.Link,{href:S?.replace(/\/[^/]+$/,""),className:"text-sm text-gray-900 inline-block -mt-2 h-4 hover:underline",children:"Firewall"}),(0,l.jsxs)("div",{className:"flex items-center gap-2 mt-1.5",children:[(0,l.jsx)("h1",{className:"font-medium text-heading-32 text-3xl",children:C}),(0,l.jsx)(n.MicrofrontendsHelpBadge,{childHelp:"Firewall rules for the default app also run for every request to this microfrontend.",parentHelp:"Firewall rules defined here will run for all microfrontends in this group."})]})]}),f&&(0,l.jsx)("div",{className:`hidden @lg-page:block ${u?el.IS_DASH?"":"p-2":"ml-6"}`,children:f}),N&&(0,l.jsx)("div",{className:"ml-auto flex flex-row items-center gap-2",children:N}),f&&(0,l.jsx)("div",{className:"w-full @lg-page:hidden mt-2",children:f})]})}),(0,l.jsx)("div",{className:"relative flex-1",children:(0,l.jsxs)("div",{className:"container flex flex-col gap-6 pb-10 md:flex-row md:py-6",children:[u&&!el.IS_DASH?(0,l.jsx)("div",{className:"flex md:min-w-[209px] flex-col gap-2 -mx-2.5 md:mr-0",children:(0,l.jsx)(t.TabList,{excludeParams:et,routes:k})}):null,(0,l.jsxs)("div",{className:"flex-1 min-w-0",ref:w,children:[x.shouldRenderPostureGraph&&(0,l.jsxs)(l.Fragment,{children:[!p&&(0,l.jsx)("div",{className:"container flex flex-col gap-3 px-0 pb-6",children:(0,l.jsx)("div",{className:"flex flex-1 flex-row items-center justify-between gap-2",children:x.isFirewallStatusLoading?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"mr-auto"}),(0,l.jsx)("div",{className:"flex flex-1 flex-row justify-end",children:(0,l.jsx)("div",{className:"w-full @lg-page:w-auto",children:(0,l.jsx)(M,{})})})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(K.FirewallStatusBadge,{className:"hidden @lg-page:flex"}),(0,l.jsx)("div",{className:"flex flex-1 flex-row justify-end",children:(0,l.jsx)("div",{className:"w-full @lg-page:w-auto",children:(0,l.jsx)(i.Suspense,{fallback:(0,l.jsx)(M,{}),children:(0,l.jsx)(X.StickyFirewallGraphToolbar,{isCustomRuleSelected:x.currentConfig?.rules.some(e=>e.id===x.toolbarState.filter)??!1,options:x.options,positionTop:(0,y.getOffsetTop)(w.current),rules:x.activeRules,setToolbarState:x.setToolbarState,team:h??void 0,toolbarState:x.toolbarState,managedRulesets:x.managedRulesets,isAttackModeEnabled:v})})})})]})})}),(0,l.jsx)(Q.ObservabilityChartContextProvider,{children:(0,l.jsx)(b.VisualizationContextProvider,{formatter:y.formatShortPrecision,series:x.lineSeries??new Map,children:(0,l.jsx)(W,{toolbarState:x.toolbarState,setToolbarState:x.setToolbarState,query:x.query,lineSeries:x.lineSeries,error:x.error,isGraphDataLoading:x.isGraphDataLoading,isFirewallStatusLoading:x.isFirewallStatusLoading,totalBotRequests:x.totalBotRequests})})})]}),c]})]})})]})}e.s(["FirewallProjectLayout",()=>ea],2102048)},5190666,e=>{"use strict";var l=e.i(1146226);e.i(6483798);var t=e.i(8287059),a=e.i(8459493),i=e.i(5610834),s=e.i(5169864);function r(e){let{href:r,isHobby:n,teamId:o,source:c,...d}=e,u=(0,i.useRouter)(),x=(0,t.useOpenUpgradeModal)(),f=(0,s.useCallback)(()=>{r&&x({teamHint:o,source:`firewall-configure-menu-${c}`,onConversionSuccess:()=>{u.push(r)}})},[r,x,u.push,c,o]);return n?(0,l.jsx)(a.MenuItem,{...d,isLink:!1,onClick:f}):(0,l.jsx)(a.MenuItem,{isLink:!0,href:"https://vercel.com/contact/sales",...d})}e.s(["UpgradableMenuItem",()=>r])},2139548,e=>{"use strict";var l=e.i(2405338);function t(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{data:t,mutate:a}=(0,l.default)("showConfirmAttackModeModal",null,{fallbackData:e});return{showConfirmAttackModeModal:t,setShowConfirmAttackModeModal:a}}e.s(["useConfirmAttackModeModal",()=>t])},4185682,e=>{"use strict";var l=e.i(1146226),t=e.i(2139548),a=e.i(8459493);function i(e){let{setShowConfirmAttackModeModal:i}=(0,t.useConfirmAttackModeModal)();return(0,l.jsx)(a.MenuItem,{onClick:()=>i(!0),...e})}e.s(["ConfirmAttackModeModalTrigger",()=>i])},6234625,e=>{"use strict";var l=e.i(2405338);function t(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{data:t,mutate:a}=(0,l.default)("showMitigationsBypassModal",null,{fallbackData:e});return{showMitigationsBypassModal:t,setShowMitigationsBypassModal:a}}e.s(["useMitigationsBypassModal",()=>t])},1669084,e=>{"use strict";var l=e.i(1146226),t=e.i(6234625),a=e.i(8459493);function i(e){let{setShowMitigationsBypassModal:i}=(0,t.useMitigationsBypassModal)();return(0,l.jsx)(a.MenuItem,{onClick:()=>i(!0),...e})}e.s(["MitigationsBypassModalTrigger",()=>i])},7449504,e=>{"use strict";var l=e.i(1146226),t=e.i(2139548),a=e.i(6234625),i=e.i(3538015),s=e.i(9943777),r=e.i(2504781),n=e.i(8674454),o=e.i(6694387),c=e.i(4991687),d=e.i(5232300),u=e.i(4161083),x=e.i(8876434),f=e.i(2375916),h=e.i(3814652),m=e.i(6198010),g=e.i(7749365),p=e.i(4905330),j=e.i(5610834),w=e.i(5169864);function v(e){let{teamSlug:r,project:d,canWriteConfig:v,attackModeEnabled:y,isBypassEnabled:k,showBypassOption:S,showRefreshedFirewall:N}=e,M=(0,j.useRouter)(),C=(0,w.useRef)(null),A=k?f.Shield:h.ShieldOff,{setShowMitigationsBypassModal:R}=(0,a.useMitigationsBypassModal)(),{setShowConfirmAttackModeModal:B}=(0,t.useConfirmAttackModeModal)(),L=(0,w.useMemo)(()=>k?"Resume":"Pause",[k]),$=N?`/${r}/${d}/firewall/rules`:`/${r}/${d}/firewall/configure`,T=N?`/${r}/${d}/firewall/audit-log`:`/${r}/${d}/firewall/activity-log`;return(0,l.jsxs)(c.MenuContainer,{closeOnSelect:!0,position:"bottom-end",children:[(0,l.jsx)(o.MenuButton,{"aria-label":"Menu",className:"@lg-page:hidden",shape:"square",size:"small",svgOnly:!0,type:"secondary",children:(0,l.jsx)(x.MoreHorizontal,{})}),(0,l.jsx)(n.Menu,{className:"@lg-page:hidden",containerRef:C,mobileContainerClassName:"z-[5001]",portalClassName:"tailwind-preflight @lg-page:hidden",width:"14rem",children:(0,l.jsxs)("div",{className:"flex h-full flex-col gap-y-3 p-2",children:[(0,l.jsx)(b,{onClick:()=>{M.push(`/${r}/${d}/firewall/configure/rule/new`)},type:"secondary",prefix:(0,l.jsx)(m.Plus,{size:16}),children:"Add Rule"}),(0,l.jsx)(b,{onClick:()=>{let e=(0,s.getRuleTemplateSignature)(i.rateLimitTemplate);M.push(`/${r}/${d}/firewall/configure/rule/new?template=${encodeURIComponent(i.rateLimitTemplate)}&sig=${encodeURIComponent(e)}`)},type:"secondary",prefix:(0,l.jsx)(g.Clock,{size:16}),children:"Add Rate Limit"}),(0,l.jsx)(b,{onClick:()=>M.push($),type:"secondary",prefix:(0,l.jsx)(p.Scroll,{size:16}),children:"Configure Rules"}),(0,l.jsx)(b,{onClick:()=>M.push(T),type:"secondary",prefix:(0,l.jsx)(u.BookOpen,{size:16}),children:"View Audit Log"}),(0,l.jsx)(b,{onClick:()=>M.push(`${$}${N?"":"#bot-management"}`),prefix:(0,l.jsx)(f.Shield,{size:16}),children:"Bot Management"}),S?(0,l.jsxs)(b,{disabled:!v,onClick:()=>R(!0),prefix:(0,l.jsx)(A,{size:16}),type:"Pause"===L?"error":"secondary",children:[L," System Mitigations"]}):null,(0,l.jsxs)(b,{disabled:!v,onClick:()=>B(!0),type:"error",children:[y?"Disable":"Enable"," Attack Mode"]})]})})]})}function b(e){let{disabled:t,onClick:a,prefix:i,suffix:s,type:n,children:o}=e,{actions:c}=(0,d.useMenu)();return(0,l.jsx)(r.Button,{disabled:t,onClick:()=>{c.setOpen(!1),a()},prefix:i,suffix:s,type:n,width:"100%",children:o})}e.s(["MobileMenu",()=>v])},7328883,e=>{"use strict";var l=e.i(1146226),t=e.i(2139548),a=e.i(6234625),i=e.i(8114130),s=e.i(6482765),r=e.i(8362250),n=e.i(7917902),o=e.i(9465698),c=e.i(5793260),d=e.i(6060673),u=e.i(5610834),x=e.i(5169864),f=e.i(7083672);function h(){let e=(0,u.useParams)(),h=(0,u.useRouter)(),{team:m,user:g}=(0,n.useAccount)(),{showMitigationsBypassModal:p,setShowMitigationsBypassModal:j}=(0,a.useMitigationsBypassModal)(),{showConfirmAttackModeModal:w,setShowConfirmAttackModeModal:v}=(0,t.useConfirmAttackModeModal)(),{data:b,isLoading:y,mutate:k}=(0,d.useProject)(e?.project,{apiVersion:"v9"}),{updateMitigationsBypassAll:S,isLoading:N}=(0,o.useFirewallBypass)({projectId:b?.id}),{trigger:M}=(0,c.useUpdateAttackMode)(),C=(b?.security?.attackModeEnabled&&(!b?.security?.attackModeActiveUntil||b.security.attackModeActiveUntil>Date.now()))??!1,{enabled:A}=(0,i.globalBypassStatus)(b),R=(0,x.useCallback)(e=>"string"==typeof e&&e.includes(`projects/${b?.name}`)&&e.includes(`teamId=${m?.slug}`),[b?.name,m?.slug]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.MitigationsBypassModal,{confirmText:`${m?m.slug:g?.username}/${b?.name}`,isEnabled:A,isLoading:N||y,onClose:()=>j(!1),onSubmit:()=>{S(!A).then(async()=>{j(!1),await Promise.all([k(),(0,f.mutate)(R)]),h.refresh()}).catch(()=>{})},open:p}),(0,l.jsx)(r.ConfirmationAttackMode,{isEnabled:C||!1,onClose:()=>{v(!1)},onSubmit:e=>{b&&!y&&M({projectId:b.id,attackModeEnabled:!C,attackModeActiveUntil:e?Date.now()+e:void 0}).then(async()=>{v(!1),await Promise.all([k(),(0,f.mutate)(R)]),h.refresh()}).catch(e=>{console.error("Failed to update attack mode:",e)})},open:w})]})}e.s(["FirewallModals",()=>h])}]);

//# debugId=1eea834d-3794-6557-a7c7-27519d151102
//# sourceMappingURL=bbe6a39a0ccffc60.js.map